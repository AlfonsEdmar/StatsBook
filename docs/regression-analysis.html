<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9 Regression analysis | Not yet decided</title>
  <meta name="description" content="9 Regression analysis | Not yet decided" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="9 Regression analysis | Not yet decided" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 Regression analysis | Not yet decided" />
  
  
  

<meta name="author" content="B. Alfons Edmar" />


<<<<<<< HEAD
<meta name="date" content="2022-05-11" />
=======
<meta name="date" content="2022-05-06" />
>>>>>>> f91ef1f7cdf80f4cef0afd775ea99b40c089c8c7

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="correlation-and-covariation-in-r.html"/>
<link rel="next" href="path-analysis.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">StatsBook</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Table of contents</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#foreword"><i class="fa fa-check"></i><b>2.1</b> Foreword</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#some-useful-resources"><i class="fa fa-check"></i><b>2.2</b> Some useful resources</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="welcome-to-r.html"><a href="welcome-to-r.html"><i class="fa fa-check"></i><b>3</b> Welcome to R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="welcome-to-r.html"><a href="welcome-to-r.html#the-r-environment"><i class="fa fa-check"></i><b>3.1</b> The R environment</a></li>
<li class="chapter" data-level="3.2" data-path="welcome-to-r.html"><a href="welcome-to-r.html#basic-programming"><i class="fa fa-check"></i><b>3.2</b> Basic programming</a></li>
<li class="chapter" data-level="3.3" data-path="welcome-to-r.html"><a href="welcome-to-r.html#organisation"><i class="fa fa-check"></i><b>3.3</b> Organisation</a></li>
<li class="chapter" data-level="3.4" data-path="welcome-to-r.html"><a href="welcome-to-r.html#rmarkdowm"><i class="fa fa-check"></i><b>3.4</b> Rmarkdowm</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="what-i-expect-you-to-know.html"><a href="what-i-expect-you-to-know.html"><i class="fa fa-check"></i><b>4</b> What I expect you to know</a>
<ul>
<li class="chapter" data-level="4.1" data-path="what-i-expect-you-to-know.html"><a href="what-i-expect-you-to-know.html#descriptive-statistics"><i class="fa fa-check"></i><b>4.1</b> Descriptive statistics</a></li>
<li class="chapter" data-level="4.2" data-path="what-i-expect-you-to-know.html"><a href="what-i-expect-you-to-know.html#basic-null-hypothesis-testing"><i class="fa fa-check"></i><b>4.2</b> Basic null hypothesis testing</a></li>
<li class="chapter" data-level="4.3" data-path="what-i-expect-you-to-know.html"><a href="what-i-expect-you-to-know.html#statistical-phenomena"><i class="fa fa-check"></i><b>4.3</b> Statistical phenomena</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="useful-packages-and-functions-that-helped-me-learn.html"><a href="useful-packages-and-functions-that-helped-me-learn.html"><i class="fa fa-check"></i><b>5</b> Useful packages and functions that helped me learn</a>
<ul>
<li class="chapter" data-level="5.1" data-path="useful-packages-and-functions-that-helped-me-learn.html"><a href="useful-packages-and-functions-that-helped-me-learn.html#tidyverse"><i class="fa fa-check"></i><b>5.1</b> Tidyverse</a></li>
<li class="chapter" data-level="5.2" data-path="useful-packages-and-functions-that-helped-me-learn.html"><a href="useful-packages-and-functions-that-helped-me-learn.html#distribution-functions---rnorm-dbeta-rbinom-etc"><i class="fa fa-check"></i><b>5.2</b> Distribution functions - rnorm, dbeta, rbinom etc</a></li>
<li class="chapter" data-level="5.3" data-path="useful-packages-and-functions-that-helped-me-learn.html"><a href="useful-packages-and-functions-that-helped-me-learn.html#faux"><i class="fa fa-check"></i><b>5.3</b> Faux</a></li>
<li class="chapter" data-level="5.4" data-path="useful-packages-and-functions-that-helped-me-learn.html"><a href="useful-packages-and-functions-that-helped-me-learn.html#lm"><i class="fa fa-check"></i><b>5.4</b> lm</a></li>
<li class="chapter" data-level="5.5" data-path="useful-packages-and-functions-that-helped-me-learn.html"><a href="useful-packages-and-functions-that-helped-me-learn.html#lavaan"><i class="fa fa-check"></i><b>5.5</b> Lavaan</a></li>
<li class="chapter" data-level="5.6" data-path="useful-packages-and-functions-that-helped-me-learn.html"><a href="useful-packages-and-functions-that-helped-me-learn.html#semplot"><i class="fa fa-check"></i><b>5.6</b> semPlot</a></li>
<li class="chapter" data-level="5.7" data-path="useful-packages-and-functions-that-helped-me-learn.html"><a href="useful-packages-and-functions-that-helped-me-learn.html#section"><i class="fa fa-check"></i><b>5.7</b> ?</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="bayesian-and-frequentists-statistics.html"><a href="bayesian-and-frequentists-statistics.html"><i class="fa fa-check"></i><b>6</b> Bayesian and Frequentists statistics</a>
<ul>
<li class="chapter" data-level="6.1" data-path="bayesian-and-frequentists-statistics.html"><a href="bayesian-and-frequentists-statistics.html#likelihood-functions"><i class="fa fa-check"></i><b>6.1</b> Likelihood functions</a></li>
<li class="chapter" data-level="6.2" data-path="bayesian-and-frequentists-statistics.html"><a href="bayesian-and-frequentists-statistics.html#density-distributes"><i class="fa fa-check"></i><b>6.2</b> Density distributes</a></li>
<li class="chapter" data-level="6.3" data-path="bayesian-and-frequentists-statistics.html"><a href="bayesian-and-frequentists-statistics.html#all-hail-the-almighty-gauss"><i class="fa fa-check"></i><b>6.3</b> All hail the almighty Gauss</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="non-parametric-statistics.html"><a href="non-parametric-statistics.html"><i class="fa fa-check"></i><b>7</b> Non-parametric statistics</a>
<ul>
<li class="chapter" data-level="7.1" data-path="non-parametric-statistics.html"><a href="non-parametric-statistics.html#asking-all-the-question-making-statements-and-assuming"><i class="fa fa-check"></i><b>7.1</b> Asking all the question, making statements, and assuming</a></li>
<li class="chapter" data-level="7.2" data-path="non-parametric-statistics.html"><a href="non-parametric-statistics.html#the-old-guard"><i class="fa fa-check"></i><b>7.2</b> The old guard</a></li>
<li class="chapter" data-level="7.3" data-path="non-parametric-statistics.html"><a href="non-parametric-statistics.html#bootstrapping"><i class="fa fa-check"></i><b>7.3</b> Bootstrapping</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="correlation-and-covariation-in-r.html"><a href="correlation-and-covariation-in-r.html"><i class="fa fa-check"></i><b>8</b> Correlation and Covariation in R</a>
<ul>
<li class="chapter" data-level="8.1" data-path="correlation-and-covariation-in-r.html"><a href="correlation-and-covariation-in-r.html#welcome-to-the-matrix"><i class="fa fa-check"></i><b>8.1</b> Welcome to the matrix</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="regression-analysis.html"><a href="regression-analysis.html"><i class="fa fa-check"></i><b>9</b> Regression analysis</a>
<ul>
<li class="chapter" data-level="9.1" data-path="regression-analysis.html"><a href="regression-analysis.html#univariate-regression-and-multiple-regression"><i class="fa fa-check"></i><b>9.1</b> Univariate regression and multiple regression</a></li>
<li class="chapter" data-level="9.2" data-path="regression-analysis.html"><a href="regression-analysis.html#the-general-linear-model-anova"><i class="fa fa-check"></i><b>9.2</b> The general linear model (ANOVA)</a></li>
<li class="chapter" data-level="9.3" data-path="regression-analysis.html"><a href="regression-analysis.html#the-generalized-linear-modellogit"><i class="fa fa-check"></i><b>9.3</b> The generalized linear model(logit)</a></li>
<li class="chapter" data-level="9.4" data-path="regression-analysis.html"><a href="regression-analysis.html#cross-validation"><i class="fa fa-check"></i><b>9.4</b> Cross validation</a></li>
<li class="chapter" data-level="9.5" data-path="regression-analysis.html"><a href="regression-analysis.html#lasso-least-absolute-shrinkage-and-selection-operator"><i class="fa fa-check"></i><b>9.5</b> LASSO (least absolute shrinkage and selection operator)</a></li>
<li class="chapter" data-level="9.6" data-path="regression-analysis.html"><a href="regression-analysis.html#ridge-regression"><i class="fa fa-check"></i><b>9.6</b> Ridge regression</a></li>
<li class="chapter" data-level="9.7" data-path="regression-analysis.html"><a href="regression-analysis.html#fully-bayesian-regression"><i class="fa fa-check"></i><b>9.7</b> Fully Bayesian regression</a></li>
<li class="chapter" data-level="9.8" data-path="regression-analysis.html"><a href="regression-analysis.html#poststratification"><i class="fa fa-check"></i><b>9.8</b> Poststratification</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="path-analysis.html"><a href="path-analysis.html"><i class="fa fa-check"></i><b>10</b> Path analysis</a>
<ul>
<li class="chapter" data-level="10.1" data-path="path-analysis.html"><a href="path-analysis.html#streiner2005"><i class="fa fa-check"></i><b>10.1</b> Streiner(2005)</a></li>
<li class="chapter" data-level="10.2" data-path="path-analysis.html"><a href="path-analysis.html#workshop-analysis"><i class="fa fa-check"></i><b>10.2</b> workshop analysis</a></li>
<li class="chapter" data-level="10.3" data-path="path-analysis.html"><a href="path-analysis.html#multiple-regressionagain"><i class="fa fa-check"></i><b>10.3</b> Multiple regression(again)</a></li>
<li class="chapter" data-level="10.4" data-path="path-analysis.html"><a href="path-analysis.html#mediation-analysis"><i class="fa fa-check"></i><b>10.4</b> Mediation analysis</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="exploratory-factor-analysis-efa.html"><a href="exploratory-factor-analysis-efa.html"><i class="fa fa-check"></i><b>11</b> Exploratory factor analysis (EFA)</a></li>
<li class="chapter" data-level="12" data-path="confirmatory-factor-analysis.html"><a href="confirmatory-factor-analysis.html"><i class="fa fa-check"></i><b>12</b> Confirmatory factor analysis</a></li>
<li class="chapter" data-level="13" data-path="multi-level-modelling.html"><a href="multi-level-modelling.html"><i class="fa fa-check"></i><b>13</b> Multi-level modelling</a></li>
<li class="chapter" data-level="14" data-path="structural-equation-modelling.html"><a href="structural-equation-modelling.html"><i class="fa fa-check"></i><b>14</b> Structural equation modelling</a></li>
<li class="chapter" data-level="15" data-path="meta-analysis.html"><a href="meta-analysis.html"><i class="fa fa-check"></i><b>15</b> Meta-analysis</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Not yet decided</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="regression-analysis" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">9</span> Regression analysis<a href="regression-analysis.html#regression-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="univariate-regression-and-multiple-regression" class="section level2 hasAnchor" number="9.1">
<h2><span class="header-section-number">9.1</span> Univariate regression and multiple regression<a href="regression-analysis.html#univariate-regression-and-multiple-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Packages need to follow along with the code, special packages will be loaded when and if needed.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="regression-analysis.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb31-2"><a href="regression-analysis.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb31-3"><a href="regression-analysis.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb31-4"><a href="regression-analysis.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span></code></pre></div>
<p>Regression is not always easily visualised. This here is a function that will visualise a univariate slope along with some of the most important measurements. This is a slight adaption from a function I found here: find the article</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="regression-analysis.html#cb32-1" aria-hidden="true" tabindex="-1"></a>regplot <span class="ot">&lt;-</span> <span class="cf">function</span> (fit, name) {</span>
<span id="cb32-2"><a href="regression-analysis.html#cb32-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-3"><a href="regression-analysis.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(fit<span class="sc">$</span>model, <span class="fu">aes_string</span>(<span class="at">x =</span> <span class="fu">names</span>(fit<span class="sc">$</span>model)[<span class="dv">2</span>], <span class="at">y =</span> <span class="fu">names</span>(fit<span class="sc">$</span>model)[<span class="dv">1</span>])) <span class="sc">+</span> </span>
<span id="cb32-4"><a href="regression-analysis.html#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>( <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb32-5"><a href="regression-analysis.html#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-6"><a href="regression-analysis.html#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> name, <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Adj R2 = &quot;</span>,<span class="fu">signif</span>(<span class="fu">summary</span>(fit)<span class="sc">$</span>adj.r.squared, <span class="dv">5</span>),</span>
<span id="cb32-7"><a href="regression-analysis.html#cb32-7" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;Intercept =&quot;</span>,<span class="fu">signif</span>(fit<span class="sc">$</span>coef[[<span class="dv">1</span>]],<span class="dv">5</span> ),</span>
<span id="cb32-8"><a href="regression-analysis.html#cb32-8" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot; Slope =&quot;</span>,<span class="fu">signif</span>(fit<span class="sc">$</span>coef[[<span class="dv">2</span>]], <span class="dv">5</span>),</span>
<span id="cb32-9"><a href="regression-analysis.html#cb32-9" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot; P =&quot;</span>,<span class="fu">signif</span>(<span class="fu">summary</span>(fit)<span class="sc">$</span>coef[<span class="dv">4</span>], <span class="dv">5</span>)))<span class="sc">+</span></span>
<span id="cb32-10"><a href="regression-analysis.html#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb32-11"><a href="regression-analysis.html#cb32-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-12"><a href="regression-analysis.html#cb32-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Field uses data from album sales. When loading data in r the best way is to put your data files in an easy to access place - note that this is my path, the data file is album sales from chapter 8 or 9 depending on edition so load that.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="regression-analysis.html#cb33-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="fu">here</span>(<span class="st">&quot;Album Sales.sav&quot;</span>))</span>
<span id="cb33-2"><a href="regression-analysis.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Let´s change the names to low caps so we can type easily. </span></span>
<span id="cb33-3"><a href="regression-analysis.html#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;adverts&#39;</span>, <span class="st">&#39;sales&#39;</span>, <span class="st">&#39;airplay&#39;</span>, <span class="st">&#39;image&#39;</span>)</span>
<span id="cb33-4"><a href="regression-analysis.html#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Taking a peek at the data</span></span>
<span id="cb33-5"><a href="regression-analysis.html#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   adverts sales airplay image
##     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1    10.3   330      43    10
## 2   986.    120      28     7
## 3  1446.    360      35     7
## 4  1188.    270      33     7
## 5   575.    220      44     5
## 6   569.    170      19     5</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="regression-analysis.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span></code></pre></div>
<pre><code>##     adverts             sales          airplay          image      
##  Min.   :   9.104   Min.   : 10.0   Min.   : 0.00   Min.   : 1.00  
##  1st Qu.: 215.918   1st Qu.:137.5   1st Qu.:19.75   1st Qu.: 6.00  
##  Median : 531.916   Median :200.0   Median :28.00   Median : 7.00  
##  Mean   : 614.412   Mean   :193.2   Mean   :27.50   Mean   : 6.77  
##  3rd Qu.: 911.226   3rd Qu.:250.0   3rd Qu.:36.00   3rd Qu.: 8.00  
##  Max.   :2271.860   Max.   :360.0   Max.   :63.00   Max.   :10.00</code></pre>
<p>All variables are treated as numerical. Before any formal analysis can be pursued, we should first visually inspect the variables.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="regression-analysis.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#I usually prefer histograms without density curves but let’s use them both to visualise the distribution of our data. </span></span>
<span id="cb37-2"><a href="regression-analysis.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(adverts))<span class="sc">+</span></span>
<span id="cb37-3"><a href="regression-analysis.html#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">color =</span> <span class="st">&#39;steelblue&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb37-4"><a href="regression-analysis.html#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="regression-analysis.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(sales))<span class="sc">+</span></span>
<span id="cb38-2"><a href="regression-analysis.html#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">color =</span> <span class="st">&#39;steelblue&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb38-3"><a href="regression-analysis.html#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-13-2.png" width="672" /></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="regression-analysis.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(airplay))<span class="sc">+</span></span>
<span id="cb39-2"><a href="regression-analysis.html#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">color =</span> <span class="st">&#39;steelblue&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb39-3"><a href="regression-analysis.html#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-13-3.png" width="672" /></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="regression-analysis.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(image))<span class="sc">+</span></span>
<span id="cb40-2"><a href="regression-analysis.html#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">color =</span> <span class="st">&#39;steelblue&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb40-3"><a href="regression-analysis.html#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-13-4.png" width="672" /></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="regression-analysis.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#looks pretty good, the ..density.. call is what gives the curve. </span></span></code></pre></div>
<p>So this is what we are working with, our IVs don’t need to be normal, the residuals need to be normal however. We don’t want heteroskedasticity. The neat thing with having multiple continuous variables is that it opens up plotting possibilities. Let’s make some graphs</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="regression-analysis.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data,  <span class="fu">aes</span>(<span class="at">y =</span> sales, <span class="at">x =</span> adverts</span>
<span id="cb42-2"><a href="regression-analysis.html#cb42-2" aria-hidden="true" tabindex="-1"></a>                         , <span class="at">size =</span> image, <span class="at">colour =</span> airplay))<span class="sc">+</span></span>
<span id="cb42-3"><a href="regression-analysis.html#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb42-4"><a href="regression-analysis.html#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="regression-analysis.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#It is a bit messy, lets clean our plot by colouring by image. Let’s first colour by images that’s less than 5</span></span>
<span id="cb43-2"><a href="regression-analysis.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data,  <span class="fu">aes</span>(<span class="at">y =</span> sales, <span class="at">x =</span> adverts</span>
<span id="cb43-3"><a href="regression-analysis.html#cb43-3" aria-hidden="true" tabindex="-1"></a>                         , <span class="at">size =</span> airplay, <span class="at">colour =</span> image <span class="sc">&lt;</span> <span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb43-4"><a href="regression-analysis.html#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb43-5"><a href="regression-analysis.html#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-14-2.png" width="672" /></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="regression-analysis.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#interesting, most bands have an image at 5 or above, and those that don’t do not sell well regardless of their advert budget or image (the size of the points are roughly the same). Let’s colour by image &lt;8</span></span>
<span id="cb44-2"><a href="regression-analysis.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data,  <span class="fu">aes</span>(<span class="at">y =</span> sales, <span class="at">x =</span> adverts</span>
<span id="cb44-3"><a href="regression-analysis.html#cb44-3" aria-hidden="true" tabindex="-1"></a>                         , <span class="at">size =</span> airplay, <span class="at">colour =</span> image <span class="sc">&lt;</span> <span class="dv">8</span>))<span class="sc">+</span></span>
<span id="cb44-4"><a href="regression-analysis.html#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb44-5"><a href="regression-analysis.html#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-14-3.png" width="672" /></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="regression-analysis.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Pretty graphs right? </span></span></code></pre></div>
<p>This is a better spread. But we can see that image does not seem to impact sales that much. There seems to be an effect, however. The most interesting thing with this graph however is that a high advert budget more or less promises good sales. No band with a budget less than 1 000 000 pounds have less than 100 000 album sales. A crude heuristic for bands wanting to fund their adverts with album sales could be to not sell their album for less than 10£. But this is of course bad advice. We have no information on the cost of the albums and sales are most likely affected by the cost of the album. Nevertheless, this is a fun graph.</p>
<p>Let’s make image into a factor so we can split our graphs better using the facet_wrap function</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="regression-analysis.html#cb46-1" aria-hidden="true" tabindex="-1"></a>plotdata <span class="ot">&lt;-</span> data</span>
<span id="cb46-2"><a href="regression-analysis.html#cb46-2" aria-hidden="true" tabindex="-1"></a>plotdata<span class="sc">$</span>image <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(plotdata<span class="sc">$</span>image)</span>
<span id="cb46-3"><a href="regression-analysis.html#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Now image is a factor with to levels. Let’s use the image of the band as colour</span></span>
<span id="cb46-4"><a href="regression-analysis.html#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> plotdata,  <span class="fu">aes</span>(<span class="at">y =</span> sales, <span class="at">x =</span> adverts</span>
<span id="cb46-5"><a href="regression-analysis.html#cb46-5" aria-hidden="true" tabindex="-1"></a>                         , <span class="at">size =</span> airplay, <span class="at">colour =</span> image))<span class="sc">+</span></span>
<span id="cb46-6"><a href="regression-analysis.html#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb46-7"><a href="regression-analysis.html#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>image)<span class="sc">+</span></span>
<span id="cb46-8"><a href="regression-analysis.html#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="regression-analysis.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Or</span></span>
<span id="cb47-2"><a href="regression-analysis.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> plotdata,  <span class="fu">aes</span>(<span class="at">y =</span> sales, <span class="at">x =</span> adverts</span>
<span id="cb47-3"><a href="regression-analysis.html#cb47-3" aria-hidden="true" tabindex="-1"></a>                             , <span class="at">colour =</span> airplay))<span class="sc">+</span></span>
<span id="cb47-4"><a href="regression-analysis.html#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb47-5"><a href="regression-analysis.html#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>image)<span class="sc">+</span></span>
<span id="cb47-6"><a href="regression-analysis.html#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-15-2.png" width="672" /></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="regression-analysis.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Note that one graph colours airplay while the other image</span></span></code></pre></div>
<p>Another interesting graph. Interestingly we can see that the band with the highest image has no advert budget. However, very few bands with that high image exists. The main idea this graph gives is that the slope between sales and advert budget does not seem to depend heavily on the image of the band. However, bands with low image often have less advert budget - and less sales. we can also see a relationship between airplay and sales, bigger points are usually a bit higher up on sales than small points.</p>
<p>So what are our expectations given the graphs? we should expect an effect of image airplay and adverts on sales, but there will probably not be any meaningful interactions between them since no relationship was observable in the graphs. let’s see if this holds up.</p>
<p>our first model is a simple regression of adverts on album sales. We would expect more sales with more advert budget take a look at the lm function for syntax and code reference.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="regression-analysis.html#cb49-1" aria-hidden="true" tabindex="-1"></a>?lm</span>
<span id="cb49-2"><a href="regression-analysis.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co">#fitting the model</span></span>
<span id="cb49-3"><a href="regression-analysis.html#cb49-3" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sales <span class="sc">~</span> adverts, <span class="at">data =</span> data)</span></code></pre></div>
<p>One of the most important things we have to do when analysing data using statistical methods is checking that our assumptions for our method holds.
For regression that: normality of residuals, independent errors, no multicollinearity, and homogeneity of variance in the residuals. Let’s check these things out.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="regression-analysis.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking the residuals and normality assumption</span></span>
<span id="cb50-2"><a href="regression-analysis.html#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">predict.lm</span>(m1), <span class="at">x =</span> m1<span class="sc">$</span>residuals))<span class="sc">+</span></span>
<span id="cb50-3"><a href="regression-analysis.html#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb50-4"><a href="regression-analysis.html#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="regression-analysis.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Nice, the predicted values of our model is distributed quite normally across the residuals. This indicates that the variation in our model is roughly equal on low, medium, and high point estimates. We can also check the density of the</span></span>
<span id="cb51-2"><a href="regression-analysis.html#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="regression-analysis.html#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Residuals - they should be normal around 0. </span></span>
<span id="cb51-4"><a href="regression-analysis.html#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> m1<span class="sc">$</span>residuals))<span class="sc">+</span></span>
<span id="cb51-5"><a href="regression-analysis.html#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-17-2.png" width="672" /></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="regression-analysis.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> m1<span class="sc">$</span>residuals))<span class="sc">+</span></span>
<span id="cb52-2"><a href="regression-analysis.html#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">colour =</span> <span class="st">&#39;steelblue&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-17-3.png" width="672" /></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="regression-analysis.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Nice, this means that our error in measurement isn’t systematically lower or higher than our fitted model. </span></span>
<span id="cb53-2"><a href="regression-analysis.html#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="regression-analysis.html#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking error independence with Durbin Watson test</span></span>
<span id="cb53-4"><a href="regression-analysis.html#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">durbinWatsonTest</span>(m1)</span></code></pre></div>
<pre><code>##  lag Autocorrelation D-W Statistic p-value
##    1     -0.04394305      2.032324   0.772
##  Alternative hypothesis: rho != 0</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="regression-analysis.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Nice, the p-value is insignificant and the test-statistic is close to 2.</span></span></code></pre></div>
<p>Now that we have checked our assumptions and have a good ground to stand on, we can check the fit of our model.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="regression-analysis.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking the fit of the model </span></span>
<span id="cb56-2"><a href="regression-analysis.html#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.lm</span>(m1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = sales ~ adverts, data = data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -152.949  -43.796   -0.393   37.040  211.866 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 1.341e+02  7.537e+00  17.799   &lt;2e-16 ***
## adverts     9.612e-02  9.632e-03   9.979   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 65.99 on 198 degrees of freedom
## Multiple R-squared:  0.3346, Adjusted R-squared:  0.3313 
## F-statistic: 99.59 on 1 and 198 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="regression-analysis.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Lets plot this manually in ggplot using geom_smooth, on our model</span></span>
<span id="cb58-2"><a href="regression-analysis.html#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">y =</span> sales, <span class="at">x =</span> adverts))<span class="sc">+</span></span>
<span id="cb58-3"><a href="regression-analysis.html#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb58-4"><a href="regression-analysis.html#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>)<span class="sc">+</span></span>
<span id="cb58-5"><a href="regression-analysis.html#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="regression-analysis.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Geom smooth fits a linear model to the data, method = &#39;lm&#39; tells it that it’s a linear model. </span></span></code></pre></div>
<p>And there we have it, but by using the regplot function we created above we can put some of the info from the model on the plot.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="regression-analysis.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">regplot</span>(m1, <span class="st">&#39;m1&#39;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="regression-analysis.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.lm</span>(m1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = sales ~ adverts, data = data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -152.949  -43.796   -0.393   37.040  211.866 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 1.341e+02  7.537e+00  17.799   &lt;2e-16 ***
## adverts     9.612e-02  9.632e-03   9.979   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 65.99 on 198 degrees of freedom
## Multiple R-squared:  0.3346, Adjusted R-squared:  0.3313 
## F-statistic: 99.59 on 1 and 198 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="regression-analysis.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Nice graph with good info :) </span></span></code></pre></div>
<p>Pretty neat right? now, what can we make of this? the slope estimates of ca 0.1 indicates that sales increase by .1 for every unit of adverts. The equates to roughly 100 sales per thousand pounds in advertising budget.
Also, note the shaded line. This is our marginal 95% confidence interval. We can see that our uncertainty in the parameter estimate increases at the mode extreme values since we don’t have a lot of data regarding the dispersion on those levels of “adverts”.</p>
<p>We should also check for influential cases analytically, not just visually. we can do this with the function “lm.influence”.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="regression-analysis.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">influence.measures</span>(m1))</span></code></pre></div>
<pre><code>## Potentially influential observations of
##   lm(formula = sales ~ adverts, data = data) :
## 
##     dfb.1_ dfb.advr dffit   cov.r   cook.d hat    
## 1    0.35  -0.27     0.35_*  0.93_*  0.06   0.01  
## 10   0.22  -0.15     0.22    0.97_*  0.02   0.01  
## 11   0.01  -0.02    -0.03    1.04_*  0.00   0.03_*
## 23  -0.02   0.04     0.04    1.05_*  0.00   0.03_*
## 42   0.29  -0.22     0.29    0.95_*  0.04   0.01  
## 43  -0.02   0.04     0.05    1.06_*  0.00   0.05_*
## 75  -0.02   0.04     0.05    1.03_*  0.00   0.02  
## 87  -0.06   0.11     0.12    1.05_*  0.01   0.05_*
## 88   0.02  -0.03    -0.03    1.05_*  0.00   0.04_*
## 92  -0.01   0.01     0.01    1.03_*  0.00   0.02  
## 93  -0.01   0.03     0.03    1.04_*  0.00   0.03  
## 113 -0.13   0.04    -0.17    0.96_*  0.01   0.01  
## 124  0.09   0.02     0.18    0.96_*  0.02   0.01  
## 126  0.05  -0.10    -0.11    1.03_*  0.01   0.02  
## 169  0.32  -0.23     0.33_*  0.92_*  0.05   0.01  
## 175  0.03  -0.07    -0.08    1.03_*  0.00   0.02  
## 184  0.08  -0.13    -0.13    1.08_*  0.01   0.06_*</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="regression-analysis.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">cooks.distance</span>(m1))</span></code></pre></div>
<pre><code>##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
## 3.000e-08 3.380e-04 1.576e-03 4.416e-03 6.314e-03 5.716e-02</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="regression-analysis.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#let’s look at the hat values manually </span></span>
<span id="cb68-2"><a href="regression-analysis.html#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">hatvalues</span>(m1))</span></code></pre></div>
<pre><code>##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## 0.005000 0.005732 0.008030 0.010000 0.011305 0.063529</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="regression-analysis.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hatvalues</span>(m1)<span class="sc">%&gt;%</span> <span class="fu">sort.default</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">20</span>) </span></code></pre></div>
<pre><code>##        184         43         87         88         23         11         93        126 
## 0.06352892 0.04590335 0.04502948 0.03687259 0.03442720 0.03108016 0.02569576 0.02435532 
##        175         28         55         46         62         75        199         92 
## 0.02353610 0.02344638 0.02334463 0.02201132 0.02170914 0.02170914 0.02170914 0.01997151 
##          3        128         20        102 
## 0.01971805 0.01894939 0.01751014 0.01656749</code></pre>
<p>Going by cooks distance we don’t seem to have any very influential values, that is, values exceeding 1. However, we have some values that exceeds three times the leverage or hatvalues. if we go by hoaglin and welch guides of looking at values exceeding three times the average, that is values exceeding .03. that is, observation 11, 23, 88, 87, 43 and 184. What happens if we remove them?</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="regression-analysis.html#cb72-1" aria-hidden="true" tabindex="-1"></a>clean_data <span class="ot">&lt;-</span> <span class="fu">slice</span>(data, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">23</span>, <span class="dv">88</span>, <span class="dv">87</span>, <span class="dv">43</span>, <span class="dv">184</span>))</span>
<span id="cb72-2"><a href="regression-analysis.html#cb72-2" aria-hidden="true" tabindex="-1"></a>clean_m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sales<span class="sc">~</span>adverts, clean_data)</span>
<span id="cb72-3"><a href="regression-analysis.html#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="fu">regplot</span>(clean_m1, <span class="st">&#39;clean m1&#39;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="regression-analysis.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.lm</span>(clean_m1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = sales ~ adverts, data = clean_data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -152.910  -44.484   -0.291   38.368  211.845 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 134.18426    8.00113  16.771  &lt; 2e-16 ***
## adverts       0.09596    0.01116   8.602 2.76e-15 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 66.9 on 192 degrees of freedom
## Multiple R-squared:  0.2782, Adjusted R-squared:  0.2744 
## F-statistic: 73.99 on 1 and 192 DF,  p-value: 2.763e-15</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="regression-analysis.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co">#.</span></span></code></pre></div>
<p>Does not change much in terms of estimation. We can compare the graphs using the grid arrange function from the gridExtra package</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="regression-analysis.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb76-2"><a href="regression-analysis.html#cb76-2" aria-hidden="true" tabindex="-1"></a>m1_plot <span class="ot">&lt;-</span> <span class="fu">regplot</span>(m1, <span class="st">&#39;original model&#39;</span>)</span>
<span id="cb76-3"><a href="regression-analysis.html#cb76-3" aria-hidden="true" tabindex="-1"></a>clean_m1_plot <span class="ot">&lt;-</span> <span class="fu">regplot</span>(clean_m1, <span class="st">&#39;influential observations removed&#39;</span>)</span>
<span id="cb76-4"><a href="regression-analysis.html#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(m1_plot, clean_m1_plot, <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&#39;original&#39;</span>, <span class="st">&#39;clean&#39;</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="regression-analysis.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co">#.</span></span></code></pre></div>
<p>Here we can easily see that the influential observations were the cases with very high advertising budgets. it might be prudent to use the updated model, but no model is “better” than the other. We should use the model that helps us answer our research question best - “horses for courses”</p>
<p>A fast way, but less pleasing and not as hands on, is to simply use the “plot” function. It gives much of the same information</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="regression-analysis.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m1)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-23-1.png" width="672" /><img src="bookdownproj_files/figure-html/unnamed-chunk-23-2.png" width="672" /><img src="bookdownproj_files/figure-html/unnamed-chunk-23-3.png" width="672" /><img src="bookdownproj_files/figure-html/unnamed-chunk-23-4.png" width="672" /></p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="regression-analysis.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(clean_m1)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-23-5.png" width="672" /><img src="bookdownproj_files/figure-html/unnamed-chunk-23-6.png" width="672" /><img src="bookdownproj_files/figure-html/unnamed-chunk-23-7.png" width="672" /><img src="bookdownproj_files/figure-html/unnamed-chunk-23-8.png" width="672" /></p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="regression-analysis.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">#.</span></span></code></pre></div>
<p>Note that the spread of fitted to residuals is much nicer when we exclude the influential observations.</p>
<p>let’s kick this up a notch and run a multiple regression on a split sample so that we can cross-validate our model. let’s take all the variables in our data</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="regression-analysis.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Splitting our sample randomly using rbinom</span></span>
<span id="cb81-2"><a href="regression-analysis.html#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb81-3"><a href="regression-analysis.html#cb81-3" aria-hidden="true" tabindex="-1"></a>data_partition <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">200</span>, <span class="dv">1</span>, <span class="at">prob =</span> .<span class="dv">5</span>) </span>
<span id="cb81-4"><a href="regression-analysis.html#cb81-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(data, data_partition)</span>
<span id="cb81-5"><a href="regression-analysis.html#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(data_partition)</span>
<span id="cb81-6"><a href="regression-analysis.html#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="regression-analysis.html#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="co">#The binary variable &quot;data partition&quot; is our random divide of the sample in to 2. We will run the regression on one part of the sample and see how well it predicts the data in the second sample. let’s call it training data and test data. </span></span>
<span id="cb81-8"><a href="regression-analysis.html#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-9"><a href="regression-analysis.html#cb81-9" aria-hidden="true" tabindex="-1"></a>training_data <span class="ot">&lt;-</span> <span class="fu">filter</span>(data, data_partition <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb81-10"><a href="regression-analysis.html#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(training_data<span class="sc">$</span>data_partition)</span></code></pre></div>
<pre><code>##  int [1:97] 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="regression-analysis.html#cb83-1" aria-hidden="true" tabindex="-1"></a>test_data     <span class="ot">&lt;-</span> <span class="fu">filter</span>(data, data_partition <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb83-2"><a href="regression-analysis.html#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(test_data<span class="sc">$</span>data_partition)</span></code></pre></div>
<pre><code>##  int [1:103] 0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<p>Now we have our two samples, lets fit our training model. it works the same way as the simple regression, but we just add the additional IVs like you would in a normal regression formula. but first let’s standardize the data so it’s more easily comparable</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="regression-analysis.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Standardising, or, &quot;scaling&quot; our data</span></span>
<span id="cb85-2"><a href="regression-analysis.html#cb85-2" aria-hidden="true" tabindex="-1"></a>z_training_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">scale</span>(training_data))</span>
<span id="cb85-3"><a href="regression-analysis.html#cb85-3" aria-hidden="true" tabindex="-1"></a>z_test_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">scale</span>(test_data))</span>
<span id="cb85-4"><a href="regression-analysis.html#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Fitting the multiple regression</span></span>
<span id="cb85-5"><a href="regression-analysis.html#cb85-5" aria-hidden="true" tabindex="-1"></a>training_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(sales <span class="sc">~</span> adverts <span class="sc">+</span> image <span class="sc">+</span> airplay, <span class="at">data =</span> z_training_data)</span></code></pre></div>
<p>Like for the simple regression we need to check our assumptions</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="regression-analysis.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking the residuals and normality assumtions </span></span>
<span id="cb86-2"><a href="regression-analysis.html#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> training_data, <span class="fu">aes</span>(  <span class="at">y =</span> <span class="fu">predict.lm</span>(training_model)</span>
<span id="cb86-3"><a href="regression-analysis.html#cb86-3" aria-hidden="true" tabindex="-1"></a>                                 , <span class="at">x =</span> training_model<span class="sc">$</span>residuals))<span class="sc">+</span></span>
<span id="cb86-4"><a href="regression-analysis.html#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb86-5"><a href="regression-analysis.html#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="regression-analysis.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Looks good</span></span>
<span id="cb87-2"><a href="regression-analysis.html#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> training_data, <span class="fu">aes</span>(<span class="at">x =</span> training_model<span class="sc">$</span>residuals))<span class="sc">+</span></span>
<span id="cb87-3"><a href="regression-analysis.html#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-26-2.png" width="672" /></p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="regression-analysis.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> training_data, <span class="fu">aes</span>(<span class="at">x =</span> training_model<span class="sc">$</span>residuals))<span class="sc">+</span></span>
<span id="cb88-2"><a href="regression-analysis.html#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">colour =</span> <span class="st">&#39;steelblue&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-26-3.png" width="672" /></p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="regression-analysis.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Nice </span></span>
<span id="cb89-2"><a href="regression-analysis.html#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="regression-analysis.html#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="co">#We need to check for multicollinearity when we do multiple regression. A cool way to do this is with GGally, but we can also just calculate VIF and tolerance(1/vif) </span></span>
<span id="cb89-4"><a href="regression-analysis.html#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(training_model)</span></code></pre></div>
<pre><code>##  adverts    image  airplay 
## 1.063294 1.066953 1.053305</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="regression-analysis.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span><span class="fu">vif</span>(training_model) </span></code></pre></div>
<pre><code>##   adverts     image   airplay 
## 0.9404740 0.9372484 0.9493924</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="regression-analysis.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Tolerance is simply 1 divided by the VIF. Our vif should be &lt;10 and our tolerance</span></span>
<span id="cb93-2"><a href="regression-analysis.html#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt;.2. </span></span>
<span id="cb93-3"><a href="regression-analysis.html#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb93-4"><a href="regression-analysis.html#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(training_model)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-26-4.png" width="672" /></p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="regression-analysis.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Don´t worry about this, this is just a cool diagnostic tool with loads of info in a single plot with a very simple call. </span></span>
<span id="cb94-2"><a href="regression-analysis.html#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="regression-analysis.html#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking error independence with Durbin Watson test</span></span>
<span id="cb94-4"><a href="regression-analysis.html#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="fu">durbinWatsonTest</span>(training_model)</span></code></pre></div>
<pre><code>##  lag Autocorrelation D-W Statistic p-value
##    1      0.00282891      1.887567   0.586
##  Alternative hypothesis: rho != 0</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="regression-analysis.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Still looks good, but notice that the test statistic is less close to 2. </span></span>
<span id="cb96-2"><a href="regression-analysis.html#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Small sample = bad</span></span></code></pre></div>
<p>Now, let’s check the fit of out model</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="regression-analysis.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.lm</span>(training_model)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = sales ~ adverts + image + airplay, data = z_training_data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.4006 -0.2931 -0.0123  0.3958  1.3417 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 1.215e-16  6.004e-02   0.000 1.000000    
## adverts     4.901e-01  6.223e-02   7.876 6.16e-12 ***
## image       2.161e-01  6.234e-02   3.466 0.000802 ***
## airplay     4.666e-01  6.194e-02   7.532 3.18e-11 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.5913 on 93 degrees of freedom
## Multiple R-squared:  0.6613, Adjusted R-squared:  0.6503 
## F-statistic: 60.51 on 3 and 93 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="regression-analysis.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">regplot</span>(training_model, <span class="st">&#39;training model&#39;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="regression-analysis.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co">#.</span></span></code></pre></div>
<p>All estimates are significant, indicating that all variables contribute to
the number of sales, we have also doubled the R2, we can explain much more of the variation with this model. Note also how the visuals suck. it’s hard to visualize multiple regression. But let’s try some ways of visualising.</p>
<p>One way is to use the broom package like so:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="regression-analysis.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb101-2"><a href="regression-analysis.html#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="co">#We need to make image into a factor</span></span>
<span id="cb101-3"><a href="regression-analysis.html#cb101-3" aria-hidden="true" tabindex="-1"></a>training_data<span class="sc">$</span>image <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(training_data<span class="sc">$</span>image)</span>
<span id="cb101-4"><a href="regression-analysis.html#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co">#We then fit the model that we want to plot</span></span>
<span id="cb101-5"><a href="regression-analysis.html#cb101-5" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sales <span class="sc">~</span> adverts <span class="sc">+</span> image, <span class="at">data =</span> training_data)</span>
<span id="cb101-6"><a href="regression-analysis.html#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Then, using the augment function we can fit a slope to each level of &quot;image&quot;</span></span>
<span id="cb101-7"><a href="regression-analysis.html#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">augment</span>(plot1), <span class="fu">aes</span>(<span class="at">y =</span> sales, <span class="at">x =</span> adverts, <span class="at">col =</span> image))<span class="sc">+</span></span>
<span id="cb101-8"><a href="regression-analysis.html#cb101-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb101-9"><a href="regression-analysis.html#cb101-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb101-10"><a href="regression-analysis.html#cb101-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="regression-analysis.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co">#.</span></span></code></pre></div>
<p>This is a visualization of the sales across advert budget grouped by the band image, we can see that bands with a bad image (1), have fever sales, but they also have less budget. But we also see differences in slope depending on image. the band with the best image has a flatter slope then the bands with slightly worse image. Note that we already know this from our previous graphs, and they are way less messy, this is not a very good graph I think.</p>
<p>Again, visualizing multiple regression is hard, since the dimensions become hard to grasp after two or more variables, given that we care about interactions. One other way is though plotting marginal predictions or coefficients. This illustrates the regression output quite nicely I think, this is sometimes referred to as a simple slopes graph.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="regression-analysis.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Lets extract the coefficients from the model </span></span>
<span id="cb103-2"><a href="regression-analysis.html#cb103-2" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> training_model<span class="sc">$</span>coef</span>
<span id="cb103-3"><a href="regression-analysis.html#cb103-3" aria-hidden="true" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> cf[<span class="dv">1</span>]</span>
<span id="cb103-4"><a href="regression-analysis.html#cb103-4" aria-hidden="true" tabindex="-1"></a>adverts   <span class="ot">&lt;-</span> cf[<span class="dv">2</span>]</span>
<span id="cb103-5"><a href="regression-analysis.html#cb103-5" aria-hidden="true" tabindex="-1"></a>adverts   <span class="ot">&lt;-</span> <span class="fu">round</span>(adverts, <span class="dv">4</span>)</span>
<span id="cb103-6"><a href="regression-analysis.html#cb103-6" aria-hidden="true" tabindex="-1"></a>image     <span class="ot">&lt;-</span> cf[<span class="dv">3</span>]</span>
<span id="cb103-7"><a href="regression-analysis.html#cb103-7" aria-hidden="true" tabindex="-1"></a>image     <span class="ot">&lt;-</span> <span class="fu">round</span>(image, <span class="dv">4</span>)</span>
<span id="cb103-8"><a href="regression-analysis.html#cb103-8" aria-hidden="true" tabindex="-1"></a>airplay   <span class="ot">&lt;-</span> cf[<span class="dv">4</span>]</span>
<span id="cb103-9"><a href="regression-analysis.html#cb103-9" aria-hidden="true" tabindex="-1"></a>airplay   <span class="ot">&lt;-</span> <span class="fu">round</span>(airplay, <span class="dv">4</span>)</span>
<span id="cb103-10"><a href="regression-analysis.html#cb103-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Here they are</span></span>
<span id="cb103-11"><a href="regression-analysis.html#cb103-11" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(adverts, image, airplay)</span></code></pre></div>
<pre><code>## [1] &quot;0.4901 0.2161 0.4666&quot;</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="regression-analysis.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This is a grid of values so that the plot has structure - this will be invisible in the graph</span></span>
<span id="cb105-2"><a href="regression-analysis.html#cb105-2" aria-hidden="true" tabindex="-1"></a>statgrid <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">y =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> adverts, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb105-3"><a href="regression-analysis.html#cb105-3" aria-hidden="true" tabindex="-1"></a>                       ,<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">100</span>))</span>
<span id="cb105-4"><a href="regression-analysis.html#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting the slopes</span></span>
<span id="cb105-5"><a href="regression-analysis.html#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> statgrid, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y))<span class="sc">+</span></span>
<span id="cb105-6"><a href="regression-analysis.html#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb105-7"><a href="regression-analysis.html#cb105-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> intercept, <span class="at">slope =</span> adverts</span>
<span id="cb105-8"><a href="regression-analysis.html#cb105-8" aria-hidden="true" tabindex="-1"></a>              , <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb105-9"><a href="regression-analysis.html#cb105-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> intercept, <span class="at">slope =</span> image</span>
<span id="cb105-10"><a href="regression-analysis.html#cb105-10" aria-hidden="true" tabindex="-1"></a>              , <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb105-11"><a href="regression-analysis.html#cb105-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> intercept, <span class="at">slope =</span> airplay</span>
<span id="cb105-12"><a href="regression-analysis.html#cb105-12" aria-hidden="true" tabindex="-1"></a>              , <span class="at">col =</span> <span class="st">&#39;green&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb105-13"><a href="regression-analysis.html#cb105-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="at">label =</span> <span class="st">&#39;standardised sale value&#39;</span>)<span class="sc">+</span></span>
<span id="cb105-14"><a href="regression-analysis.html#cb105-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="at">label =</span> <span class="st">&#39;dependent variable slope&#39;</span>)<span class="sc">+</span></span>
<span id="cb105-15"><a href="regression-analysis.html#cb105-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb105-16"><a href="regression-analysis.html#cb105-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;Adverts = blue | Image = red | Airplay = green&#39;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="regression-analysis.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Our simple slopes plot</span></span></code></pre></div>
<p>This visualization shows the slopes from the model. That is, the increase in units of sales when the dependent variable increases with one independently. I do not see this type of visualisation often but i quite like it. I think it’s a neat way of visualising a regression output. It is quite abstract though, since it requires that you scale you DVs so they can fit the same plot.</p>
<p>Lastly, let’s see if we have any significant interaction effects, this is a little teaser for what we will do later on in the moderation chapter but I think it might be a good idea to see if we have an interaction here. Going by the graphs earlier we should not expect anything big.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="regression-analysis.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A third model that uses the interaction between image and adverts</span></span>
<span id="cb107-2"><a href="regression-analysis.html#cb107-2" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sales <span class="sc">~</span> adverts<span class="sc">*</span>image <span class="sc">+</span> airplay, <span class="at">data =</span> z_training_data)</span>
<span id="cb107-3"><a href="regression-analysis.html#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.lm</span>(m3)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = sales ~ adverts * image + airplay, data = z_training_data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.4197 -0.2856  0.0063  0.4046  1.3321 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    0.01604    0.06137   0.261  0.79438    
## adverts        0.49317    0.06214   7.937 4.87e-12 ***
## image          0.18976    0.06594   2.878  0.00498 ** 
## airplay        0.45808    0.06220   7.365 7.36e-11 ***
## adverts:image -0.07987    0.06652  -1.201  0.23294    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.5899 on 92 degrees of freedom
## Multiple R-squared:  0.6665, Adjusted R-squared:  0.652 
## F-statistic: 45.96 on 4 and 92 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="regression-analysis.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The interaction is not significant. let’s go all out and fit a full interaction model - our fourth model</span></span>
<span id="cb109-2"><a href="regression-analysis.html#cb109-2" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sales <span class="sc">~</span> adverts<span class="sc">*</span>image<span class="sc">*</span>airplay, <span class="at">data =</span> z_training_data)</span>
<span id="cb109-3"><a href="regression-analysis.html#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.lm</span>(m4)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = sales ~ adverts * image * airplay, data = z_training_data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.39859 -0.27268 -0.00666  0.38561  1.33742 
## 
## Coefficients:
##                        Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)            0.011502   0.068353   0.168   0.8668    
## adverts                0.505923   0.070951   7.131 2.54e-10 ***
## image                  0.185909   0.081013   2.295   0.0241 *  
## airplay                0.445473   0.068210   6.531 3.93e-09 ***
## adverts:image         -0.102109   0.086212  -1.184   0.2394    
## adverts:airplay        0.002962   0.084294   0.035   0.9720    
## image:airplay          0.074178   0.100145   0.741   0.4608    
## adverts:image:airplay  0.029568   0.131518   0.225   0.8226    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.5975 on 89 degrees of freedom
## Multiple R-squared:  0.6691, Adjusted R-squared:  0.643 
## F-statistic: 25.71 on 7 and 89 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>So, simply going by this the interaction terms does not do much for us. let’s just stick with our original training model and see how well it predicts our test data. Let’s extract our predictions</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="regression-analysis.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co">#We need to load in the caret package for this (more on this later in the cross validation chapter)</span></span>
<span id="cb111-2"><a href="regression-analysis.html#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb111-3"><a href="regression-analysis.html#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions and compute the R2, RMSE and MAE</span></span>
<span id="cb111-4"><a href="regression-analysis.html#cb111-4" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> training_model <span class="sc">%&gt;%</span> <span class="fu">predict</span>(test_data)</span>
<span id="cb111-5"><a href="regression-analysis.html#cb111-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-6"><a href="regression-analysis.html#cb111-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>( <span class="at">R2 =</span> <span class="fu">R2</span>(predictions, test_data<span class="sc">$</span>sales),</span>
<span id="cb111-7"><a href="regression-analysis.html#cb111-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">RMSE =</span> <span class="fu">RMSE</span>(predictions, test_data<span class="sc">$</span>sales),</span>
<span id="cb111-8"><a href="regression-analysis.html#cb111-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">MAE =</span> <span class="fu">MAE</span>(predictions, test_data<span class="sc">$</span>sales))</span></code></pre></div>
<pre><code>##         R2     RMSE      MAE
## 1 0.318754 242.4139 189.1693</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="regression-analysis.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co">#We have an RMSE of 242, if the training model has a lower one, it fits better</span></span>
<span id="cb113-2"><a href="regression-analysis.html#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="regression-analysis.html#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="co">#We need to make image numeric for prediction purposes</span></span>
<span id="cb113-4"><a href="regression-analysis.html#cb113-4" aria-hidden="true" tabindex="-1"></a>training_data<span class="sc">$</span>image <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(training_data<span class="sc">$</span>image)</span>
<span id="cb113-5"><a href="regression-analysis.html#cb113-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-6"><a href="regression-analysis.html#cb113-6" aria-hidden="true" tabindex="-1"></a>predictions<span class="fl">.2</span> <span class="ot">&lt;-</span> training_model <span class="sc">%&gt;%</span> <span class="fu">predict</span>(training_data)</span>
<span id="cb113-7"><a href="regression-analysis.html#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>( <span class="at">R2 =</span> <span class="fu">R2</span>(predictions<span class="fl">.2</span>, training_data<span class="sc">$</span>sales),</span>
<span id="cb113-8"><a href="regression-analysis.html#cb113-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">RMSE =</span> <span class="fu">RMSE</span>(predictions<span class="fl">.2</span>, training_data<span class="sc">$</span>sales),</span>
<span id="cb113-9"><a href="regression-analysis.html#cb113-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">MAE =</span> <span class="fu">MAE</span>(predictions<span class="fl">.2</span>, training_data<span class="sc">$</span>sales))</span></code></pre></div>
<pre><code>##         R2     RMSE     MAE
## 1 0.390846 227.6169 167.243</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="regression-analysis.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co">#So, not very unexpectedly, we have better fit on this model. </span></span>
<span id="cb115-2"><a href="regression-analysis.html#cb115-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3"><a href="regression-analysis.html#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Let´s store some predictions for plotting</span></span>
<span id="cb115-4"><a href="regression-analysis.html#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Prediction on the training data</span></span>
<span id="cb115-5"><a href="regression-analysis.html#cb115-5" aria-hidden="true" tabindex="-1"></a>pred_train <span class="ot">&lt;-</span> training_model <span class="sc">%&gt;%</span> <span class="fu">predict</span>(z_training_data) </span>
<span id="cb115-6"><a href="regression-analysis.html#cb115-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Prediction on the test data </span></span>
<span id="cb115-7"><a href="regression-analysis.html#cb115-7" aria-hidden="true" tabindex="-1"></a>pred_test  <span class="ot">&lt;-</span> training_model <span class="sc">%&gt;%</span> <span class="fu">predict</span>(z_test_data) </span></code></pre></div>
<p>Let’s plot the predictions</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="regression-analysis.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co">#For reference, this is what a perfect prediction would look like </span></span>
<span id="cb116-2"><a href="regression-analysis.html#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(data), <span class="fu">aes</span>(sales))<span class="sc">+</span></span>
<span id="cb116-3"><a href="regression-analysis.html#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)<span class="sc">+</span></span>
<span id="cb116-4"><a href="regression-analysis.html#cb116-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span>sales, <span class="at">x =</span> sales), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb116-5"><a href="regression-analysis.html#cb116-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="at">label =</span> <span class="st">&#39;sales&#39;</span>)<span class="sc">+</span></span>
<span id="cb116-6"><a href="regression-analysis.html#cb116-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;perfect prediction&#39;</span>)<span class="sc">+</span></span>
<span id="cb116-7"><a href="regression-analysis.html#cb116-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="regression-analysis.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Training data prediction</span></span>
<span id="cb117-2"><a href="regression-analysis.html#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(z_training_data), <span class="fu">aes</span>(sales))<span class="sc">+</span></span>
<span id="cb117-3"><a href="regression-analysis.html#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)<span class="sc">+</span></span>
<span id="cb117-4"><a href="regression-analysis.html#cb117-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span>pred_train, <span class="at">x =</span> sales), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb117-5"><a href="regression-analysis.html#cb117-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="at">label =</span> <span class="st">&#39;model predicted sales&#39;</span>)<span class="sc">+</span></span>
<span id="cb117-6"><a href="regression-analysis.html#cb117-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-32-2.png" width="672" /></p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="regression-analysis.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co">#.</span></span></code></pre></div>
<p>This shows how well our model performs, the red line indicating perfect predictions that is, if we could estimate the number of sales perfectly. Which we clearly can’t, let´s look at our out of sample prediction.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="regression-analysis.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(z_test_data), <span class="fu">aes</span>(sales))<span class="sc">+</span></span>
<span id="cb119-2"><a href="regression-analysis.html#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)<span class="sc">+</span></span>
<span id="cb119-3"><a href="regression-analysis.html#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span>pred_test, <span class="at">x =</span> sales), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb119-4"><a href="regression-analysis.html#cb119-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="at">label =</span> <span class="st">&#39;model predicted sales&#39;</span>)<span class="sc">+</span></span>
<span id="cb119-5"><a href="regression-analysis.html#cb119-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="regression-analysis.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co">#.</span></span></code></pre></div>
<p>Let’s compare all the plots using the grid arrange function again</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="regression-analysis.html#cb121-1" aria-hidden="true" tabindex="-1"></a>perfect_pred <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="fu">scale</span>(data)), <span class="fu">aes</span>(sales))<span class="sc">+</span></span>
<span id="cb121-2"><a href="regression-analysis.html#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)<span class="sc">+</span></span>
<span id="cb121-3"><a href="regression-analysis.html#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span>sales, <span class="at">x =</span> sales), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb121-4"><a href="regression-analysis.html#cb121-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="at">label =</span> <span class="st">&#39;sales&#39;</span>)<span class="sc">+</span></span>
<span id="cb121-5"><a href="regression-analysis.html#cb121-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;perfect prediction&#39;</span>)<span class="sc">+</span></span>
<span id="cb121-6"><a href="regression-analysis.html#cb121-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb121-7"><a href="regression-analysis.html#cb121-7" aria-hidden="true" tabindex="-1"></a>insample_pred <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(z_training_data), <span class="fu">aes</span>(sales))<span class="sc">+</span></span>
<span id="cb121-8"><a href="regression-analysis.html#cb121-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)<span class="sc">+</span></span>
<span id="cb121-9"><a href="regression-analysis.html#cb121-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span>pred_train, <span class="at">x =</span> sales), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb121-10"><a href="regression-analysis.html#cb121-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="at">label =</span> <span class="st">&#39;predicted sales&#39;</span>)<span class="sc">+</span></span>
<span id="cb121-11"><a href="regression-analysis.html#cb121-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;insample prediction&#39;</span>)<span class="sc">+</span></span>
<span id="cb121-12"><a href="regression-analysis.html#cb121-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb121-13"><a href="regression-analysis.html#cb121-13" aria-hidden="true" tabindex="-1"></a>outsample_pred <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(z_test_data), <span class="fu">aes</span>(sales))<span class="sc">+</span></span>
<span id="cb121-14"><a href="regression-analysis.html#cb121-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)<span class="sc">+</span></span>
<span id="cb121-15"><a href="regression-analysis.html#cb121-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span>pred_test, <span class="at">x =</span> sales), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb121-16"><a href="regression-analysis.html#cb121-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="at">label =</span> <span class="st">&#39;predicted sales&#39;</span>)<span class="sc">+</span></span>
<span id="cb121-17"><a href="regression-analysis.html#cb121-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;out of sample prediction&#39;</span>)<span class="sc">+</span></span>
<span id="cb121-18"><a href="regression-analysis.html#cb121-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb121-19"><a href="regression-analysis.html#cb121-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-20"><a href="regression-analysis.html#cb121-20" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(perfect_pred, insample_pred, outsample_pred)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="regression-analysis.html#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This last piece of code compiles the graphs </span></span></code></pre></div>
<p>And there we have it, this model seems pretty good. Nothing amazing, but pretty good. In “reality” out of sample predictions are usually worse, but since we have such a simple model with reasonable dependent variables, this is not that unexpected. We certainly dont have issues with over-fitting our model, which can cause it to make poor out of sample predictions.</p>
<p>In this chapter we have gone through a little bit of everything, we have some prediction some moderation some cross validation and of course the simple regression analysis. In future chapters we will take a closer look at all of these methods, if you want to have a more “real” example of regression check out the last chapter where we use real messy data for various analyses.</p>
</div>
<div id="the-general-linear-model-anova" class="section level2 hasAnchor" number="9.2">
<h2><span class="header-section-number">9.2</span> The general linear model (ANOVA)<a href="regression-analysis.html#the-general-linear-model-anova" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="the-generalized-linear-modellogit" class="section level2 hasAnchor" number="9.3">
<h2><span class="header-section-number">9.3</span> The generalized linear model(logit)<a href="regression-analysis.html#the-generalized-linear-modellogit" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="cross-validation" class="section level2 hasAnchor" number="9.4">
<h2><span class="header-section-number">9.4</span> Cross validation<a href="regression-analysis.html#cross-validation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="lasso-least-absolute-shrinkage-and-selection-operator" class="section level2 hasAnchor" number="9.5">
<h2><span class="header-section-number">9.5</span> LASSO (least absolute shrinkage and selection operator)<a href="regression-analysis.html#lasso-least-absolute-shrinkage-and-selection-operator" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="ridge-regression" class="section level2 hasAnchor" number="9.6">
<h2><span class="header-section-number">9.6</span> Ridge regression<a href="regression-analysis.html#ridge-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="fully-bayesian-regression" class="section level2 hasAnchor" number="9.7">
<h2><span class="header-section-number">9.7</span> Fully Bayesian regression<a href="regression-analysis.html#fully-bayesian-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="poststratification" class="section level2 hasAnchor" number="9.8">
<h2><span class="header-section-number">9.8</span> Poststratification<a href="regression-analysis.html#poststratification" class="anchor-section" aria-label="Anchor link to header"></a></h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="correlation-and-covariation-in-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="path-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/AlfonsEdmar/StatsBook/edit/master/08.Regression_analysis.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/AlfonsEdmar/StatsBook/blob/master/08.Regression_analysis.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
