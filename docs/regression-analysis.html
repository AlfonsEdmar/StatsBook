<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9 Regression analysis | Not yet decided</title>
  <meta name="description" content="9 Regression analysis | Not yet decided" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="9 Regression analysis | Not yet decided" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 Regression analysis | Not yet decided" />
  
  
  

<meta name="author" content="B. Alfons Edmar" />


<meta name="date" content="2022-07-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="correlation-and-covariation-in-r.html"/>
<link rel="next" href="path-analysis.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">StatsBook</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Table of contents</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#foreword"><i class="fa fa-check"></i><b>2.1</b> Foreword</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#the-grain-of-salt"><i class="fa fa-check"></i><b>2.2</b> The grain of salt</a></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#some-useful-resources"><i class="fa fa-check"></i><b>2.3</b> Some useful resources</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="welcome-to-r.html"><a href="welcome-to-r.html"><i class="fa fa-check"></i><b>3</b> Welcome to R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="welcome-to-r.html"><a href="welcome-to-r.html#the-r-environment"><i class="fa fa-check"></i><b>3.1</b> The R environment</a></li>
<li class="chapter" data-level="3.2" data-path="welcome-to-r.html"><a href="welcome-to-r.html#basic-programming"><i class="fa fa-check"></i><b>3.2</b> Basic programming</a></li>
<li class="chapter" data-level="3.3" data-path="welcome-to-r.html"><a href="welcome-to-r.html#organisation"><i class="fa fa-check"></i><b>3.3</b> Organisation</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="welcome-to-r.html"><a href="welcome-to-r.html#projects"><i class="fa fa-check"></i><b>3.3.1</b> Projects</a></li>
<li class="chapter" data-level="3.3.2" data-path="welcome-to-r.html"><a href="welcome-to-r.html#rmarkdown"><i class="fa fa-check"></i><b>3.3.2</b> Rmarkdown</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="what-i-expect-you-to-know.html"><a href="what-i-expect-you-to-know.html"><i class="fa fa-check"></i><b>4</b> What I expect you to know</a>
<ul>
<li class="chapter" data-level="4.1" data-path="what-i-expect-you-to-know.html"><a href="what-i-expect-you-to-know.html#descriptive-statistics"><i class="fa fa-check"></i><b>4.1</b> Descriptive statistics</a></li>
<li class="chapter" data-level="4.2" data-path="what-i-expect-you-to-know.html"><a href="what-i-expect-you-to-know.html#basic-null-hypothesis-testing"><i class="fa fa-check"></i><b>4.2</b> Basic null hypothesis testing</a></li>
<li class="chapter" data-level="4.3" data-path="what-i-expect-you-to-know.html"><a href="what-i-expect-you-to-know.html#statistical-phenomena"><i class="fa fa-check"></i><b>4.3</b> Statistical phenomena</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="useful-packages-and-functions-that-helped-me-learn.html"><a href="useful-packages-and-functions-that-helped-me-learn.html"><i class="fa fa-check"></i><b>5</b> Useful packages and functions that helped me learn</a>
<ul>
<li class="chapter" data-level="5.1" data-path="useful-packages-and-functions-that-helped-me-learn.html"><a href="useful-packages-and-functions-that-helped-me-learn.html#tidyverse"><i class="fa fa-check"></i><b>5.1</b> Tidyverse</a></li>
<li class="chapter" data-level="5.2" data-path="useful-packages-and-functions-that-helped-me-learn.html"><a href="useful-packages-and-functions-that-helped-me-learn.html#distribution-functions---rnorm-dbeta-rbinom-etc"><i class="fa fa-check"></i><b>5.2</b> Distribution functions - rnorm, dbeta, rbinom etc</a></li>
<li class="chapter" data-level="5.3" data-path="useful-packages-and-functions-that-helped-me-learn.html"><a href="useful-packages-and-functions-that-helped-me-learn.html#faux"><i class="fa fa-check"></i><b>5.3</b> Faux</a></li>
<li class="chapter" data-level="5.4" data-path="useful-packages-and-functions-that-helped-me-learn.html"><a href="useful-packages-and-functions-that-helped-me-learn.html#lm"><i class="fa fa-check"></i><b>5.4</b> lm</a></li>
<li class="chapter" data-level="5.5" data-path="useful-packages-and-functions-that-helped-me-learn.html"><a href="useful-packages-and-functions-that-helped-me-learn.html#lavaan"><i class="fa fa-check"></i><b>5.5</b> Lavaan</a></li>
<li class="chapter" data-level="5.6" data-path="useful-packages-and-functions-that-helped-me-learn.html"><a href="useful-packages-and-functions-that-helped-me-learn.html#semplot"><i class="fa fa-check"></i><b>5.6</b> semPlot</a></li>
<li class="chapter" data-level="5.7" data-path="useful-packages-and-functions-that-helped-me-learn.html"><a href="useful-packages-and-functions-that-helped-me-learn.html#section"><i class="fa fa-check"></i><b>5.7</b> ?</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="bayesian-and-frequentists-statistics.html"><a href="bayesian-and-frequentists-statistics.html"><i class="fa fa-check"></i><b>6</b> Bayesian and Frequentists statistics</a>
<ul>
<li class="chapter" data-level="6.1" data-path="bayesian-and-frequentists-statistics.html"><a href="bayesian-and-frequentists-statistics.html#likelihood-functions"><i class="fa fa-check"></i><b>6.1</b> Likelihood functions</a></li>
<li class="chapter" data-level="6.2" data-path="bayesian-and-frequentists-statistics.html"><a href="bayesian-and-frequentists-statistics.html#density-distributes"><i class="fa fa-check"></i><b>6.2</b> Density distributes</a></li>
<li class="chapter" data-level="6.3" data-path="bayesian-and-frequentists-statistics.html"><a href="bayesian-and-frequentists-statistics.html#all-hail-the-almighty-gauss"><i class="fa fa-check"></i><b>6.3</b> All hail the almighty Gauss</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="non-parametric-statistics.html"><a href="non-parametric-statistics.html"><i class="fa fa-check"></i><b>7</b> Non-parametric statistics</a>
<ul>
<li class="chapter" data-level="7.1" data-path="non-parametric-statistics.html"><a href="non-parametric-statistics.html#asking-all-the-question-making-statements-and-assuming"><i class="fa fa-check"></i><b>7.1</b> Asking all the question, making statements, and assuming</a></li>
<li class="chapter" data-level="7.2" data-path="non-parametric-statistics.html"><a href="non-parametric-statistics.html#the-old-guard"><i class="fa fa-check"></i><b>7.2</b> The old guard</a></li>
<li class="chapter" data-level="7.3" data-path="non-parametric-statistics.html"><a href="non-parametric-statistics.html#bootstrapping"><i class="fa fa-check"></i><b>7.3</b> Bootstrapping</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="correlation-and-covariation-in-r.html"><a href="correlation-and-covariation-in-r.html"><i class="fa fa-check"></i><b>8</b> Correlation and Covariation in R</a>
<ul>
<li class="chapter" data-level="8.1" data-path="correlation-and-covariation-in-r.html"><a href="correlation-and-covariation-in-r.html#welcome-to-the-matrix"><i class="fa fa-check"></i><b>8.1</b> Welcome to the matrix</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="regression-analysis.html"><a href="regression-analysis.html"><i class="fa fa-check"></i><b>9</b> Regression analysis</a>
<ul>
<li class="chapter" data-level="9.1" data-path="regression-analysis.html"><a href="regression-analysis.html#univariate-regression-and-multiple-regression"><i class="fa fa-check"></i><b>9.1</b> Univariate regression and multiple regression</a></li>
<li class="chapter" data-level="9.2" data-path="regression-analysis.html"><a href="regression-analysis.html#comparing-means"><i class="fa fa-check"></i><b>9.2</b> Comparing means</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="regression-analysis.html"><a href="regression-analysis.html#a-primer-on-means-and-effect-sizes-with-simulation"><i class="fa fa-check"></i><b>9.2.1</b> A primer on means and effect sizes with simulation</a></li>
<li class="chapter" data-level="9.2.2" data-path="regression-analysis.html"><a href="regression-analysis.html#anova"><i class="fa fa-check"></i><b>9.2.2</b> ANOVA</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="regression-analysis.html"><a href="regression-analysis.html#the-generalized-linear-modellogit"><i class="fa fa-check"></i><b>9.3</b> The generalized linear model(logit)</a></li>
<li class="chapter" data-level="9.4" data-path="regression-analysis.html"><a href="regression-analysis.html#cross-validation"><i class="fa fa-check"></i><b>9.4</b> Cross validation</a></li>
<li class="chapter" data-level="9.5" data-path="regression-analysis.html"><a href="regression-analysis.html#lasso-least-absolute-shrinkage-and-selection-operator"><i class="fa fa-check"></i><b>9.5</b> LASSO (least absolute shrinkage and selection operator)</a></li>
<li class="chapter" data-level="9.6" data-path="regression-analysis.html"><a href="regression-analysis.html#ridge-regression"><i class="fa fa-check"></i><b>9.6</b> Ridge regression</a></li>
<li class="chapter" data-level="9.7" data-path="regression-analysis.html"><a href="regression-analysis.html#fully-bayesian-regression"><i class="fa fa-check"></i><b>9.7</b> Fully Bayesian regression</a></li>
<li class="chapter" data-level="9.8" data-path="regression-analysis.html"><a href="regression-analysis.html#poststratification"><i class="fa fa-check"></i><b>9.8</b> Poststratification</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="path-analysis.html"><a href="path-analysis.html"><i class="fa fa-check"></i><b>10</b> Path analysis</a>
<ul>
<li class="chapter" data-level="10.1" data-path="path-analysis.html"><a href="path-analysis.html#streiner2005"><i class="fa fa-check"></i><b>10.1</b> Streiner(2005)</a></li>
<li class="chapter" data-level="10.2" data-path="path-analysis.html"><a href="path-analysis.html#workshop-analysis"><i class="fa fa-check"></i><b>10.2</b> workshop analysis</a></li>
<li class="chapter" data-level="10.3" data-path="path-analysis.html"><a href="path-analysis.html#multiple-regressionagain"><i class="fa fa-check"></i><b>10.3</b> Multiple regression(again)</a></li>
<li class="chapter" data-level="10.4" data-path="path-analysis.html"><a href="path-analysis.html#mediation-analysis"><i class="fa fa-check"></i><b>10.4</b> Mediation analysis</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="exploratory-factor-analysis-efa.html"><a href="exploratory-factor-analysis-efa.html"><i class="fa fa-check"></i><b>11</b> Exploratory factor analysis (EFA)</a></li>
<li class="chapter" data-level="12" data-path="multi-level-modelling.html"><a href="multi-level-modelling.html"><i class="fa fa-check"></i><b>12</b> Multi-level modelling</a></li>
<li class="chapter" data-level="13" data-path="structural-equation-modelling.html"><a href="structural-equation-modelling.html"><i class="fa fa-check"></i><b>13</b> Structural equation modelling</a></li>
<li class="chapter" data-level="14" data-path="meta-analysis.html"><a href="meta-analysis.html"><i class="fa fa-check"></i><b>14</b> Meta-analysis</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Not yet decided</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="regression-analysis" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">9</span> Regression analysis<a href="regression-analysis.html#regression-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="univariate-regression-and-multiple-regression" class="section level2 hasAnchor" number="9.1">
<h2><span class="header-section-number">9.1</span> Univariate regression and multiple regression<a href="regression-analysis.html#univariate-regression-and-multiple-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Packages need to follow along with the code, special packages will be loaded when and if needed.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="regression-analysis.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb44-2"><a href="regression-analysis.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb44-3"><a href="regression-analysis.html#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb44-4"><a href="regression-analysis.html#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span></code></pre></div>
<p>Regression is not always easily visualised. This here is a function that will visualise a univariate slope along with some of the most important measurements. This is a slight adaption from a function I found here: <a href="https://sejohnston.com/2012/08/09/a-quick-and-easy-function-to-plot-lm-results-in-r/" class="uri">https://sejohnston.com/2012/08/09/a-quick-and-easy-function-to-plot-lm-results-in-r/</a></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="regression-analysis.html#cb45-1" aria-hidden="true" tabindex="-1"></a>regplot <span class="ot">&lt;-</span> <span class="cf">function</span> (fit, name) {</span>
<span id="cb45-2"><a href="regression-analysis.html#cb45-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-3"><a href="regression-analysis.html#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(fit<span class="sc">$</span>model, <span class="fu">aes_string</span>(<span class="at">x =</span> <span class="fu">names</span>(fit<span class="sc">$</span>model)[<span class="dv">2</span>], <span class="at">y =</span> <span class="fu">names</span>(fit<span class="sc">$</span>model)[<span class="dv">1</span>])) <span class="sc">+</span> </span>
<span id="cb45-4"><a href="regression-analysis.html#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>( <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb45-5"><a href="regression-analysis.html#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span></span>
<span id="cb45-6"><a href="regression-analysis.html#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> name, <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Adj R2 = &quot;</span>,<span class="fu">signif</span>(<span class="fu">summary</span>(fit)<span class="sc">$</span>adj.r.squared, <span class="dv">5</span>),</span>
<span id="cb45-7"><a href="regression-analysis.html#cb45-7" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;Intercept =&quot;</span>,<span class="fu">signif</span>(fit<span class="sc">$</span>coef[[<span class="dv">1</span>]],<span class="dv">5</span> ),</span>
<span id="cb45-8"><a href="regression-analysis.html#cb45-8" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot; Slope =&quot;</span>,<span class="fu">signif</span>(fit<span class="sc">$</span>coef[[<span class="dv">2</span>]], <span class="dv">5</span>),</span>
<span id="cb45-9"><a href="regression-analysis.html#cb45-9" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot; P =&quot;</span>,<span class="fu">signif</span>(<span class="fu">summary</span>(fit)<span class="sc">$</span>coef[<span class="dv">4</span>], <span class="dv">5</span>)))<span class="sc">+</span></span>
<span id="cb45-10"><a href="regression-analysis.html#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb45-11"><a href="regression-analysis.html#cb45-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-12"><a href="regression-analysis.html#cb45-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Field uses data from album sales. When loading data in r the best way is to put your data files in an easy to access place - note that this is my path, the data file is album sales from chapter 8 or 9 depending on edition so load that.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="regression-analysis.html#cb46-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="st">&quot;Album Sales.sav&quot;</span>)</span>
<span id="cb46-2"><a href="regression-analysis.html#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="regression-analysis.html#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Let´s change the names to low caps so we can type easily. </span></span>
<span id="cb46-4"><a href="regression-analysis.html#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;adverts&#39;</span>, <span class="st">&#39;sales&#39;</span>, <span class="st">&#39;airplay&#39;</span>, <span class="st">&#39;image&#39;</span>)</span>
<span id="cb46-5"><a href="regression-analysis.html#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Taking a peek at the data</span></span>
<span id="cb46-6"><a href="regression-analysis.html#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   adverts sales airplay image
##     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1    10.3   330      43    10
## 2   986.    120      28     7
## 3  1446.    360      35     7
## 4  1188.    270      33     7
## 5   575.    220      44     5
## 6   569.    170      19     5</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="regression-analysis.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span></code></pre></div>
<pre><code>##     adverts             sales          airplay          image      
##  Min.   :   9.104   Min.   : 10.0   Min.   : 0.00   Min.   : 1.00  
##  1st Qu.: 215.918   1st Qu.:137.5   1st Qu.:19.75   1st Qu.: 6.00  
##  Median : 531.916   Median :200.0   Median :28.00   Median : 7.00  
##  Mean   : 614.412   Mean   :193.2   Mean   :27.50   Mean   : 6.77  
##  3rd Qu.: 911.226   3rd Qu.:250.0   3rd Qu.:36.00   3rd Qu.: 8.00  
##  Max.   :2271.860   Max.   :360.0   Max.   :63.00   Max.   :10.00</code></pre>
<p>All variables are treated as numerical. Before any formal analysis can be pursued, we should first visually inspect the variables.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="regression-analysis.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">#I usually prefer histograms without density curves but let’s use them both to visualise the distribution of our data. </span></span>
<span id="cb50-2"><a href="regression-analysis.html#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(adverts))<span class="sc">+</span></span>
<span id="cb50-3"><a href="regression-analysis.html#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">color =</span> <span class="st">&#39;steelblue&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb50-4"><a href="regression-analysis.html#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="regression-analysis.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(sales))<span class="sc">+</span></span>
<span id="cb51-2"><a href="regression-analysis.html#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">color =</span> <span class="st">&#39;steelblue&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb51-3"><a href="regression-analysis.html#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-17-2.png" width="672" /></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="regression-analysis.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(airplay))<span class="sc">+</span></span>
<span id="cb52-2"><a href="regression-analysis.html#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">color =</span> <span class="st">&#39;steelblue&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb52-3"><a href="regression-analysis.html#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-17-3.png" width="672" /></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="regression-analysis.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(image))<span class="sc">+</span></span>
<span id="cb53-2"><a href="regression-analysis.html#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">color =</span> <span class="st">&#39;steelblue&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb53-3"><a href="regression-analysis.html#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-17-4.png" width="672" /></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="regression-analysis.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#looks pretty good, the ..density.. call is what gives the curve. </span></span></code></pre></div>
<p>So this is what we are working with, our IVs don’t need to be normal, the residuals need to be normal however. We don’t want heteroskedasticity. The neat thing with having multiple continuous variables is that it opens up plotting possibilities. Let’s make some graphs</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="regression-analysis.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data,  <span class="fu">aes</span>(<span class="at">y =</span> sales, <span class="at">x =</span> adverts</span>
<span id="cb55-2"><a href="regression-analysis.html#cb55-2" aria-hidden="true" tabindex="-1"></a>                         , <span class="at">size =</span> image, <span class="at">colour =</span> airplay))<span class="sc">+</span></span>
<span id="cb55-3"><a href="regression-analysis.html#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb55-4"><a href="regression-analysis.html#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="regression-analysis.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#It is a bit messy, lets clean our plot by colouring by image. Let’s first colour by images that’s less than 5</span></span>
<span id="cb56-2"><a href="regression-analysis.html#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data,  <span class="fu">aes</span>(<span class="at">y =</span> sales, <span class="at">x =</span> adverts</span>
<span id="cb56-3"><a href="regression-analysis.html#cb56-3" aria-hidden="true" tabindex="-1"></a>                         , <span class="at">size =</span> airplay, <span class="at">colour =</span> image <span class="sc">&lt;</span> <span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb56-4"><a href="regression-analysis.html#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb56-5"><a href="regression-analysis.html#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-18-2.png" width="672" /></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="regression-analysis.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">#interesting, most bands have an image at 5 or above, and those that don’t do not sell well regardless of their advert budget or image (the size of the points are roughly the same). Let’s colour by image &lt;8</span></span>
<span id="cb57-2"><a href="regression-analysis.html#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data,  <span class="fu">aes</span>(<span class="at">y =</span> sales, <span class="at">x =</span> adverts</span>
<span id="cb57-3"><a href="regression-analysis.html#cb57-3" aria-hidden="true" tabindex="-1"></a>                         , <span class="at">size =</span> airplay, <span class="at">colour =</span> image <span class="sc">&lt;</span> <span class="dv">8</span>))<span class="sc">+</span></span>
<span id="cb57-4"><a href="regression-analysis.html#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb57-5"><a href="regression-analysis.html#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-18-3.png" width="672" /></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="regression-analysis.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Pretty graphs right? </span></span></code></pre></div>
<p>This is a better spread. But we can see that image does not seem to impact sales that much. There seems to be an effect, however. The most interesting thing with this graph however is that a high advert budget more or less promises good sales. No band with a budget less than 1 000 000 pounds have less than 100 000 album sales. A crude heuristic for bands wanting to fund their adverts with album sales could be to not sell their album for less than 10£. But this is of course bad advice. We have no information on the cost of the albums and sales are most likely affected by the cost of the album. Nevertheless, this is a fun graph.</p>
<p>Let’s make image into a factor so we can split our graphs better using the facet_wrap function</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="regression-analysis.html#cb59-1" aria-hidden="true" tabindex="-1"></a>plotdata <span class="ot">&lt;-</span> data</span>
<span id="cb59-2"><a href="regression-analysis.html#cb59-2" aria-hidden="true" tabindex="-1"></a>plotdata<span class="sc">$</span>image <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(plotdata<span class="sc">$</span>image)</span>
<span id="cb59-3"><a href="regression-analysis.html#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Now image is a factor with to levels. Let’s use the image of the band as colour</span></span>
<span id="cb59-4"><a href="regression-analysis.html#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> plotdata,  <span class="fu">aes</span>(<span class="at">y =</span> sales, <span class="at">x =</span> adverts</span>
<span id="cb59-5"><a href="regression-analysis.html#cb59-5" aria-hidden="true" tabindex="-1"></a>                         , <span class="at">size =</span> airplay, <span class="at">colour =</span> image))<span class="sc">+</span></span>
<span id="cb59-6"><a href="regression-analysis.html#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb59-7"><a href="regression-analysis.html#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>image)<span class="sc">+</span></span>
<span id="cb59-8"><a href="regression-analysis.html#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="regression-analysis.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Or</span></span>
<span id="cb60-2"><a href="regression-analysis.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> plotdata,  <span class="fu">aes</span>(<span class="at">y =</span> sales, <span class="at">x =</span> adverts</span>
<span id="cb60-3"><a href="regression-analysis.html#cb60-3" aria-hidden="true" tabindex="-1"></a>                             , <span class="at">colour =</span> airplay))<span class="sc">+</span></span>
<span id="cb60-4"><a href="regression-analysis.html#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb60-5"><a href="regression-analysis.html#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>image)<span class="sc">+</span></span>
<span id="cb60-6"><a href="regression-analysis.html#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-19-2.png" width="672" /></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="regression-analysis.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Note that one graph colours airplay while the other image</span></span></code></pre></div>
<p>Another interesting graph. Interestingly we can see that the band with the highest image has no advert budget. However, very few bands with that high image exists. The main idea this graph gives is that the slope between sales and advert budget does not seem to depend heavily on the image of the band. However, bands with low image often have less advert budget - and less sales. we can also see a relationship between airplay and sales, bigger points are usually a bit higher up on sales than small points.</p>
<p>So what are our expectations given the graphs? we should expect an effect of image airplay and adverts on sales, but there will probably not be any meaningful interactions between them since no relationship was observable in the graphs. let’s see if this holds up.</p>
<p>our first model is a simple regression of adverts on album sales. We would expect more sales with more advert budget take a look at the lm function for syntax and code reference.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="regression-analysis.html#cb62-1" aria-hidden="true" tabindex="-1"></a>?lm</span>
<span id="cb62-2"><a href="regression-analysis.html#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co">#fitting the model</span></span>
<span id="cb62-3"><a href="regression-analysis.html#cb62-3" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sales <span class="sc">~</span> adverts, <span class="at">data =</span> data)</span></code></pre></div>
<p>One of the most important things we have to do when analysing data using statistical methods is checking that our assumptions for our method holds.
For regression that: normality of residuals, independent errors, no multicollinearity, and homogeneity of variance in the residuals. Let’s check these things out.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="regression-analysis.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking the residuals and normality assumption</span></span>
<span id="cb63-2"><a href="regression-analysis.html#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">predict.lm</span>(m1), <span class="at">x =</span> m1<span class="sc">$</span>residuals))<span class="sc">+</span></span>
<span id="cb63-3"><a href="regression-analysis.html#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb63-4"><a href="regression-analysis.html#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="regression-analysis.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Nice, the predicted values of our model is distributed quite normally across the residuals. This indicates that the variation in our model is roughly equal on low, medium, and high point estimates. We can also check the density of the</span></span>
<span id="cb64-2"><a href="regression-analysis.html#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="regression-analysis.html#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Residuals - they should be normal around 0. </span></span>
<span id="cb64-4"><a href="regression-analysis.html#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> m1<span class="sc">$</span>residuals))<span class="sc">+</span></span>
<span id="cb64-5"><a href="regression-analysis.html#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-21-2.png" width="672" /></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="regression-analysis.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> m1<span class="sc">$</span>residuals))<span class="sc">+</span></span>
<span id="cb65-2"><a href="regression-analysis.html#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">colour =</span> <span class="st">&#39;steelblue&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-21-3.png" width="672" /></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="regression-analysis.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Nice, this means that our error in measurement isn’t systematically lower or higher than our fitted model. </span></span>
<span id="cb66-2"><a href="regression-analysis.html#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="regression-analysis.html#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking error independence with Durbin Watson test</span></span>
<span id="cb66-4"><a href="regression-analysis.html#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">durbinWatsonTest</span>(m1)</span></code></pre></div>
<pre><code>##  lag Autocorrelation D-W Statistic p-value
##    1     -0.04394305      2.032324   0.772
##  Alternative hypothesis: rho != 0</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="regression-analysis.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Nice, the p-value is insignificant and the test-statistic is close to 2.</span></span></code></pre></div>
<p>Now that we have checked our assumptions and have a good ground to stand on, we can check the fit of our model.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="regression-analysis.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking the fit of the model </span></span>
<span id="cb69-2"><a href="regression-analysis.html#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.lm</span>(m1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = sales ~ adverts, data = data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -152.949  -43.796   -0.393   37.040  211.866 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 1.341e+02  7.537e+00  17.799   &lt;2e-16 ***
## adverts     9.612e-02  9.632e-03   9.979   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 65.99 on 198 degrees of freedom
## Multiple R-squared:  0.3346, Adjusted R-squared:  0.3313 
## F-statistic: 99.59 on 1 and 198 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="regression-analysis.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Lets plot this manually in ggplot using geom_smooth, on our model</span></span>
<span id="cb71-2"><a href="regression-analysis.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">y =</span> sales, <span class="at">x =</span> adverts))<span class="sc">+</span></span>
<span id="cb71-3"><a href="regression-analysis.html#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb71-4"><a href="regression-analysis.html#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>)<span class="sc">+</span></span>
<span id="cb71-5"><a href="regression-analysis.html#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="regression-analysis.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Geom smooth fits a linear model to the data, method = &#39;lm&#39; tells it that it’s a linear model. </span></span></code></pre></div>
<p>And there we have it, but by using the regplot function we created above we can put some of the info from the model on the plot.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="regression-analysis.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">regplot</span>(m1, <span class="st">&#39;m1&#39;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="regression-analysis.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.lm</span>(m1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = sales ~ adverts, data = data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -152.949  -43.796   -0.393   37.040  211.866 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 1.341e+02  7.537e+00  17.799   &lt;2e-16 ***
## adverts     9.612e-02  9.632e-03   9.979   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 65.99 on 198 degrees of freedom
## Multiple R-squared:  0.3346, Adjusted R-squared:  0.3313 
## F-statistic: 99.59 on 1 and 198 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="regression-analysis.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Nice graph with good info :) </span></span></code></pre></div>
<p>Pretty neat right? now, what can we make of this? the slope estimates of ca 0.1 indicates that sales increase by .1 for every unit of adverts. The equates to roughly 100 sales per thousand pounds in advertising budget.
Also, note the shaded line. This is our marginal 95% confidence interval. We can see that our uncertainty in the parameter estimate increases at the mode extreme values since we don’t have a lot of data regarding the dispersion on those levels of “adverts”.</p>
<p>We should also check for influential cases analytically, not just visually. we can do this with the function “lm.influence”.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="regression-analysis.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">influence.measures</span>(m1))</span></code></pre></div>
<pre><code>## Potentially influential observations of
##   lm(formula = sales ~ adverts, data = data) :
## 
##     dfb.1_ dfb.advr dffit   cov.r   cook.d hat    
## 1    0.35  -0.27     0.35_*  0.93_*  0.06   0.01  
## 10   0.22  -0.15     0.22    0.97_*  0.02   0.01  
## 11   0.01  -0.02    -0.03    1.04_*  0.00   0.03_*
## 23  -0.02   0.04     0.04    1.05_*  0.00   0.03_*
## 42   0.29  -0.22     0.29    0.95_*  0.04   0.01  
## 43  -0.02   0.04     0.05    1.06_*  0.00   0.05_*
## 75  -0.02   0.04     0.05    1.03_*  0.00   0.02  
## 87  -0.06   0.11     0.12    1.05_*  0.01   0.05_*
## 88   0.02  -0.03    -0.03    1.05_*  0.00   0.04_*
## 92  -0.01   0.01     0.01    1.03_*  0.00   0.02  
## 93  -0.01   0.03     0.03    1.04_*  0.00   0.03  
## 113 -0.13   0.04    -0.17    0.96_*  0.01   0.01  
## 124  0.09   0.02     0.18    0.96_*  0.02   0.01  
## 126  0.05  -0.10    -0.11    1.03_*  0.01   0.02  
## 169  0.32  -0.23     0.33_*  0.92_*  0.05   0.01  
## 175  0.03  -0.07    -0.08    1.03_*  0.00   0.02  
## 184  0.08  -0.13    -0.13    1.08_*  0.01   0.06_*</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="regression-analysis.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">cooks.distance</span>(m1))</span></code></pre></div>
<pre><code>##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
## 3.000e-08 3.380e-04 1.576e-03 4.416e-03 6.314e-03 5.716e-02</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="regression-analysis.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">#let’s look at the hat values manually </span></span>
<span id="cb81-2"><a href="regression-analysis.html#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">hatvalues</span>(m1))</span></code></pre></div>
<pre><code>##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## 0.005000 0.005732 0.008030 0.010000 0.011305 0.063529</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="regression-analysis.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hatvalues</span>(m1)<span class="sc">%&gt;%</span> <span class="fu">sort.default</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">20</span>) </span></code></pre></div>
<pre><code>##        184         43         87         88         23         11         93        126 
## 0.06352892 0.04590335 0.04502948 0.03687259 0.03442720 0.03108016 0.02569576 0.02435532 
##        175         28         55         46         62         75        199         92 
## 0.02353610 0.02344638 0.02334463 0.02201132 0.02170914 0.02170914 0.02170914 0.01997151 
##          3        128         20        102 
## 0.01971805 0.01894939 0.01751014 0.01656749</code></pre>
<p>Going by cooks distance we don’t seem to have any very influential values, that is, values exceeding 1. However, we have some values that exceeds three times the leverage or hatvalues. if we go by hoaglin and welch guides of looking at values exceeding three times the average, that is values exceeding .03. that is, observation 11, 23, 88, 87, 43 and 184. What happens if we remove them?</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="regression-analysis.html#cb85-1" aria-hidden="true" tabindex="-1"></a>clean_data <span class="ot">&lt;-</span> <span class="fu">slice</span>(data, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">23</span>, <span class="dv">88</span>, <span class="dv">87</span>, <span class="dv">43</span>, <span class="dv">184</span>))</span>
<span id="cb85-2"><a href="regression-analysis.html#cb85-2" aria-hidden="true" tabindex="-1"></a>clean_m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sales<span class="sc">~</span>adverts, clean_data)</span>
<span id="cb85-3"><a href="regression-analysis.html#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="fu">regplot</span>(clean_m1, <span class="st">&#39;clean m1&#39;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="regression-analysis.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.lm</span>(clean_m1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = sales ~ adverts, data = clean_data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -152.910  -44.484   -0.291   38.368  211.845 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 134.18426    8.00113  16.771  &lt; 2e-16 ***
## adverts       0.09596    0.01116   8.602 2.76e-15 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 66.9 on 192 degrees of freedom
## Multiple R-squared:  0.2782, Adjusted R-squared:  0.2744 
## F-statistic: 73.99 on 1 and 192 DF,  p-value: 2.763e-15</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="regression-analysis.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co">#.</span></span></code></pre></div>
<p>Does not change much in terms of estimation. We can compare the graphs using the grid arrange function from the gridExtra package</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="regression-analysis.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb89-2"><a href="regression-analysis.html#cb89-2" aria-hidden="true" tabindex="-1"></a>m1_plot <span class="ot">&lt;-</span> <span class="fu">regplot</span>(m1, <span class="st">&#39;original model&#39;</span>)</span>
<span id="cb89-3"><a href="regression-analysis.html#cb89-3" aria-hidden="true" tabindex="-1"></a>clean_m1_plot <span class="ot">&lt;-</span> <span class="fu">regplot</span>(clean_m1, <span class="st">&#39;influential observations removed&#39;</span>)</span>
<span id="cb89-4"><a href="regression-analysis.html#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(m1_plot, clean_m1_plot, <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&#39;original&#39;</span>, <span class="st">&#39;clean&#39;</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="regression-analysis.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co">#.</span></span></code></pre></div>
<p>Here we can easily see that the influential observations were the cases with very high advertising budgets. it might be prudent to use the updated model, but no model is “better” than the other. We should use the model that helps us answer our research question best - “horses for courses”</p>
<p>A fast way, but less pleasing and not as hands on, is to simply use the “plot” function. It gives much of the same information</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="regression-analysis.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m1)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-27-1.png" width="672" /><img src="bookdownproj_files/figure-html/unnamed-chunk-27-2.png" width="672" /><img src="bookdownproj_files/figure-html/unnamed-chunk-27-3.png" width="672" /><img src="bookdownproj_files/figure-html/unnamed-chunk-27-4.png" width="672" /></p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="regression-analysis.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(clean_m1)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-27-5.png" width="672" /><img src="bookdownproj_files/figure-html/unnamed-chunk-27-6.png" width="672" /><img src="bookdownproj_files/figure-html/unnamed-chunk-27-7.png" width="672" /><img src="bookdownproj_files/figure-html/unnamed-chunk-27-8.png" width="672" /></p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="regression-analysis.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co">#.</span></span></code></pre></div>
<p>Note that the spread of fitted to residuals is much nicer when we exclude the influential observations.</p>
<p>let’s kick this up a notch and run a multiple regression on a split sample so that we can cross-validate our model. let’s take all the variables in our data</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="regression-analysis.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Splitting our sample randomly using rbinom</span></span>
<span id="cb94-2"><a href="regression-analysis.html#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb94-3"><a href="regression-analysis.html#cb94-3" aria-hidden="true" tabindex="-1"></a>data_partition <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">200</span>, <span class="dv">1</span>, <span class="at">prob =</span> .<span class="dv">5</span>) </span>
<span id="cb94-4"><a href="regression-analysis.html#cb94-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(data, data_partition)</span>
<span id="cb94-5"><a href="regression-analysis.html#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(data_partition)</span>
<span id="cb94-6"><a href="regression-analysis.html#cb94-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-7"><a href="regression-analysis.html#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="co">#The binary variable &quot;data partition&quot; is our random divide of the sample in to 2. We will run the regression on one part of the sample and see how well it predicts the data in the second sample. let’s call it training data and test data. </span></span>
<span id="cb94-8"><a href="regression-analysis.html#cb94-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-9"><a href="regression-analysis.html#cb94-9" aria-hidden="true" tabindex="-1"></a>training_data <span class="ot">&lt;-</span> <span class="fu">filter</span>(data, data_partition <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb94-10"><a href="regression-analysis.html#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(training_data<span class="sc">$</span>data_partition)</span></code></pre></div>
<pre><code>##  int [1:97] 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="regression-analysis.html#cb96-1" aria-hidden="true" tabindex="-1"></a>test_data     <span class="ot">&lt;-</span> <span class="fu">filter</span>(data, data_partition <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb96-2"><a href="regression-analysis.html#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(test_data<span class="sc">$</span>data_partition)</span></code></pre></div>
<pre><code>##  int [1:103] 0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<p>Now we have our two samples, lets fit our training model. it works the same way as the simple regression, but we just add the additional IVs like you would in a normal regression formula. but first let’s standardize the data so it’s more easily comparable</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="regression-analysis.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Standardising, or, &quot;scaling&quot; our data</span></span>
<span id="cb98-2"><a href="regression-analysis.html#cb98-2" aria-hidden="true" tabindex="-1"></a>z_training_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">scale</span>(training_data))</span>
<span id="cb98-3"><a href="regression-analysis.html#cb98-3" aria-hidden="true" tabindex="-1"></a>z_test_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">scale</span>(test_data))</span>
<span id="cb98-4"><a href="regression-analysis.html#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Fitting the multiple regression</span></span>
<span id="cb98-5"><a href="regression-analysis.html#cb98-5" aria-hidden="true" tabindex="-1"></a>training_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(sales <span class="sc">~</span> adverts <span class="sc">+</span> image <span class="sc">+</span> airplay, <span class="at">data =</span> z_training_data)</span></code></pre></div>
<p>Like for the simple regression we need to check our assumptions</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="regression-analysis.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking the residuals and normality assumtions </span></span>
<span id="cb99-2"><a href="regression-analysis.html#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> training_data, <span class="fu">aes</span>(  <span class="at">y =</span> <span class="fu">predict.lm</span>(training_model)</span>
<span id="cb99-3"><a href="regression-analysis.html#cb99-3" aria-hidden="true" tabindex="-1"></a>                                 , <span class="at">x =</span> training_model<span class="sc">$</span>residuals))<span class="sc">+</span></span>
<span id="cb99-4"><a href="regression-analysis.html#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb99-5"><a href="regression-analysis.html#cb99-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="regression-analysis.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Looks good</span></span>
<span id="cb100-2"><a href="regression-analysis.html#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> training_data, <span class="fu">aes</span>(<span class="at">x =</span> training_model<span class="sc">$</span>residuals))<span class="sc">+</span></span>
<span id="cb100-3"><a href="regression-analysis.html#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-30-2.png" width="672" /></p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="regression-analysis.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> training_data, <span class="fu">aes</span>(<span class="at">x =</span> training_model<span class="sc">$</span>residuals))<span class="sc">+</span></span>
<span id="cb101-2"><a href="regression-analysis.html#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">colour =</span> <span class="st">&#39;steelblue&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-30-3.png" width="672" /></p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="regression-analysis.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Nice </span></span>
<span id="cb102-2"><a href="regression-analysis.html#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="regression-analysis.html#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="co">#We need to check for multicollinearity when we do multiple regression. A cool way to do this is with GGally, but we can also just calculate VIF and tolerance(1/vif) </span></span>
<span id="cb102-4"><a href="regression-analysis.html#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(training_model)</span></code></pre></div>
<pre><code>##  adverts    image  airplay 
## 1.063294 1.066953 1.053305</code></pre>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="regression-analysis.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span><span class="fu">vif</span>(training_model) </span></code></pre></div>
<pre><code>##   adverts     image   airplay 
## 0.9404740 0.9372484 0.9493924</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="regression-analysis.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Tolerance is simply 1 divided by the VIF. Our vif should be &lt;10 and our tolerance</span></span>
<span id="cb106-2"><a href="regression-analysis.html#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt;.2. </span></span>
<span id="cb106-3"><a href="regression-analysis.html#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb106-4"><a href="regression-analysis.html#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(training_model)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-30-4.png" width="672" /></p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="regression-analysis.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Don´t worry about this, this is just a cool diagnostic tool with loads of info in a single plot with a very simple call. </span></span>
<span id="cb107-2"><a href="regression-analysis.html#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="regression-analysis.html#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking error independence with Durbin Watson test</span></span>
<span id="cb107-4"><a href="regression-analysis.html#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="fu">durbinWatsonTest</span>(training_model)</span></code></pre></div>
<pre><code>##  lag Autocorrelation D-W Statistic p-value
##    1      0.00282891      1.887567   0.586
##  Alternative hypothesis: rho != 0</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="regression-analysis.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Still looks good, but notice that the test statistic is less close to 2. </span></span>
<span id="cb109-2"><a href="regression-analysis.html#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Small sample = bad</span></span></code></pre></div>
<p>Now, let’s check the fit of out model</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="regression-analysis.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.lm</span>(training_model)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = sales ~ adverts + image + airplay, data = z_training_data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.4006 -0.2931 -0.0123  0.3958  1.3417 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 1.215e-16  6.004e-02   0.000 1.000000    
## adverts     4.901e-01  6.223e-02   7.876 6.16e-12 ***
## image       2.161e-01  6.234e-02   3.466 0.000802 ***
## airplay     4.666e-01  6.194e-02   7.532 3.18e-11 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.5913 on 93 degrees of freedom
## Multiple R-squared:  0.6613, Adjusted R-squared:  0.6503 
## F-statistic: 60.51 on 3 and 93 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="regression-analysis.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">regplot</span>(training_model, <span class="st">&#39;training model&#39;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="regression-analysis.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co">#.</span></span></code></pre></div>
<p>All estimates are significant, indicating that all variables contribute to
the number of sales, we have also doubled the R2, we can explain much more of the variation with this model. Note also how the visuals suck. it’s hard to visualize multiple regression. But let’s try some ways of visualising.</p>
<p>One way is to use the broom package like so:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="regression-analysis.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb114-2"><a href="regression-analysis.html#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="co">#We need to make image into a factor</span></span>
<span id="cb114-3"><a href="regression-analysis.html#cb114-3" aria-hidden="true" tabindex="-1"></a>training_data<span class="sc">$</span>image <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(training_data<span class="sc">$</span>image)</span>
<span id="cb114-4"><a href="regression-analysis.html#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="co">#We then fit the model that we want to plot</span></span>
<span id="cb114-5"><a href="regression-analysis.html#cb114-5" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sales <span class="sc">~</span> adverts <span class="sc">+</span> image, <span class="at">data =</span> training_data)</span>
<span id="cb114-6"><a href="regression-analysis.html#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Then, using the augment function we can fit a slope to each level of &quot;image&quot;</span></span>
<span id="cb114-7"><a href="regression-analysis.html#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">augment</span>(plot1), <span class="fu">aes</span>(<span class="at">y =</span> sales, <span class="at">x =</span> adverts, <span class="at">col =</span> image))<span class="sc">+</span></span>
<span id="cb114-8"><a href="regression-analysis.html#cb114-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb114-9"><a href="regression-analysis.html#cb114-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb114-10"><a href="regression-analysis.html#cb114-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="regression-analysis.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co">#.</span></span></code></pre></div>
<p>This is a visualization of the sales across advert budget grouped by the band image, we can see that bands with a bad image (1), have fever sales, but they also have less budget. But we also see differences in slope depending on image. the band with the best image has a flatter slope then the bands with slightly worse image. Note that we already know this from our previous graphs, and they are way less messy, this is not a very good graph I think.</p>
<p>Again, visualizing multiple regression is hard, since the dimensions become hard to grasp after two or more variables, given that we care about interactions. One other way is though plotting marginal predictions or coefficients. This illustrates the regression output quite nicely I think, this is sometimes referred to as a simple slopes graph.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="regression-analysis.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Lets extract the coefficients from the model </span></span>
<span id="cb116-2"><a href="regression-analysis.html#cb116-2" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> training_model<span class="sc">$</span>coef</span>
<span id="cb116-3"><a href="regression-analysis.html#cb116-3" aria-hidden="true" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> cf[<span class="dv">1</span>]</span>
<span id="cb116-4"><a href="regression-analysis.html#cb116-4" aria-hidden="true" tabindex="-1"></a>adverts   <span class="ot">&lt;-</span> cf[<span class="dv">2</span>]</span>
<span id="cb116-5"><a href="regression-analysis.html#cb116-5" aria-hidden="true" tabindex="-1"></a>adverts   <span class="ot">&lt;-</span> <span class="fu">round</span>(adverts, <span class="dv">4</span>)</span>
<span id="cb116-6"><a href="regression-analysis.html#cb116-6" aria-hidden="true" tabindex="-1"></a>image     <span class="ot">&lt;-</span> cf[<span class="dv">3</span>]</span>
<span id="cb116-7"><a href="regression-analysis.html#cb116-7" aria-hidden="true" tabindex="-1"></a>image     <span class="ot">&lt;-</span> <span class="fu">round</span>(image, <span class="dv">4</span>)</span>
<span id="cb116-8"><a href="regression-analysis.html#cb116-8" aria-hidden="true" tabindex="-1"></a>airplay   <span class="ot">&lt;-</span> cf[<span class="dv">4</span>]</span>
<span id="cb116-9"><a href="regression-analysis.html#cb116-9" aria-hidden="true" tabindex="-1"></a>airplay   <span class="ot">&lt;-</span> <span class="fu">round</span>(airplay, <span class="dv">4</span>)</span>
<span id="cb116-10"><a href="regression-analysis.html#cb116-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Here they are</span></span>
<span id="cb116-11"><a href="regression-analysis.html#cb116-11" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(adverts, image, airplay)</span></code></pre></div>
<pre><code>## [1] &quot;0.4901 0.2161 0.4666&quot;</code></pre>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="regression-analysis.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This is a grid of values so that the plot has structure - this will be invisible in the graph</span></span>
<span id="cb118-2"><a href="regression-analysis.html#cb118-2" aria-hidden="true" tabindex="-1"></a>statgrid <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">y =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> adverts, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb118-3"><a href="regression-analysis.html#cb118-3" aria-hidden="true" tabindex="-1"></a>                       ,<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">100</span>))</span>
<span id="cb118-4"><a href="regression-analysis.html#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting the slopes</span></span>
<span id="cb118-5"><a href="regression-analysis.html#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> statgrid, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y))<span class="sc">+</span></span>
<span id="cb118-6"><a href="regression-analysis.html#cb118-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb118-7"><a href="regression-analysis.html#cb118-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> intercept, <span class="at">slope =</span> adverts</span>
<span id="cb118-8"><a href="regression-analysis.html#cb118-8" aria-hidden="true" tabindex="-1"></a>              , <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb118-9"><a href="regression-analysis.html#cb118-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> intercept, <span class="at">slope =</span> image</span>
<span id="cb118-10"><a href="regression-analysis.html#cb118-10" aria-hidden="true" tabindex="-1"></a>              , <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb118-11"><a href="regression-analysis.html#cb118-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> intercept, <span class="at">slope =</span> airplay</span>
<span id="cb118-12"><a href="regression-analysis.html#cb118-12" aria-hidden="true" tabindex="-1"></a>              , <span class="at">col =</span> <span class="st">&#39;green&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb118-13"><a href="regression-analysis.html#cb118-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="at">label =</span> <span class="st">&#39;standardised sale value&#39;</span>)<span class="sc">+</span></span>
<span id="cb118-14"><a href="regression-analysis.html#cb118-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="at">label =</span> <span class="st">&#39;dependent variable slope&#39;</span>)<span class="sc">+</span></span>
<span id="cb118-15"><a href="regression-analysis.html#cb118-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb118-16"><a href="regression-analysis.html#cb118-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;Adverts = blue | Image = red | Airplay = green&#39;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="regression-analysis.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Our simple slopes plot</span></span></code></pre></div>
<p>This visualization shows the slopes from the model. That is, the increase in units of sales when the dependent variable increases with one independently. I do not see this type of visualisation often but i quite like it. I think it’s a neat way of visualising a regression output. It is quite abstract though, since it requires that you scale you DVs so they can fit the same plot.</p>
<p>Lastly, let’s see if we have any significant interaction effects, this is a little teaser for what we will do later on in the moderation chapter but I think it might be a good idea to see if we have an interaction here. Going by the graphs earlier we should not expect anything big.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="regression-analysis.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A third model that uses the interaction between image and adverts</span></span>
<span id="cb120-2"><a href="regression-analysis.html#cb120-2" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sales <span class="sc">~</span> adverts<span class="sc">*</span>image <span class="sc">+</span> airplay, <span class="at">data =</span> z_training_data)</span>
<span id="cb120-3"><a href="regression-analysis.html#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.lm</span>(m3)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = sales ~ adverts * image + airplay, data = z_training_data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.4197 -0.2856  0.0063  0.4046  1.3321 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    0.01604    0.06137   0.261  0.79438    
## adverts        0.49317    0.06214   7.937 4.87e-12 ***
## image          0.18976    0.06594   2.878  0.00498 ** 
## airplay        0.45808    0.06220   7.365 7.36e-11 ***
## adverts:image -0.07987    0.06652  -1.201  0.23294    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.5899 on 92 degrees of freedom
## Multiple R-squared:  0.6665, Adjusted R-squared:  0.652 
## F-statistic: 45.96 on 4 and 92 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="regression-analysis.html#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The interaction is not significant. let’s go all out and fit a full interaction model - our fourth model</span></span>
<span id="cb122-2"><a href="regression-analysis.html#cb122-2" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sales <span class="sc">~</span> adverts<span class="sc">*</span>image<span class="sc">*</span>airplay, <span class="at">data =</span> z_training_data)</span>
<span id="cb122-3"><a href="regression-analysis.html#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.lm</span>(m4)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = sales ~ adverts * image * airplay, data = z_training_data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.39859 -0.27268 -0.00666  0.38561  1.33742 
## 
## Coefficients:
##                        Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)            0.011502   0.068353   0.168   0.8668    
## adverts                0.505923   0.070951   7.131 2.54e-10 ***
## image                  0.185909   0.081013   2.295   0.0241 *  
## airplay                0.445473   0.068210   6.531 3.93e-09 ***
## adverts:image         -0.102109   0.086212  -1.184   0.2394    
## adverts:airplay        0.002962   0.084294   0.035   0.9720    
## image:airplay          0.074178   0.100145   0.741   0.4608    
## adverts:image:airplay  0.029568   0.131518   0.225   0.8226    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.5975 on 89 degrees of freedom
## Multiple R-squared:  0.6691, Adjusted R-squared:  0.643 
## F-statistic: 25.71 on 7 and 89 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>So, simply going by this the interaction terms does not do much for us. let’s just stick with our original training model and see how well it predicts our test data. Let’s extract our predictions</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="regression-analysis.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co">#We need to load in the caret package for this (more on this later in the cross validation chapter)</span></span>
<span id="cb124-2"><a href="regression-analysis.html#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb124-3"><a href="regression-analysis.html#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions and compute the R2, RMSE and MAE</span></span>
<span id="cb124-4"><a href="regression-analysis.html#cb124-4" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> training_model <span class="sc">%&gt;%</span> <span class="fu">predict</span>(test_data)</span>
<span id="cb124-5"><a href="regression-analysis.html#cb124-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-6"><a href="regression-analysis.html#cb124-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>( <span class="at">R2 =</span> <span class="fu">R2</span>(predictions, test_data<span class="sc">$</span>sales),</span>
<span id="cb124-7"><a href="regression-analysis.html#cb124-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">RMSE =</span> <span class="fu">RMSE</span>(predictions, test_data<span class="sc">$</span>sales),</span>
<span id="cb124-8"><a href="regression-analysis.html#cb124-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">MAE =</span> <span class="fu">MAE</span>(predictions, test_data<span class="sc">$</span>sales))</span></code></pre></div>
<pre><code>##         R2     RMSE      MAE
## 1 0.318754 242.4139 189.1693</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="regression-analysis.html#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co">#We have an RMSE of 242, if the training model has a lower one, it fits better</span></span>
<span id="cb126-2"><a href="regression-analysis.html#cb126-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-3"><a href="regression-analysis.html#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="co">#We need to make image numeric for prediction purposes</span></span>
<span id="cb126-4"><a href="regression-analysis.html#cb126-4" aria-hidden="true" tabindex="-1"></a>training_data<span class="sc">$</span>image <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(training_data<span class="sc">$</span>image)</span>
<span id="cb126-5"><a href="regression-analysis.html#cb126-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-6"><a href="regression-analysis.html#cb126-6" aria-hidden="true" tabindex="-1"></a>predictions<span class="fl">.2</span> <span class="ot">&lt;-</span> training_model <span class="sc">%&gt;%</span> <span class="fu">predict</span>(training_data)</span>
<span id="cb126-7"><a href="regression-analysis.html#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>( <span class="at">R2 =</span> <span class="fu">R2</span>(predictions<span class="fl">.2</span>, training_data<span class="sc">$</span>sales),</span>
<span id="cb126-8"><a href="regression-analysis.html#cb126-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">RMSE =</span> <span class="fu">RMSE</span>(predictions<span class="fl">.2</span>, training_data<span class="sc">$</span>sales),</span>
<span id="cb126-9"><a href="regression-analysis.html#cb126-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">MAE =</span> <span class="fu">MAE</span>(predictions<span class="fl">.2</span>, training_data<span class="sc">$</span>sales))</span></code></pre></div>
<pre><code>##         R2     RMSE     MAE
## 1 0.390846 227.6169 167.243</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="regression-analysis.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co">#So, not very unexpectedly, we have better fit on this model. </span></span>
<span id="cb128-2"><a href="regression-analysis.html#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-3"><a href="regression-analysis.html#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Let´s store some predictions for plotting</span></span>
<span id="cb128-4"><a href="regression-analysis.html#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Prediction on the training data</span></span>
<span id="cb128-5"><a href="regression-analysis.html#cb128-5" aria-hidden="true" tabindex="-1"></a>pred_train <span class="ot">&lt;-</span> training_model <span class="sc">%&gt;%</span> <span class="fu">predict</span>(z_training_data) </span>
<span id="cb128-6"><a href="regression-analysis.html#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Prediction on the test data </span></span>
<span id="cb128-7"><a href="regression-analysis.html#cb128-7" aria-hidden="true" tabindex="-1"></a>pred_test  <span class="ot">&lt;-</span> training_model <span class="sc">%&gt;%</span> <span class="fu">predict</span>(z_test_data) </span></code></pre></div>
<p>Let’s plot the predictions</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="regression-analysis.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co">#For reference, this is what a perfect prediction would look like </span></span>
<span id="cb129-2"><a href="regression-analysis.html#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(data), <span class="fu">aes</span>(sales))<span class="sc">+</span></span>
<span id="cb129-3"><a href="regression-analysis.html#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)<span class="sc">+</span></span>
<span id="cb129-4"><a href="regression-analysis.html#cb129-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span>sales, <span class="at">x =</span> sales), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb129-5"><a href="regression-analysis.html#cb129-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="at">label =</span> <span class="st">&#39;sales&#39;</span>)<span class="sc">+</span></span>
<span id="cb129-6"><a href="regression-analysis.html#cb129-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;perfect prediction&#39;</span>)<span class="sc">+</span></span>
<span id="cb129-7"><a href="regression-analysis.html#cb129-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="regression-analysis.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Training data prediction</span></span>
<span id="cb130-2"><a href="regression-analysis.html#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(z_training_data), <span class="fu">aes</span>(sales))<span class="sc">+</span></span>
<span id="cb130-3"><a href="regression-analysis.html#cb130-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)<span class="sc">+</span></span>
<span id="cb130-4"><a href="regression-analysis.html#cb130-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span>pred_train, <span class="at">x =</span> sales), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb130-5"><a href="regression-analysis.html#cb130-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="at">label =</span> <span class="st">&#39;model predicted sales&#39;</span>)<span class="sc">+</span></span>
<span id="cb130-6"><a href="regression-analysis.html#cb130-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-36-2.png" width="672" /></p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="regression-analysis.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co">#.</span></span></code></pre></div>
<p>This shows how well our model performs, the red line indicating perfect predictions that is, if we could estimate the number of sales perfectly. Which we clearly can’t, let´s look at our out of sample prediction.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="regression-analysis.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(z_test_data), <span class="fu">aes</span>(sales))<span class="sc">+</span></span>
<span id="cb132-2"><a href="regression-analysis.html#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)<span class="sc">+</span></span>
<span id="cb132-3"><a href="regression-analysis.html#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span>pred_test, <span class="at">x =</span> sales), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb132-4"><a href="regression-analysis.html#cb132-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="at">label =</span> <span class="st">&#39;model predicted sales&#39;</span>)<span class="sc">+</span></span>
<span id="cb132-5"><a href="regression-analysis.html#cb132-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="regression-analysis.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co">#.</span></span></code></pre></div>
<p>Let’s compare all the plots using the grid arrange function again</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="regression-analysis.html#cb134-1" aria-hidden="true" tabindex="-1"></a>perfect_pred <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="fu">scale</span>(data)), <span class="fu">aes</span>(sales))<span class="sc">+</span></span>
<span id="cb134-2"><a href="regression-analysis.html#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)<span class="sc">+</span></span>
<span id="cb134-3"><a href="regression-analysis.html#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span>sales, <span class="at">x =</span> sales), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb134-4"><a href="regression-analysis.html#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="at">label =</span> <span class="st">&#39;sales&#39;</span>)<span class="sc">+</span></span>
<span id="cb134-5"><a href="regression-analysis.html#cb134-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;perfect prediction&#39;</span>)<span class="sc">+</span></span>
<span id="cb134-6"><a href="regression-analysis.html#cb134-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb134-7"><a href="regression-analysis.html#cb134-7" aria-hidden="true" tabindex="-1"></a>insample_pred <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(z_training_data), <span class="fu">aes</span>(sales))<span class="sc">+</span></span>
<span id="cb134-8"><a href="regression-analysis.html#cb134-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)<span class="sc">+</span></span>
<span id="cb134-9"><a href="regression-analysis.html#cb134-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span>pred_train, <span class="at">x =</span> sales), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb134-10"><a href="regression-analysis.html#cb134-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="at">label =</span> <span class="st">&#39;predicted sales&#39;</span>)<span class="sc">+</span></span>
<span id="cb134-11"><a href="regression-analysis.html#cb134-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;insample prediction&#39;</span>)<span class="sc">+</span></span>
<span id="cb134-12"><a href="regression-analysis.html#cb134-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb134-13"><a href="regression-analysis.html#cb134-13" aria-hidden="true" tabindex="-1"></a>outsample_pred <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(z_test_data), <span class="fu">aes</span>(sales))<span class="sc">+</span></span>
<span id="cb134-14"><a href="regression-analysis.html#cb134-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)<span class="sc">+</span></span>
<span id="cb134-15"><a href="regression-analysis.html#cb134-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span>pred_test, <span class="at">x =</span> sales), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb134-16"><a href="regression-analysis.html#cb134-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="at">label =</span> <span class="st">&#39;predicted sales&#39;</span>)<span class="sc">+</span></span>
<span id="cb134-17"><a href="regression-analysis.html#cb134-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;out of sample prediction&#39;</span>)<span class="sc">+</span></span>
<span id="cb134-18"><a href="regression-analysis.html#cb134-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb134-19"><a href="regression-analysis.html#cb134-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-20"><a href="regression-analysis.html#cb134-20" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(perfect_pred, insample_pred, outsample_pred)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="regression-analysis.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This last piece of code compiles the graphs </span></span></code></pre></div>
<p>And there we have it, this model seems pretty good. Nothing amazing, but pretty good. In “reality” out of sample predictions are usually worse, but since we have such a simple model with reasonable dependent variables, this is not that unexpected. We certainly dont have issues with over-fitting our model, which can cause it to make poor out of sample predictions.</p>
<p>In this chapter we have gone through a little bit of everything, we have some prediction some moderation some cross validation and of course the simple regression analysis. In future chapters we will take a closer look at all of these methods, if you want to have a more “real” example of regression check out the last chapter where we use real messy data for various analyses.</p>
</div>
<div id="comparing-means" class="section level2 hasAnchor" number="9.2">
<h2><span class="header-section-number">9.2</span> Comparing means<a href="regression-analysis.html#comparing-means" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="a-primer-on-means-and-effect-sizes-with-simulation" class="section level3 hasAnchor" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> A primer on means and effect sizes with simulation<a href="regression-analysis.html#a-primer-on-means-and-effect-sizes-with-simulation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We should all be familiar with means, spreads, distributions by now. Let’s use an example from Field to get a good look at how this comes together when we compare means. We will be using the invisibility cloak data since I think that´s funny. The question is, will an invisibility cloak make you more mischievous?</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="regression-analysis.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb136-2"><a href="regression-analysis.html#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb136-3"><a href="regression-analysis.html#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(faux)</span>
<span id="cb136-4"><a href="regression-analysis.html#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb136-5"><a href="regression-analysis.html#cb136-5" aria-hidden="true" tabindex="-1"></a>invisibility <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="fu">here</span>(<span class="st">&quot;data sets/Invisibility.sav&quot;</span>))</span>
<span id="cb136-6"><a href="regression-analysis.html#cb136-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking the data structure</span></span>
<span id="cb136-7"><a href="regression-analysis.html#cb136-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(invisibility)</span></code></pre></div>
<pre><code>## tibble [24 x 2] (S3: tbl_df/tbl/data.frame)
##  $ Cloak   : dbl+lbl [1:24] 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...
##    ..@ label      : chr &quot;Cloak of invisibility&quot;
##    ..@ format.spss: chr &quot;F8.0&quot;
##    ..@ labels     : Named num [1:2] 0 1
##    .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;No Cloak&quot; &quot;Cloak&quot;
##  $ Mischief: num [1:24] 3 1 5 4 6 4 6 2 0 5 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;Mischievous Acts&quot;
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F8.0&quot;</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="regression-analysis.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Renaming to lower caps</span></span>
<span id="cb138-2"><a href="regression-analysis.html#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(invisibility) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;cloak&#39;</span>, <span class="st">&#39;mischief&#39;</span>)</span>
<span id="cb138-3"><a href="regression-analysis.html#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="co">#making invisibility a factor</span></span>
<span id="cb138-4"><a href="regression-analysis.html#cb138-4" aria-hidden="true" tabindex="-1"></a>invisibility<span class="sc">$</span>cloak <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(invisibility<span class="sc">$</span>cloak)</span>
<span id="cb138-5"><a href="regression-analysis.html#cb138-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-6"><a href="regression-analysis.html#cb138-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Taking some descriptive statistics using pastecs</span></span>
<span id="cb138-7"><a href="regression-analysis.html#cb138-7" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(invisibility<span class="sc">$</span>mischief, invisibility<span class="sc">$</span>cloak, pastecs<span class="sc">::</span>stat.desc)</span></code></pre></div>
<pre><code>## invisibility$cloak: 0
##      nbr.val     nbr.null       nbr.na          min          max        range 
##   12.0000000    1.0000000    0.0000000    0.0000000    6.0000000    6.0000000 
##          sum       median         mean      SE.mean CI.mean.0.95          var 
##   45.0000000    4.0000000    3.7500000    0.5521995    1.2153828    3.6590909 
##      std.dev     coef.var 
##    1.9128750    0.5101000 
## ------------------------------------------------------------------- 
## invisibility$cloak: 1
##      nbr.val     nbr.null       nbr.na          min          max        range 
##   12.0000000    0.0000000    0.0000000    2.0000000    8.0000000    6.0000000 
##          sum       median         mean      SE.mean CI.mean.0.95          var 
##   60.0000000    5.0000000    5.0000000    0.4767313    1.0492785    2.7272727 
##      std.dev     coef.var 
##    1.6514456    0.3302891</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="regression-analysis.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Let´s plot it also so we can get a better look. </span></span>
<span id="cb140-2"><a href="regression-analysis.html#cb140-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-3"><a href="regression-analysis.html#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="co">#First, we look at the histograms for mischief for cloak and no cloak</span></span>
<span id="cb140-4"><a href="regression-analysis.html#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">filter</span>(invisibility, cloak <span class="sc">==</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb140-5"><a href="regression-analysis.html#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(mischief), <span class="at">fill =</span> <span class="st">&#39;darkred&#39;</span>)<span class="sc">+</span></span>
<span id="cb140-6"><a href="regression-analysis.html#cb140-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;No cloak&#39;</span>)<span class="sc">+</span></span>
<span id="cb140-7"><a href="regression-analysis.html#cb140-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="regression-analysis.html#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">filter</span>(invisibility, cloak <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb141-2"><a href="regression-analysis.html#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(mischief), <span class="at">fill =</span> <span class="st">&#39;steelblue&#39;</span>)<span class="sc">+</span></span>
<span id="cb141-3"><a href="regression-analysis.html#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;Cloak&#39;</span>)<span class="sc">+</span></span>
<span id="cb141-4"><a href="regression-analysis.html#cb141-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-39-2.png" width="672" /></p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="regression-analysis.html#cb142-1" aria-hidden="true" tabindex="-1"></a>invisibility<span class="sc">%&gt;%</span></span>
<span id="cb142-2"><a href="regression-analysis.html#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mischief, <span class="at">colour =</span> cloak))<span class="sc">+</span></span>
<span id="cb142-3"><a href="regression-analysis.html#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="fu">aes</span>(<span class="at">fill =</span> cloak), <span class="at">alpha =</span> .<span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb142-4"><a href="regression-analysis.html#cb142-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-39-3.png" width="672" /></p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="regression-analysis.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co">#They are not distributed very differently; we should be able to compare these two groups alright. Let´s plot the median difference with violins and boxes. </span></span>
<span id="cb143-2"><a href="regression-analysis.html#cb143-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-3"><a href="regression-analysis.html#cb143-3" aria-hidden="true" tabindex="-1"></a>invisibility<span class="sc">%&gt;%</span></span>
<span id="cb143-4"><a href="regression-analysis.html#cb143-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> mischief, <span class="at">x =</span> cloak, <span class="at">colour =</span> cloak))<span class="sc">+</span></span>
<span id="cb143-5"><a href="regression-analysis.html#cb143-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="fu">aes</span>(<span class="at">fill =</span> cloak), <span class="at">alpha =</span> .<span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb143-6"><a href="regression-analysis.html#cb143-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> .<span class="dv">3</span>, <span class="at">colour =</span> <span class="st">&#39;grey&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb143-7"><a href="regression-analysis.html#cb143-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-39-4.png" width="672" /></p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="regression-analysis.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Posessing a cloak seems to make someone slightly more mischievous. </span></span></code></pre></div>
<p>Let´s check if the difference is statistically significant using the t-test</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="regression-analysis.html#cb145-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">t.test</span>(mischief <span class="sc">~</span> cloak, <span class="at">data =</span> invisibility)</span>
<span id="cb145-2"><a href="regression-analysis.html#cb145-2" aria-hidden="true" tabindex="-1"></a>t</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  mischief by cloak
## t = -1.7135, df = 21.541, p-value = 0.101
## alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
## 95 percent confidence interval:
##  -2.764798  0.264798
## sample estimates:
## mean in group 0 mean in group 1 
##            3.75            5.00</code></pre>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="regression-analysis.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effectsize)</span>
<span id="cb147-2"><a href="regression-analysis.html#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(t)</span></code></pre></div>
<pre><code>## Warning in effectsize.htest(t): Unable to retrieve data from htest object. Using t_to_d()
## approximation.</code></pre>
<pre><code>## d     |        95% CI
## ---------------------
## -0.74 | [-1.60, 0.14]</code></pre>
<p>Seems like we don’t have a very robust difference, let’s see if we can simulate the distribution of the populations using the rnorm function and the mean and spread of mischief for cloak and no cloak.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="regression-analysis.html#cb150-1" aria-hidden="true" tabindex="-1"></a>no_cloak <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fl">1e4</span>, <span class="at">mean =</span> <span class="fl">3.75</span>, <span class="at">sd =</span> <span class="fl">1.91</span>)</span>
<span id="cb150-2"><a href="regression-analysis.html#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Since we are working with ordinal scales, we need to truncate our values</span></span>
<span id="cb150-3"><a href="regression-analysis.html#cb150-3" aria-hidden="true" tabindex="-1"></a>no_cloak <span class="ot">&lt;-</span> <span class="fu">norm2trunc</span>(no_cloak, <span class="at">min =</span> <span class="dv">0</span>)</span>
<span id="cb150-4"><a href="regression-analysis.html#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="co">#We also need to round our values. </span></span>
<span id="cb150-5"><a href="regression-analysis.html#cb150-5" aria-hidden="true" tabindex="-1"></a>no_cloak <span class="ot">&lt;-</span> <span class="fu">round</span>(no_cloak, <span class="dv">0</span>)</span>
<span id="cb150-6"><a href="regression-analysis.html#cb150-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-7"><a href="regression-analysis.html#cb150-7" aria-hidden="true" tabindex="-1"></a>cloak    <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fl">1e4</span>, <span class="at">mean =</span> <span class="dv">5</span>,    <span class="at">sd =</span> <span class="fl">1.65</span>)</span>
<span id="cb150-8"><a href="regression-analysis.html#cb150-8" aria-hidden="true" tabindex="-1"></a>cloak <span class="ot">&lt;-</span> <span class="fu">norm2trunc</span>(cloak, <span class="at">min =</span> <span class="dv">0</span>)</span>
<span id="cb150-9"><a href="regression-analysis.html#cb150-9" aria-hidden="true" tabindex="-1"></a>cloak <span class="ot">&lt;-</span> <span class="fu">round</span>(cloak, <span class="dv">0</span>)</span>
<span id="cb150-10"><a href="regression-analysis.html#cb150-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-11"><a href="regression-analysis.html#cb150-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating a data set with our simulated values</span></span>
<span id="cb150-12"><a href="regression-analysis.html#cb150-12" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(no_cloak, cloak)</span>
<span id="cb150-13"><a href="regression-analysis.html#cb150-13" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;no_cloak&#39;</span>, <span class="st">&#39;cloak&#39;</span>)</span>
<span id="cb150-14"><a href="regression-analysis.html#cb150-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span></code></pre></div>
<pre><code>##     no_cloak          cloak       
##  Min.   : 0.000   Min.   : 0.000  
##  1st Qu.: 3.000   1st Qu.: 4.000  
##  Median : 4.000   Median : 5.000  
##  Mean   : 3.864   Mean   : 5.005  
##  3rd Qu.: 5.000   3rd Qu.: 6.000  
##  Max.   :11.000   Max.   :11.000</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="regression-analysis.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting our simulated values</span></span>
<span id="cb152-2"><a href="regression-analysis.html#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data)<span class="sc">+</span></span>
<span id="cb152-3"><a href="regression-analysis.html#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(cloak), <span class="at">fill =</span> <span class="st">&#39;red&#39;</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb152-4"><a href="regression-analysis.html#cb152-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(no_cloak), <span class="at">fill =</span> <span class="st">&#39;blue&#39;</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb152-5"><a href="regression-analysis.html#cb152-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Blue = no cloak.  Red = cloak&#39;</span>)</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="regression-analysis.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Looks pretty nice to me.</span></span></code></pre></div>
<p>Let´s run the t-test on the simulated values</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="regression-analysis.html#cb155-1" aria-hidden="true" tabindex="-1"></a>sim_t <span class="ot">&lt;-</span> <span class="fu">t.test</span>(<span class="at">x=</span> no_cloak, <span class="at">y =</span> cloak, <span class="at">data =</span> data)</span>
<span id="cb155-2"><a href="regression-analysis.html#cb155-2" aria-hidden="true" tabindex="-1"></a>sim_t</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  no_cloak and cloak
## t = -46.15, df = 19819, p-value &lt; 2.2e-16
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -1.189252 -1.092348
## sample estimates:
## mean of x mean of y 
##    3.8638    5.0046</code></pre>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="regression-analysis.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(t)</span></code></pre></div>
<pre><code>## d     |        95% CI
## ---------------------
## -0.74 | [-1.60, 0.14]</code></pre>
<p>Notice how small the p-value is, this is due to our big sample. But the effect
size is not significant, that is, we are not certain that an effect actually exists. If we have a large number of observations, the p-value is generally significant. This simulation is therefore quite bad. Let´s make a type of bootstrap simulation instead, but instead of using sampling from the data we make estimations using the rnorm function with the same sample size as our data, that is n = 12(per group)</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="regression-analysis.html#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co">#We can use a for-loop for this. First, we create an object for storing our t-values.</span></span>
<span id="cb159-2"><a href="regression-analysis.html#cb159-2" aria-hidden="true" tabindex="-1"></a>resamp_t <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">t =</span> <span class="cn">NA</span>)</span>
<span id="cb159-3"><a href="regression-analysis.html#cb159-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-4"><a href="regression-analysis.html#cb159-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Then we specify our loop. We will make 1000 t-tests and store the t-value in resamp_t</span></span>
<span id="cb159-5"><a href="regression-analysis.html#cb159-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">69</span>)</span>
<span id="cb159-6"><a href="regression-analysis.html#cb159-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb159-7"><a href="regression-analysis.html#cb159-7" aria-hidden="true" tabindex="-1"></a>  no_cloak <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">12</span>, <span class="at">mean =</span> <span class="fl">3.75</span>, <span class="at">sd =</span> <span class="fl">1.91</span>)</span>
<span id="cb159-8"><a href="regression-analysis.html#cb159-8" aria-hidden="true" tabindex="-1"></a>  no_cloak <span class="ot">&lt;-</span> <span class="fu">norm2trunc</span>(no_cloak, <span class="at">min =</span> <span class="dv">0</span>)</span>
<span id="cb159-9"><a href="regression-analysis.html#cb159-9" aria-hidden="true" tabindex="-1"></a>  no_cloak <span class="ot">&lt;-</span> <span class="fu">round</span>(no_cloak, <span class="dv">0</span>)</span>
<span id="cb159-10"><a href="regression-analysis.html#cb159-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb159-11"><a href="regression-analysis.html#cb159-11" aria-hidden="true" tabindex="-1"></a>  cloak    <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">12</span>, <span class="at">mean =</span> <span class="dv">5</span>,    <span class="at">sd =</span> <span class="fl">1.65</span>)</span>
<span id="cb159-12"><a href="regression-analysis.html#cb159-12" aria-hidden="true" tabindex="-1"></a>  cloak <span class="ot">&lt;-</span> <span class="fu">norm2trunc</span>(cloak, <span class="at">min =</span> <span class="dv">0</span>)</span>
<span id="cb159-13"><a href="regression-analysis.html#cb159-13" aria-hidden="true" tabindex="-1"></a>  cloak <span class="ot">&lt;-</span> <span class="fu">round</span>(cloak, <span class="dv">0</span>) </span>
<span id="cb159-14"><a href="regression-analysis.html#cb159-14" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb159-15"><a href="regression-analysis.html#cb159-15" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> <span class="fu">t.test</span>(<span class="at">x=</span> no_cloak, <span class="at">y =</span> cloak, <span class="at">data =</span> data) </span>
<span id="cb159-16"><a href="regression-analysis.html#cb159-16" aria-hidden="true" tabindex="-1"></a>  resamp_t[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(t<span class="sc">$</span>statistic)</span>
<span id="cb159-17"><a href="regression-analysis.html#cb159-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb159-18"><a href="regression-analysis.html#cb159-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb159-19"><a href="regression-analysis.html#cb159-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Epic, let&#39;s plot out our t-values and put some lines at the critical values of t for our specific sample size.</span></span>
<span id="cb159-20"><a href="regression-analysis.html#cb159-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-21"><a href="regression-analysis.html#cb159-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(resamp_t)<span class="sc">+</span></span>
<span id="cb159-22"><a href="regression-analysis.html#cb159-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(t))<span class="sc">+</span></span>
<span id="cb159-23"><a href="regression-analysis.html#cb159-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="sc">-</span><span class="fl">2.048</span>, <span class="at">linetype =</span> <span class="st">&#39;dashed&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb159-24"><a href="regression-analysis.html#cb159-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="regression-analysis.html#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Pretty cool right? The dashed line indicates all significant t-tests. We can get somethings that’s similar to a power calculation from this by counting the number of significant test and dividing it by the number of tests we have done. What we get is the ratio of significant results. We can then say that &quot;assuming the effect exists, there is an x change to find it given our sample size&quot;. </span></span>
<span id="cb160-2"><a href="regression-analysis.html#cb160-2" aria-hidden="true" tabindex="-1"></a>power <span class="ot">&lt;-</span> <span class="fu">sum</span>(resamp_t<span class="sc">$</span>t<span class="sc">&lt;=-</span><span class="fl">2.048</span>)<span class="sc">/</span><span class="fu">length</span>(resamp_t<span class="sc">$</span>t)</span>
<span id="cb160-3"><a href="regression-analysis.html#cb160-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-4"><a href="regression-analysis.html#cb160-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Note that this is NOT an a priori power calculation but given the sample size of the data we can only find the effect around 33% of the time, this is really bad. Even if we assume that such a big effect size that is observed exists, we are in big trubble.</span></span>
<span id="cb160-5"><a href="regression-analysis.html#cb160-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-6"><a href="regression-analysis.html#cb160-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Let´s compare our results with a normal power analysis </span></span>
<span id="cb160-7"><a href="regression-analysis.html#cb160-7" aria-hidden="true" tabindex="-1"></a>pwr<span class="sc">::</span><span class="fu">pwr.t.test</span>(<span class="at">n =</span> <span class="dv">12</span>, <span class="at">d =</span> .<span class="dv">74</span>, <span class="at">sig.level =</span> .<span class="dv">05</span>, <span class="at">type =</span> <span class="st">&#39;two.sample&#39;</span>, <span class="at">alternative =</span> <span class="st">&#39;two.sided&#39;</span>)</span></code></pre></div>
<pre><code>## 
##      Two-sample t test power calculation 
## 
##               n = 12
##               d = 0.74
##       sig.level = 0.05
##           power = 0.4105285
##     alternative = two.sided
## 
## NOTE: n is number in *each* group</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="regression-analysis.html#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The results are not the same but the certainly send the same message! </span></span></code></pre></div>
<p>In conclusion we can say that a cloak won’t make you more mischievous, or at least we need some more evidence to come to that conclusion. I quite like using simulation as a means of approximating power. It puts the abstract concept of power on a more tangible level, that is, at what quantile does our presumed distribution of t-values reject the null hypothesis? even though this is not ‘true’ power, i think it does a nice job of providing a practical visual.</p>
<p>While we are on the topic of power, we can look at a common practice that can reduce our power quite a bit: median splits. I believe Field calls the devil’s work? let’s find out if they are using simulation.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="regression-analysis.html#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co">#First, we create some data with faux, you can use my numbers or choose your own, they are arbitrary. </span></span>
<span id="cb163-2"><a href="regression-analysis.html#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">234</span>)</span>
<span id="cb163-3"><a href="regression-analysis.html#cb163-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">rnorm_multi</span>( <span class="at">n =</span> <span class="dv">400</span>                  <span class="co">#the number of obs</span></span>
<span id="cb163-4"><a href="regression-analysis.html#cb163-4" aria-hidden="true" tabindex="-1"></a>                     , <span class="at">vars =</span> <span class="dv">2</span>               <span class="co">#the number of variables</span></span>
<span id="cb163-5"><a href="regression-analysis.html#cb163-5" aria-hidden="true" tabindex="-1"></a>                     , <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">44</span>, <span class="dv">23</span>)         <span class="co">#the mean of our variables</span></span>
<span id="cb163-6"><a href="regression-analysis.html#cb163-6" aria-hidden="true" tabindex="-1"></a>                     , <span class="at">sd =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">3</span>)           <span class="co">#the sd of our variables</span></span>
<span id="cb163-7"><a href="regression-analysis.html#cb163-7" aria-hidden="true" tabindex="-1"></a>                     , <span class="at">r  =</span> .<span class="dv">68</span>               <span class="co">#the correlation of our variables</span></span>
<span id="cb163-8"><a href="regression-analysis.html#cb163-8" aria-hidden="true" tabindex="-1"></a>                     , <span class="at">varnames =</span> <span class="fu">c</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>))<span class="co">#the name of our vars </span></span>
<span id="cb163-9"><a href="regression-analysis.html#cb163-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(data)</span></code></pre></div>
<pre><code>##           x         y
## x 1.0000000 0.6897844
## y 0.6897844 1.0000000</code></pre>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="regression-analysis.html#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here we have a correlation of .689 sampled from a population correlation of .68</span></span>
<span id="cb165-2"><a href="regression-analysis.html#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="co">#let’s see what happens when we split the data in to quantile splits. That is, divide them in 4 equal parts.</span></span>
<span id="cb165-3"><a href="regression-analysis.html#cb165-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-4"><a href="regression-analysis.html#cb165-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> </span>
<span id="cb165-5"><a href="regression-analysis.html#cb165-5" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">x_quantilegroup =</span> <span class="fu">ntile</span>(x, <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb165-6"><a href="regression-analysis.html#cb165-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y_quantilegroup =</span> <span class="fu">ntile</span>(y, <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb165-7"><a href="regression-analysis.html#cb165-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb165-8"><a href="regression-analysis.html#cb165-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(data<span class="sc">$</span>x_quantilegroup, data<span class="sc">$</span>y_quantilegroup)</span></code></pre></div>
<pre><code>## [1] 0.8443566</code></pre>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="regression-analysis.html#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This is a very big correlation, probably spurious, lets simulate this to find out. We follow the same procedure as with the t-tests but let’s do 5000 simulations instead. Let´s start with continuous r.</span></span>
<span id="cb167-2"><a href="regression-analysis.html#cb167-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-3"><a href="regression-analysis.html#cb167-3" aria-hidden="true" tabindex="-1"></a>r1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">r1 =</span> <span class="cn">NA</span>)</span>
<span id="cb167-4"><a href="regression-analysis.html#cb167-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3452</span>)</span>
<span id="cb167-5"><a href="regression-analysis.html#cb167-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5000</span>){</span>
<span id="cb167-6"><a href="regression-analysis.html#cb167-6" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">rnorm_multi</span>( <span class="at">n =</span> <span class="dv">400</span></span>
<span id="cb167-7"><a href="regression-analysis.html#cb167-7" aria-hidden="true" tabindex="-1"></a>                       , <span class="at">vars =</span> <span class="dv">2</span></span>
<span id="cb167-8"><a href="regression-analysis.html#cb167-8" aria-hidden="true" tabindex="-1"></a>                       , <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">44</span>, <span class="dv">23</span>)</span>
<span id="cb167-9"><a href="regression-analysis.html#cb167-9" aria-hidden="true" tabindex="-1"></a>                       , <span class="at">sd =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">3</span>)</span>
<span id="cb167-10"><a href="regression-analysis.html#cb167-10" aria-hidden="true" tabindex="-1"></a>                       , <span class="at">r  =</span> .<span class="dv">68</span></span>
<span id="cb167-11"><a href="regression-analysis.html#cb167-11" aria-hidden="true" tabindex="-1"></a>                       , <span class="at">varnames =</span> <span class="fu">c</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>))</span>
<span id="cb167-12"><a href="regression-analysis.html#cb167-12" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cor</span>(data<span class="sc">$</span>x, data<span class="sc">$</span>y) )</span>
<span id="cb167-13"><a href="regression-analysis.html#cb167-13" aria-hidden="true" tabindex="-1"></a>  r1[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(r)</span>
<span id="cb167-14"><a href="regression-analysis.html#cb167-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb167-15"><a href="regression-analysis.html#cb167-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-16"><a href="regression-analysis.html#cb167-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Now let’s split the sample into quantiles - this will take a bit more time</span></span>
<span id="cb167-17"><a href="regression-analysis.html#cb167-17" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">r2 =</span> <span class="cn">NA</span>)</span>
<span id="cb167-18"><a href="regression-analysis.html#cb167-18" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">435</span>)</span>
<span id="cb167-19"><a href="regression-analysis.html#cb167-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5000</span>){</span>
<span id="cb167-20"><a href="regression-analysis.html#cb167-20" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">rnorm_multi</span>( <span class="at">n =</span> <span class="dv">400</span></span>
<span id="cb167-21"><a href="regression-analysis.html#cb167-21" aria-hidden="true" tabindex="-1"></a>                       , <span class="at">vars =</span> <span class="dv">2</span></span>
<span id="cb167-22"><a href="regression-analysis.html#cb167-22" aria-hidden="true" tabindex="-1"></a>                       , <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">44</span>, <span class="dv">23</span>)</span>
<span id="cb167-23"><a href="regression-analysis.html#cb167-23" aria-hidden="true" tabindex="-1"></a>                       , <span class="at">sd =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">3</span>)</span>
<span id="cb167-24"><a href="regression-analysis.html#cb167-24" aria-hidden="true" tabindex="-1"></a>                       , <span class="at">r  =</span> .<span class="dv">68</span></span>
<span id="cb167-25"><a href="regression-analysis.html#cb167-25" aria-hidden="true" tabindex="-1"></a>                       , <span class="at">varnames =</span> <span class="fu">c</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>))</span>
<span id="cb167-26"><a href="regression-analysis.html#cb167-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-27"><a href="regression-analysis.html#cb167-27" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">x_quantilegroup =</span> <span class="fu">ntile</span>(x, <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb167-28"><a href="regression-analysis.html#cb167-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y_quantilegroup =</span> <span class="fu">ntile</span>(y, <span class="dv">4</span>))</span>
<span id="cb167-29"><a href="regression-analysis.html#cb167-29" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">cor</span>(data<span class="sc">$</span>x_quantilegroup,data<span class="sc">$</span>y_quantilegroup)</span>
<span id="cb167-30"><a href="regression-analysis.html#cb167-30" aria-hidden="true" tabindex="-1"></a>r2[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(r)</span>
<span id="cb167-31"><a href="regression-analysis.html#cb167-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb167-32"><a href="regression-analysis.html#cb167-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-33"><a href="regression-analysis.html#cb167-33" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(r1,r2)</span>
<span id="cb167-34"><a href="regression-analysis.html#cb167-34" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(r)</span></code></pre></div>
<pre><code>##        r1               r2        
##  Min.   :0.5558   Min.   :0.4660  
##  1st Qu.:0.6621   1st Qu.:0.5840  
##  Median :0.6811   Median :0.6080  
##  Mean   :0.6801   Mean   :0.6065  
##  3rd Qu.:0.6990   3rd Qu.:0.6300  
##  Max.   :0.7602   Max.   :0.7180</code></pre>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="regression-analysis.html#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Let’s visualise this. </span></span>
<span id="cb169-2"><a href="regression-analysis.html#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(r)<span class="sc">+</span></span>
<span id="cb169-3"><a href="regression-analysis.html#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(r1), <span class="at">fill =</span> <span class="st">&#39;blue&#39;</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb169-4"><a href="regression-analysis.html#cb169-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(r2), <span class="at">fill =</span> <span class="st">&#39;red&#39;</span>,  <span class="at">alpha =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb169-5"><a href="regression-analysis.html#cb169-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> .<span class="dv">68</span>), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">linetype =</span> <span class="st">&#39;dashed&#39;</span>)<span class="sc">+</span></span>
<span id="cb169-6"><a href="regression-analysis.html#cb169-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Red = corelation from quantlies.  Blue = continus correlation.  </span></span>
<span id="cb169-7"><a href="regression-analysis.html#cb169-7" aria-hidden="true" tabindex="-1"></a><span class="st">       Dashed line = true effect size&#39;</span>)<span class="sc">+</span></span>
<span id="cb169-8"><a href="regression-analysis.html#cb169-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="regression-analysis.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co">#.</span></span></code></pre></div>
<p>They truly are the devil. We get the wrong effect size. This is something to think about. We should probably not reduce our sample with median/quantile splits if at all possible. A nice thing with simulations is that we have all the information. That is, we know the true effect size since we decide it ourselves.</p>
<p>Another thing that Field harps on about is that the effect size of eta is less preferable than omega. I agree, but it´s not super easy to understand why. We can use simulations again to see how eta and omega behaves in different settings.</p>
<p>Let´s do a play example and say we are testing school classes (on something), we don’t expect a difference between all of them, but we do expect differences between some classes. Here is an example of a comparison between three classes. Note that this part will be a bit code heavy, use the “?” function for the commands you want to take a closer look at :)</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="regression-analysis.html#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Let´s clean the environment before we start</span></span>
<span id="cb171-2"><a href="regression-analysis.html#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb171-3"><a href="regression-analysis.html#cb171-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-4"><a href="regression-analysis.html#cb171-4" aria-hidden="true" tabindex="-1"></a>k    <span class="ot">&lt;-</span> <span class="dv">3</span>  <span class="co">#number of classes</span></span>
<span id="cb171-5"><a href="regression-analysis.html#cb171-5" aria-hidden="true" tabindex="-1"></a>n1   <span class="ot">&lt;-</span> <span class="dv">23</span> <span class="co">#student in class one</span></span>
<span id="cb171-6"><a href="regression-analysis.html#cb171-6" aria-hidden="true" tabindex="-1"></a>n2   <span class="ot">&lt;-</span> <span class="dv">22</span> <span class="co">#students in class two</span></span>
<span id="cb171-7"><a href="regression-analysis.html#cb171-7" aria-hidden="true" tabindex="-1"></a>n3   <span class="ot">&lt;-</span> <span class="dv">25</span> <span class="co">#students in class three</span></span>
<span id="cb171-8"><a href="regression-analysis.html#cb171-8" aria-hidden="true" tabindex="-1"></a>N    <span class="ot">&lt;-</span> n1 <span class="sc">+</span> n2 <span class="sc">+</span> n3</span>
<span id="cb171-9"><a href="regression-analysis.html#cb171-9" aria-hidden="true" tabindex="-1"></a>df_b <span class="ot">&lt;-</span> k <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb171-10"><a href="regression-analysis.html#cb171-10" aria-hidden="true" tabindex="-1"></a>df_e <span class="ot">&lt;-</span> N <span class="sc">-</span> k</span>
<span id="cb171-11"><a href="regression-analysis.html#cb171-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-12"><a href="regression-analysis.html#cb171-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-13"><a href="regression-analysis.html#cb171-13" aria-hidden="true" tabindex="-1"></a>sst <span class="ot">&lt;-</span> <span class="dv">4000</span>     <span class="co">#total sum of squares</span></span>
<span id="cb171-14"><a href="regression-analysis.html#cb171-14" aria-hidden="true" tabindex="-1"></a>ssb <span class="ot">&lt;-</span> <span class="dv">500</span>      <span class="co">#sum of squares between</span></span>
<span id="cb171-15"><a href="regression-analysis.html#cb171-15" aria-hidden="true" tabindex="-1"></a>sse <span class="ot">&lt;-</span> sst<span class="sc">-</span>ssb  <span class="co">#sum of squares error</span></span>
<span id="cb171-16"><a href="regression-analysis.html#cb171-16" aria-hidden="true" tabindex="-1"></a>mse <span class="ot">&lt;-</span> sse<span class="sc">/</span>df_e <span class="co">#mean squared error</span></span>
<span id="cb171-17"><a href="regression-analysis.html#cb171-17" aria-hidden="true" tabindex="-1"></a>ssb<span class="sc">/</span>sst <span class="co">#eta</span></span></code></pre></div>
<pre><code>## [1] 0.125</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="regression-analysis.html#cb173-1" aria-hidden="true" tabindex="-1"></a>(ssb<span class="sc">-</span>(df_b<span class="sc">*</span>mse))<span class="sc">/</span>(sst<span class="sc">+</span>mse) <span class="co">#omega</span></span></code></pre></div>
<pre><code>## [1] 0.09760589</code></pre>
<p>Pretty simple right? Let´s change the setting and make a data frame comparison of 14 classes where the sst and ssb increases by 5% for every new class included in the comparison. That is, the explained variance and the total variance increases the same amount - i.e., equally</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="regression-analysis.html#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Again, I like a clean environment, so i start with a clean slate</span></span>
<span id="cb175-2"><a href="regression-analysis.html#cb175-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb175-3"><a href="regression-analysis.html#cb175-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-4"><a href="regression-analysis.html#cb175-4" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>)</span>
<span id="cb175-5"><a href="regression-analysis.html#cb175-5" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(<span class="fu">rep</span>(<span class="dv">25</span>, <span class="dv">15</span>))</span>
<span id="cb175-6"><a href="regression-analysis.html#cb175-6" aria-hidden="true" tabindex="-1"></a>df_b <span class="ot">&lt;-</span> k <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb175-7"><a href="regression-analysis.html#cb175-7" aria-hidden="true" tabindex="-1"></a>df_e <span class="ot">&lt;-</span> N <span class="sc">-</span> k</span>
<span id="cb175-8"><a href="regression-analysis.html#cb175-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-9"><a href="regression-analysis.html#cb175-9" aria-hidden="true" tabindex="-1"></a>sst <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(<span class="fu">c</span>(<span class="dv">4000</span>,<span class="fu">rep</span>(<span class="fl">1.05</span>, <span class="dv">14</span>)))</span>
<span id="cb175-10"><a href="regression-analysis.html#cb175-10" aria-hidden="true" tabindex="-1"></a>ssb <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(<span class="fu">c</span>(<span class="dv">500</span>,<span class="fu">rep</span>(<span class="fl">1.05</span>, <span class="dv">14</span>)))</span>
<span id="cb175-11"><a href="regression-analysis.html#cb175-11" aria-hidden="true" tabindex="-1"></a>sse <span class="ot">&lt;-</span> sst<span class="sc">-</span>ssb</span>
<span id="cb175-12"><a href="regression-analysis.html#cb175-12" aria-hidden="true" tabindex="-1"></a>mse <span class="ot">&lt;-</span> sse<span class="sc">/</span>df_e</span>
<span id="cb175-13"><a href="regression-analysis.html#cb175-13" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> ssb<span class="sc">/</span>sst</span>
<span id="cb175-14"><a href="regression-analysis.html#cb175-14" aria-hidden="true" tabindex="-1"></a>omega <span class="ot">&lt;-</span> (ssb<span class="sc">-</span>(df_b<span class="sc">*</span>mse))<span class="sc">/</span>(sst<span class="sc">+</span>mse)</span>
<span id="cb175-15"><a href="regression-analysis.html#cb175-15" aria-hidden="true" tabindex="-1"></a>effect_diff <span class="ot">&lt;-</span> eta<span class="sc">-</span>omega</span>
<span id="cb175-16"><a href="regression-analysis.html#cb175-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-17"><a href="regression-analysis.html#cb175-17" aria-hidden="true" tabindex="-1"></a>class_data_equal <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(k, N, df_b, df_e, sst, ssb, sse, mse, eta, omega, effect_diff)</span>
<span id="cb175-18"><a href="regression-analysis.html#cb175-18" aria-hidden="true" tabindex="-1"></a>class_data_equal <span class="ot">&lt;-</span> <span class="fu">slice</span>(class_data_equal, <span class="sc">-</span><span class="dv">1</span>) <span class="co">#removing the first row</span></span>
<span id="cb175-19"><a href="regression-analysis.html#cb175-19" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(class_data_equal)</span></code></pre></div>
<p>Let’s plot this so we can see more clearly</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="regression-analysis.html#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting both effect sizes</span></span>
<span id="cb176-2"><a href="regression-analysis.html#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(class_data_equal)<span class="sc">+</span></span>
<span id="cb176-3"><a href="regression-analysis.html#cb176-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> omega, <span class="at">x =</span> k), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">&#39;red&#39;</span>)<span class="sc">+</span></span>
<span id="cb176-4"><a href="regression-analysis.html#cb176-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>((<span class="fu">aes</span>(<span class="at">y =</span> eta , <span class="at">x =</span> k)),<span class="at">size =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">&#39;blue&#39;</span>)<span class="sc">+</span></span>
<span id="cb176-5"><a href="regression-analysis.html#cb176-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)<span class="sc">+</span></span>
<span id="cb176-6"><a href="regression-analysis.html#cb176-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Effect size&#39;</span>)<span class="sc">+</span></span>
<span id="cb176-7"><a href="regression-analysis.html#cb176-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Omega = Red.  Eta = Blue&#39;</span>)<span class="sc">+</span></span>
<span id="cb176-8"><a href="regression-analysis.html#cb176-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="regression-analysis.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting the difference between the effect sizes</span></span>
<span id="cb177-2"><a href="regression-analysis.html#cb177-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(class_data_equal)<span class="sc">+</span></span>
<span id="cb177-3"><a href="regression-analysis.html#cb177-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> effect_diff, <span class="at">x =</span> k))<span class="sc">+</span></span>
<span id="cb177-4"><a href="regression-analysis.html#cb177-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)<span class="sc">+</span></span>
<span id="cb177-5"><a href="regression-analysis.html#cb177-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Effect size difference&#39;</span>)<span class="sc">+</span></span>
<span id="cb177-6"><a href="regression-analysis.html#cb177-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-47-2.png" width="672" />
Pretty cool right? let’s make it even worse and look at an example where the explained variance increases less than the increase in total variance. Let’s say that with each additional class, sst increases with 5% and ssb with 2%</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="regression-analysis.html#cb179-1" aria-hidden="true" tabindex="-1"></a>sst <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(<span class="fu">c</span>(<span class="dv">4000</span>,<span class="fu">rep</span>(<span class="fl">1.05</span>, <span class="dv">14</span>)))</span>
<span id="cb179-2"><a href="regression-analysis.html#cb179-2" aria-hidden="true" tabindex="-1"></a>ssb <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(<span class="fu">c</span>(<span class="dv">500</span>,<span class="fu">rep</span>(<span class="fl">1.02</span>, <span class="dv">14</span>)))</span>
<span id="cb179-3"><a href="regression-analysis.html#cb179-3" aria-hidden="true" tabindex="-1"></a>sse <span class="ot">&lt;-</span> sst<span class="sc">-</span>ssb</span>
<span id="cb179-4"><a href="regression-analysis.html#cb179-4" aria-hidden="true" tabindex="-1"></a>mse <span class="ot">&lt;-</span> sse<span class="sc">/</span>df_e</span>
<span id="cb179-5"><a href="regression-analysis.html#cb179-5" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> ssb<span class="sc">/</span>sst</span>
<span id="cb179-6"><a href="regression-analysis.html#cb179-6" aria-hidden="true" tabindex="-1"></a>omega <span class="ot">&lt;-</span> (ssb<span class="sc">-</span>(df_b<span class="sc">*</span>mse))<span class="sc">/</span>(sst<span class="sc">+</span>mse)</span>
<span id="cb179-7"><a href="regression-analysis.html#cb179-7" aria-hidden="true" tabindex="-1"></a>effect_diff <span class="ot">&lt;-</span> eta<span class="sc">-</span>omega</span>
<span id="cb179-8"><a href="regression-analysis.html#cb179-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-9"><a href="regression-analysis.html#cb179-9" aria-hidden="true" tabindex="-1"></a>class_data_unequal <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(k, N, df_b, df_e, sst, ssb, sse, mse, eta, omega, effect_diff)</span>
<span id="cb179-10"><a href="regression-analysis.html#cb179-10" aria-hidden="true" tabindex="-1"></a>class_data_unequal <span class="ot">&lt;-</span> <span class="fu">slice</span>(class_data_unequal, <span class="sc">-</span><span class="dv">1</span>) <span class="co">#removing the first row</span></span>
<span id="cb179-11"><a href="regression-analysis.html#cb179-11" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(class_data_unequal)</span></code></pre></div>
<p>let’s plot this too</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="regression-analysis.html#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(class_data_unequal)<span class="sc">+</span></span>
<span id="cb180-2"><a href="regression-analysis.html#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> omega, <span class="at">x =</span> k), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">&#39;red&#39;</span>)<span class="sc">+</span></span>
<span id="cb180-3"><a href="regression-analysis.html#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>((<span class="fu">aes</span>(<span class="at">y =</span> eta , <span class="at">x =</span> k)),<span class="at">size =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">&#39;blue&#39;</span>)<span class="sc">+</span></span>
<span id="cb180-4"><a href="regression-analysis.html#cb180-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)<span class="sc">+</span></span>
<span id="cb180-5"><a href="regression-analysis.html#cb180-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Effect size&#39;</span>)<span class="sc">+</span></span>
<span id="cb180-6"><a href="regression-analysis.html#cb180-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Omega = Red.  Eta = Blue&#39;</span>)<span class="sc">+</span></span>
<span id="cb180-7"><a href="regression-analysis.html#cb180-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="regression-analysis.html#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(class_data_unequal)<span class="sc">+</span></span>
<span id="cb181-2"><a href="regression-analysis.html#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> effect_diff, <span class="at">x =</span> k))<span class="sc">+</span></span>
<span id="cb181-3"><a href="regression-analysis.html#cb181-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)<span class="sc">+</span></span>
<span id="cb181-4"><a href="regression-analysis.html#cb181-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Effect size&#39;</span>)<span class="sc">+</span></span>
<span id="cb181-5"><a href="regression-analysis.html#cb181-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-49-2.png" width="672" />
Observe the slight difference in slope, let’s look closer at this difference</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="regression-analysis.html#cb183-1" aria-hidden="true" tabindex="-1"></a>equal_unequal_diff <span class="ot">&lt;-</span> class_data_unequal<span class="sc">$</span>effect_diff <span class="sc">-</span> class_data_equal<span class="sc">$</span>effect_diff</span>
<span id="cb183-2"><a href="regression-analysis.html#cb183-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-3"><a href="regression-analysis.html#cb183-3" aria-hidden="true" tabindex="-1"></a>x.seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb183-4"><a href="regression-analysis.html#cb183-4" aria-hidden="true" tabindex="-1"></a>diffplot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(equal_unequal_diff, x.seq)</span>
<span id="cb183-5"><a href="regression-analysis.html#cb183-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-6"><a href="regression-analysis.html#cb183-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diffplot)<span class="sc">+</span></span>
<span id="cb183-7"><a href="regression-analysis.html#cb183-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> equal_unequal_diff, <span class="at">x=</span>x.seq)</span>
<span id="cb183-8"><a href="regression-analysis.html#cb183-8" aria-hidden="true" tabindex="-1"></a>              , <span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">colour =</span> <span class="st">&#39;red&#39;</span>)<span class="sc">+</span></span>
<span id="cb183-9"><a href="regression-analysis.html#cb183-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)<span class="sc">+</span></span>
<span id="cb183-10"><a href="regression-analysis.html#cb183-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Effect size difference&#39;</span>)<span class="sc">+</span></span>
<span id="cb183-11"><a href="regression-analysis.html#cb183-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;df between&#39;</span>)<span class="sc">+</span></span>
<span id="cb183-12"><a href="regression-analysis.html#cb183-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-50-1.png" width="672" />
we see here that the difference between equal and unequal ssb/sst ratio increases as the number of comparisons increase.</p>
<p>Another way of thinking about this could be through repeated measures. If we exchange class for time in the example above, we would make the same conclusion. That is because Omega is dependent on the sample size since it uses MSE for its estimation.</p>
<p>We can simulate a correlation between two variables in various sample sizes to examine this closer.</p>
<p>here we have 30 observations per group with a correlation of .6</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="regression-analysis.html#cb184-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">rnorm_multi</span>( <span class="at">n =</span> <span class="dv">30</span></span>
<span id="cb184-2"><a href="regression-analysis.html#cb184-2" aria-hidden="true" tabindex="-1"></a>                    , <span class="at">vars =</span> <span class="dv">2</span></span>
<span id="cb184-3"><a href="regression-analysis.html#cb184-3" aria-hidden="true" tabindex="-1"></a>                    , <span class="at">mu   =</span> <span class="fu">c</span>(<span class="dv">33</span>, <span class="dv">35</span>)</span>
<span id="cb184-4"><a href="regression-analysis.html#cb184-4" aria-hidden="true" tabindex="-1"></a>                    , <span class="at">sd   =</span> <span class="fu">c</span>(<span class="dv">2</span> , <span class="dv">5</span> )</span>
<span id="cb184-5"><a href="regression-analysis.html#cb184-5" aria-hidden="true" tabindex="-1"></a>                    , <span class="at">r    =</span> .<span class="dv">6</span></span>
<span id="cb184-6"><a href="regression-analysis.html#cb184-6" aria-hidden="true" tabindex="-1"></a>                    , <span class="at">varnames =</span> <span class="fu">c</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>)</span>
<span id="cb184-7"><a href="regression-analysis.html#cb184-7" aria-hidden="true" tabindex="-1"></a>                    , <span class="at">empirical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb184-8"><a href="regression-analysis.html#cb184-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(data)</span></code></pre></div>
<pre><code>##     x   y
## x 1.0 0.6
## y 0.6 1.0</code></pre>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="regression-analysis.html#cb186-1" aria-hidden="true" tabindex="-1"></a>lm1 <span class="ot">&lt;-</span> <span class="fu">aov</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data)</span>
<span id="cb186-2"><a href="regression-analysis.html#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.aov</span>(lm1)</span></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## x            1    261  261.00   15.75 0.000457 ***
## Residuals   28    464   16.57                     
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="regression-analysis.html#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.lm</span>(lm1)</span></code></pre></div>
<pre><code>## 
## Call:
## aov(formula = y ~ x, data = data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -9.6671 -1.7540  0.1118  1.6817  9.8603 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  -14.500     12.495  -1.160 0.255657    
## x              1.500      0.378   3.969 0.000457 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 4.071 on 28 degrees of freedom
## Multiple R-squared:   0.36,  Adjusted R-squared:  0.3371 
## F-statistic: 15.75 on 1 and 28 DF,  p-value: 0.0004571</code></pre>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="regression-analysis.html#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(lm1, <span class="at">type =</span> <span class="st">&#39;eta&#39;</span>)</span></code></pre></div>
<pre><code>## # Effect Size for ANOVA
## 
## Parameter | Eta2 |       95% CI
## -------------------------------
## x         | 0.36 | [0.13, 1.00]
## 
## - One-sided CIs: upper bound fixed at (1).</code></pre>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="regression-analysis.html#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(lm1, <span class="at">type =</span> <span class="st">&#39;omega&#39;</span>)</span></code></pre></div>
<pre><code>## # Effect Size for ANOVA
## 
## Parameter | Omega2 |       95% CI
## ---------------------------------
## x         |   0.33 | [0.11, 1.00]
## 
## - One-sided CIs: upper bound fixed at (1).</code></pre>
<p>If we drastically increase the sample size omega and eta will be equal</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="regression-analysis.html#cb194-1" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> <span class="fu">rnorm_multi</span>(<span class="at">n =</span> <span class="fl">1e5</span></span>
<span id="cb194-2"><a href="regression-analysis.html#cb194-2" aria-hidden="true" tabindex="-1"></a>                    , <span class="at">vars =</span> <span class="dv">2</span></span>
<span id="cb194-3"><a href="regression-analysis.html#cb194-3" aria-hidden="true" tabindex="-1"></a>                    , <span class="at">mu   =</span> <span class="fu">c</span>(<span class="dv">33</span>, <span class="dv">35</span>)</span>
<span id="cb194-4"><a href="regression-analysis.html#cb194-4" aria-hidden="true" tabindex="-1"></a>                    , <span class="at">sd   =</span> <span class="fu">c</span>(<span class="dv">2</span> , <span class="dv">5</span> )</span>
<span id="cb194-5"><a href="regression-analysis.html#cb194-5" aria-hidden="true" tabindex="-1"></a>                    , <span class="at">r    =</span> .<span class="dv">6</span></span>
<span id="cb194-6"><a href="regression-analysis.html#cb194-6" aria-hidden="true" tabindex="-1"></a>                    , <span class="at">varnames =</span> <span class="fu">c</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>)</span>
<span id="cb194-7"><a href="regression-analysis.html#cb194-7" aria-hidden="true" tabindex="-1"></a>                    , <span class="at">empirical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb194-8"><a href="regression-analysis.html#cb194-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(data2)</span></code></pre></div>
<pre><code>##     x   y
## x 1.0 0.6
## y 0.6 1.0</code></pre>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="regression-analysis.html#cb196-1" aria-hidden="true" tabindex="-1"></a>lm2 <span class="ot">&lt;-</span> <span class="fu">aov</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data2)</span>
<span id="cb196-2"><a href="regression-analysis.html#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.aov</span>(lm2)</span></code></pre></div>
<pre><code>##                Df  Sum Sq Mean Sq F value Pr(&gt;F)    
## x               1  899991  899991   56249 &lt;2e-16 ***
## Residuals   99998 1599984      16                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="regression-analysis.html#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.lm</span>(lm2)</span></code></pre></div>
<pre><code>## 
## Call:
## aov(formula = y ~ x, data = data2)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -17.1101  -2.6919  -0.0065   2.6867  17.0662 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -14.500000   0.209095  -69.35   &lt;2e-16 ***
## x             1.500000   0.006325  237.17   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 4 on 99998 degrees of freedom
## Multiple R-squared:   0.36,  Adjusted R-squared:   0.36 
## F-statistic: 5.625e+04 on 1 and 99998 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="regression-analysis.html#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(lm2, <span class="at">type =</span> <span class="st">&#39;eta&#39;</span>)</span></code></pre></div>
<pre><code>## # Effect Size for ANOVA
## 
## Parameter | Eta2 |       95% CI
## -------------------------------
## x         | 0.36 | [0.38, 1.00]
## 
## - One-sided CIs: upper bound fixed at (1).</code></pre>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="regression-analysis.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(lm2, <span class="at">type =</span> <span class="st">&#39;omega&#39;</span>)</span></code></pre></div>
<pre><code>## # Effect Size for ANOVA
## 
## Parameter | Omega2 |       95% CI
## ---------------------------------
## x         |   0.36 | [0.38, 1.00]
## 
## - One-sided CIs: upper bound fixed at (1).</code></pre>
<p>And if we reduce it to nothing they will differ greatly</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="regression-analysis.html#cb204-1" aria-hidden="true" tabindex="-1"></a>data3 <span class="ot">&lt;-</span> <span class="fu">rnorm_multi</span>(<span class="at">n =</span> <span class="dv">5</span></span>
<span id="cb204-2"><a href="regression-analysis.html#cb204-2" aria-hidden="true" tabindex="-1"></a>                     , <span class="at">vars =</span> <span class="dv">2</span></span>
<span id="cb204-3"><a href="regression-analysis.html#cb204-3" aria-hidden="true" tabindex="-1"></a>                     , <span class="at">mu   =</span> <span class="fu">c</span>(<span class="dv">33</span>, <span class="dv">35</span>)</span>
<span id="cb204-4"><a href="regression-analysis.html#cb204-4" aria-hidden="true" tabindex="-1"></a>                     , <span class="at">sd   =</span> <span class="fu">c</span>(<span class="dv">2</span> , <span class="dv">5</span> )</span>
<span id="cb204-5"><a href="regression-analysis.html#cb204-5" aria-hidden="true" tabindex="-1"></a>                     , <span class="at">r    =</span> .<span class="dv">6</span></span>
<span id="cb204-6"><a href="regression-analysis.html#cb204-6" aria-hidden="true" tabindex="-1"></a>                     , <span class="at">varnames =</span> <span class="fu">c</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>)</span>
<span id="cb204-7"><a href="regression-analysis.html#cb204-7" aria-hidden="true" tabindex="-1"></a>                     , <span class="at">empirical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb204-8"><a href="regression-analysis.html#cb204-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(data3)</span></code></pre></div>
<pre><code>##     x   y
## x 1.0 0.6
## y 0.6 1.0</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="regression-analysis.html#cb206-1" aria-hidden="true" tabindex="-1"></a>lm3 <span class="ot">&lt;-</span> <span class="fu">aov</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data3)</span>
<span id="cb206-2"><a href="regression-analysis.html#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.aov</span>(lm3)</span></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value Pr(&gt;F)
## x            1     36   36.00   1.687  0.285
## Residuals    3     64   21.33</code></pre>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="regression-analysis.html#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.lm</span>(lm3)</span></code></pre></div>
<pre><code>## 
## Call:
## aov(formula = y ~ x, data = data3)
## 
## Residuals:
##       1       2       3       4       5 
## -5.0432  5.3418 -1.8607 -0.8544  2.4166 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)  -14.500     38.161  -0.380    0.729
## x              1.500      1.155   1.299    0.285
## 
## Residual standard error: 4.619 on 3 degrees of freedom
## Multiple R-squared:   0.36,  Adjusted R-squared:  0.1467 
## F-statistic: 1.687 on 1 and 3 DF,  p-value: 0.2848</code></pre>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="regression-analysis.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(lm3, <span class="at">type =</span> <span class="st">&#39;eta&#39;</span>)</span></code></pre></div>
<pre><code>## # Effect Size for ANOVA
## 
## Parameter | Eta2 |       95% CI
## -------------------------------
## x         | 0.36 | [0.00, 1.00]
## 
## - One-sided CIs: upper bound fixed at (1).</code></pre>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="regression-analysis.html#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(lm3, <span class="at">type =</span> <span class="st">&#39;omega&#39;</span>)</span></code></pre></div>
<pre><code>## # Effect Size for ANOVA
## 
## Parameter | Omega2 |       95% CI
## ---------------------------------
## x         |   0.12 | [0.00, 1.00]
## 
## - One-sided CIs: upper bound fixed at (1).</code></pre>
<p>There we have it. Since omega uses the mean sum of squares it varies across sample sizes. Eta does not do this; therefore it only varies depending on the ratio of ssb and sst. This is why the eta is the same across data1 data2 and data3, while omega is very different</p>
<p>Let’s make a plot of eta and omega values on sample sizes from 5 to 200 per group. This might be labour intensive for your computer - but it should go fast :)</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="regression-analysis.html#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="co">#let´s clean up our environment first - we have a lot of stuff there now</span></span>
<span id="cb214-2"><a href="regression-analysis.html#cb214-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb214-3"><a href="regression-analysis.html#cb214-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-4"><a href="regression-analysis.html#cb214-4" aria-hidden="true" tabindex="-1"></a>omega <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&#39;parameter&#39;</span> <span class="ot">=</span> <span class="cn">NA</span>, <span class="st">&#39;omega2&#39;</span> <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb214-5"><a href="regression-analysis.html#cb214-5" aria-hidden="true" tabindex="-1"></a>                , <span class="st">&#39;ci&#39;</span> <span class="ot">=</span> <span class="cn">NA</span>, <span class="st">&#39;ci_lo&#39;</span> <span class="ot">=</span> <span class="cn">NA</span>, <span class="st">&#39;ci_hi&#39;</span> <span class="ot">=</span> <span class="cn">NA</span>)</span>
<span id="cb214-6"><a href="regression-analysis.html#cb214-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>){</span>
<span id="cb214-7"><a href="regression-analysis.html#cb214-7" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">rnorm_multi</span>(<span class="at">n =</span> i<span class="sc">+</span><span class="dv">5</span></span>
<span id="cb214-8"><a href="regression-analysis.html#cb214-8" aria-hidden="true" tabindex="-1"></a>                                 , <span class="at">vars =</span> <span class="dv">2</span></span>
<span id="cb214-9"><a href="regression-analysis.html#cb214-9" aria-hidden="true" tabindex="-1"></a>                                 , <span class="at">mu   =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb214-10"><a href="regression-analysis.html#cb214-10" aria-hidden="true" tabindex="-1"></a>                                 , <span class="at">sd   =</span> <span class="fu">c</span>(<span class="dv">1</span> ,<span class="dv">1</span> )</span>
<span id="cb214-11"><a href="regression-analysis.html#cb214-11" aria-hidden="true" tabindex="-1"></a>                                 , <span class="at">r    =</span> .<span class="dv">6</span></span>
<span id="cb214-12"><a href="regression-analysis.html#cb214-12" aria-hidden="true" tabindex="-1"></a>                                 , <span class="at">empirical =</span> <span class="cn">TRUE</span></span>
<span id="cb214-13"><a href="regression-analysis.html#cb214-13" aria-hidden="true" tabindex="-1"></a>                                 , <span class="at">varnames =</span> <span class="fu">c</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>)))</span>
<span id="cb214-14"><a href="regression-analysis.html#cb214-14" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> data<span class="sc">$</span>x</span>
<span id="cb214-15"><a href="regression-analysis.html#cb214-15" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> data<span class="sc">$</span>y</span>
<span id="cb214-16"><a href="regression-analysis.html#cb214-16" aria-hidden="true" tabindex="-1"></a>  lm1 <span class="ot">&lt;-</span> <span class="fu">aov</span>(x<span class="sc">~</span>y)</span>
<span id="cb214-17"><a href="regression-analysis.html#cb214-17" aria-hidden="true" tabindex="-1"></a>  o <span class="ot">&lt;-</span> <span class="fu">effectsize</span>(lm1, <span class="at">type =</span> <span class="st">&#39;omega&#39;</span>)</span>
<span id="cb214-18"><a href="regression-analysis.html#cb214-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb214-19"><a href="regression-analysis.html#cb214-19" aria-hidden="true" tabindex="-1"></a>  omega[i,] <span class="ot">&lt;-</span> o</span>
<span id="cb214-20"><a href="regression-analysis.html#cb214-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb214-21"><a href="regression-analysis.html#cb214-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb214-22"><a href="regression-analysis.html#cb214-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb214-23"><a href="regression-analysis.html#cb214-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-24"><a href="regression-analysis.html#cb214-24" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&#39;parameter&#39;</span> <span class="ot">=</span> <span class="cn">NA</span>, <span class="st">&#39;eta&#39;</span> <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb214-25"><a href="regression-analysis.html#cb214-25" aria-hidden="true" tabindex="-1"></a>                    , <span class="st">&#39;ci&#39;</span> <span class="ot">=</span> <span class="cn">NA</span>, <span class="st">&#39;ci_lo&#39;</span> <span class="ot">=</span> <span class="cn">NA</span>, <span class="st">&#39;ci_hi&#39;</span> <span class="ot">=</span> <span class="cn">NA</span>)</span>
<span id="cb214-26"><a href="regression-analysis.html#cb214-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>){</span>
<span id="cb214-27"><a href="regression-analysis.html#cb214-27" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">rnorm_multi</span>(<span class="at">n =</span> i<span class="sc">+</span><span class="dv">4</span></span>
<span id="cb214-28"><a href="regression-analysis.html#cb214-28" aria-hidden="true" tabindex="-1"></a>                                 , <span class="at">vars =</span> <span class="dv">2</span></span>
<span id="cb214-29"><a href="regression-analysis.html#cb214-29" aria-hidden="true" tabindex="-1"></a>                                 , <span class="at">mu   =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb214-30"><a href="regression-analysis.html#cb214-30" aria-hidden="true" tabindex="-1"></a>                                 , <span class="at">sd   =</span> <span class="fu">c</span>(<span class="dv">1</span> ,<span class="dv">1</span> )</span>
<span id="cb214-31"><a href="regression-analysis.html#cb214-31" aria-hidden="true" tabindex="-1"></a>                                 , <span class="at">r    =</span> .<span class="dv">6</span></span>
<span id="cb214-32"><a href="regression-analysis.html#cb214-32" aria-hidden="true" tabindex="-1"></a>                                 , <span class="at">empirical =</span> <span class="cn">TRUE</span></span>
<span id="cb214-33"><a href="regression-analysis.html#cb214-33" aria-hidden="true" tabindex="-1"></a>                                 , <span class="at">varnames =</span> <span class="fu">c</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>)))</span>
<span id="cb214-34"><a href="regression-analysis.html#cb214-34" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> data<span class="sc">$</span>x</span>
<span id="cb214-35"><a href="regression-analysis.html#cb214-35" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> data<span class="sc">$</span>y</span>
<span id="cb214-36"><a href="regression-analysis.html#cb214-36" aria-hidden="true" tabindex="-1"></a>  lm1 <span class="ot">&lt;-</span> <span class="fu">aov</span>(x<span class="sc">~</span>y)</span>
<span id="cb214-37"><a href="regression-analysis.html#cb214-37" aria-hidden="true" tabindex="-1"></a>  e <span class="ot">&lt;-</span> <span class="fu">effectsize</span>(lm1, <span class="at">type =</span> <span class="st">&#39;eta&#39;</span>)</span>
<span id="cb214-38"><a href="regression-analysis.html#cb214-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb214-39"><a href="regression-analysis.html#cb214-39" aria-hidden="true" tabindex="-1"></a>  eta[i,] <span class="ot">&lt;-</span> e</span>
<span id="cb214-40"><a href="regression-analysis.html#cb214-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb214-41"><a href="regression-analysis.html#cb214-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb214-42"><a href="regression-analysis.html#cb214-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-43"><a href="regression-analysis.html#cb214-43" aria-hidden="true" tabindex="-1"></a>omega_eta <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(omega<span class="sc">$</span>omega2, eta<span class="sc">$</span>eta, (<span class="dv">5</span><span class="sc">:</span><span class="dv">204</span>))</span>
<span id="cb214-44"><a href="regression-analysis.html#cb214-44" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(omega_eta) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;omega&#39;</span>, <span class="st">&#39;eta&#39;</span>, <span class="st">&#39;sample_size&#39;</span>)</span>
<span id="cb214-45"><a href="regression-analysis.html#cb214-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-46"><a href="regression-analysis.html#cb214-46" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(omega_eta)<span class="sc">+</span></span>
<span id="cb214-47"><a href="regression-analysis.html#cb214-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> sample_size, <span class="at">y =</span> omega), <span class="at">colour =</span> <span class="st">&#39;red&#39;</span>)<span class="sc">+</span></span>
<span id="cb214-48"><a href="regression-analysis.html#cb214-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> sample_size, <span class="at">y =</span> eta))<span class="sc">+</span></span>
<span id="cb214-49"><a href="regression-analysis.html#cb214-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>))<span class="sc">+</span></span>
<span id="cb214-50"><a href="regression-analysis.html#cb214-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Effect size&#39;</span>)<span class="sc">+</span></span>
<span id="cb214-51"><a href="regression-analysis.html#cb214-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;n per group&#39;</span>)<span class="sc">+</span></span>
<span id="cb214-52"><a href="regression-analysis.html#cb214-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Omega = Red. Eta = Blue&#39;</span>)<span class="sc">+</span></span>
<span id="cb214-53"><a href="regression-analysis.html#cb214-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-54-1.png" width="672" />
This shows the relationship between eta and omega quite nicely I think. It also shows how Eta can be quite a problematic effect size if the sample is small.</p>
<p>A disclaimer to this section is that I am not a very “mathy” guy and I might be doing some mistakes in these simulations. I would have liked to cross reference it somewhere, but I have not seen anyone doing anything similar.</p>
</div>
<div id="anova" class="section level3 hasAnchor" number="9.2.2">
<h3><span class="header-section-number">9.2.2</span> ANOVA<a href="regression-analysis.html#anova" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Field book places a lot of focus on the glm or the general linear model. Confusingly, the function glm() in R does not refer to the general linear model but the generalised linear model, which as a broader mode of model specification that we will get to later. When Field talks about the general linear model he usually talks about analysis of variance. I do not see any major advantages of using ANOVA (or ANVCOVA) instead of multiple regression. Due to this bias of mine, I will leave this chapter quite bare bones, since i think that you could just use regression instead or formulate some more sophisticated analysis (that we will get to later). This is not due to some long-standing grudge against ANOVA (I used ANOVA in my BA thesis) but simply because I think regression is a better mode of analysis most of the time. With that said, ANOVA output should be familiar to you since we got an ANOVA output in the previous chapter on regression. If we only want the ANOVA and not coefficients like in regression, we use the aov() function instead of the lm() function. Quite simple right? The one thing with ANOVA that I absolutely adore is the plotting. Since we are using factors as dependent variables, we can make some lovely plots including my favourite: violin plots. So, let´s load some data from the Field book and make some plots.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="regression-analysis.html#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co">#I believe Field uses the beer goggle data, so let´s load that along with the packages we need.  </span></span>
<span id="cb215-2"><a href="regression-analysis.html#cb215-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-3"><a href="regression-analysis.html#cb215-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb215-4"><a href="regression-analysis.html#cb215-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb215-5"><a href="regression-analysis.html#cb215-5" aria-hidden="true" tabindex="-1"></a>goggles <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="st">&quot;data sets/Goggles.sav&quot;</span>)</span>
<span id="cb215-6"><a href="regression-analysis.html#cb215-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-7"><a href="regression-analysis.html#cb215-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MVN)        <span class="co">#for diagnostics and descriptives</span></span>
<span id="cb215-8"><a href="regression-analysis.html#cb215-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcomp)   <span class="co">#for multiple comparisons </span></span>
<span id="cb215-9"><a href="regression-analysis.html#cb215-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effectsize) <span class="co">#for effectsize calculation</span></span></code></pre></div>
<p>Nice, let´s check the structure of the data and take some descriptives</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="regression-analysis.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(goggles)</span></code></pre></div>
<pre><code>## tibble [48 x 3] (S3: tbl_df/tbl/data.frame)
##  $ FaceType      : dbl+lbl [1:48] 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...
##    ..@ label        : chr &quot;Attractivenss of facial stimuli&quot;
##    ..@ format.spss  : chr &quot;F8.0&quot;
##    ..@ display_width: int 11
##    ..@ labels       : Named num [1:2] 0 1
##    .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;Unattractive&quot; &quot;Attractive&quot;
##  $ Alcohol       : dbl+lbl [1:48] 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2,...
##    ..@ label      : chr &quot;Alcohol consumption&quot;
##    ..@ format.spss: chr &quot;F8.0&quot;
##    ..@ labels     : Named num [1:3] 0 1 2
##    .. ..- attr(*, &quot;names&quot;)= chr [1:3] &quot;Placebo&quot; &quot;Low dose&quot; &quot;High dose&quot;
##  $ Attractiveness: num [1:48] 6 7 6 7 6 5 8 6 7 6 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;Median attractiveness rating&quot;
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F8.0&quot;
##   ..- attr(*, &quot;display_width&quot;)= int 13</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="regression-analysis.html#cb218-1" aria-hidden="true" tabindex="-1"></a>diagnostics <span class="ot">&lt;-</span> <span class="fu">mvn</span>(<span class="at">data =</span> goggles           <span class="co">#the data</span></span>
<span id="cb218-2"><a href="regression-analysis.html#cb218-2" aria-hidden="true" tabindex="-1"></a>                   , <span class="at">mvnTest =</span> <span class="st">&#39;mardia&#39;</span>     <span class="co">#what mvn test to use</span></span>
<span id="cb218-3"><a href="regression-analysis.html#cb218-3" aria-hidden="true" tabindex="-1"></a>                   , <span class="at">univariateTest =</span> <span class="st">&#39;SW&#39;</span>  <span class="co">#what univariate test(shapiro/wilks)</span></span>
<span id="cb218-4"><a href="regression-analysis.html#cb218-4" aria-hidden="true" tabindex="-1"></a>                   , <span class="at">univariatePlot =</span> <span class="st">&#39;qq&#39;</span>  <span class="co">#what plot: QQ plot</span></span>
<span id="cb218-5"><a href="regression-analysis.html#cb218-5" aria-hidden="true" tabindex="-1"></a>                   , <span class="at">multivariatePlot =</span> <span class="st">&#39;qq&#39;</span><span class="co"># what plot: QQ plot</span></span>
<span id="cb218-6"><a href="regression-analysis.html#cb218-6" aria-hidden="true" tabindex="-1"></a>                   , <span class="at">multivariateOutlierMethod =</span> <span class="st">&#39;quan&#39;</span> <span class="co">#what method - mahalanobis</span></span>
<span id="cb218-7"><a href="regression-analysis.html#cb218-7" aria-hidden="true" tabindex="-1"></a>                   , <span class="at">showNewData =</span> T)       <span class="co">#generating new outlier free data</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-56-1.png" width="672" /><img src="bookdownproj_files/figure-html/unnamed-chunk-56-2.png" width="672" /></p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="regression-analysis.html#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co">#We have some issues with normality, but we never care about that anyways. Let´s check the descriptives </span></span>
<span id="cb219-2"><a href="regression-analysis.html#cb219-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-3"><a href="regression-analysis.html#cb219-3" aria-hidden="true" tabindex="-1"></a>diagnostics<span class="sc">$</span>Descriptives</span></code></pre></div>
<pre><code>##                 n     Mean   Std.Dev Median Min Max 25th 75th      Skew   Kurtosis
## FaceType       48 0.500000 0.5052912    0.5   0   1    0    1  0.000000 -2.0412326
## Alcohol        48 1.000000 0.8251370    1.0   0   2    0    2  0.000000 -1.5618490
## Attractiveness 48 5.666667 1.5889691    6.0   1   8    5    7 -0.735088  0.3320222</code></pre>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="regression-analysis.html#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Note that they look very bad, it´s not what we are interested in at all. We need to use grouping coding as well as changing the structure of the data to factors. </span></span></code></pre></div>
<p>Cool, we have numeric values on attractiveness signifying that it is our dependent variable, while alcohol and facetype is our independent variables. However, they are not coded as factors, we need to change this, so let’s do that and make some plots to examine the relationship between our variables.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="regression-analysis.html#cb222-1" aria-hidden="true" tabindex="-1"></a>fac.alc <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(goggles<span class="sc">$</span>Alcohol)        <span class="co">#Factor of the alcohol variable</span></span>
<span id="cb222-2"><a href="regression-analysis.html#cb222-2" aria-hidden="true" tabindex="-1"></a>fac.face <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(goggles<span class="sc">$</span>FaceType)      <span class="co">#Factor of the facetype variable</span></span>
<span id="cb222-3"><a href="regression-analysis.html#cb222-3" aria-hidden="true" tabindex="-1"></a>goggles <span class="ot">&lt;-</span> <span class="fu">cbind</span>(goggles, fac.alc, fac.face) <span class="co">#Binding the factors to the data</span></span>
<span id="cb222-4"><a href="regression-analysis.html#cb222-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(fac.alc, fac.face)                        <span class="co">#Removing the factors from env</span></span>
<span id="cb222-5"><a href="regression-analysis.html#cb222-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-6"><a href="regression-analysis.html#cb222-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-7"><a href="regression-analysis.html#cb222-7" aria-hidden="true" tabindex="-1"></a>goggles <span class="sc">%&gt;%</span></span>
<span id="cb222-8"><a href="regression-analysis.html#cb222-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Attractiveness, <span class="at">x =</span> fac.alc))<span class="sc">+</span></span>
<span id="cb222-9"><a href="regression-analysis.html#cb222-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="fu">aes</span>(<span class="at">fill =</span> fac.alc, <span class="at">alpha =</span> .<span class="dv">3</span>))<span class="sc">+</span></span>
<span id="cb222-10"><a href="regression-analysis.html#cb222-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> .<span class="dv">3</span>, <span class="at">fill =</span> <span class="st">&#39;grey&#39;</span>, <span class="at">alpha =</span> .<span class="dv">6</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb222-11"><a href="regression-analysis.html#cb222-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="regression-analysis.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="co">#We see a clear difference in variation, while the median is similar across values of alcohol, the spread gets smaller as alcohol increases. </span></span>
<span id="cb223-2"><a href="regression-analysis.html#cb223-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-3"><a href="regression-analysis.html#cb223-3" aria-hidden="true" tabindex="-1"></a>goggles <span class="sc">%&gt;%</span></span>
<span id="cb223-4"><a href="regression-analysis.html#cb223-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Attractiveness, <span class="at">x =</span> fac.alc, <span class="at">colour =</span> fac.face))<span class="sc">+</span></span>
<span id="cb223-5"><a href="regression-analysis.html#cb223-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> .<span class="dv">3</span>, <span class="at">fill =</span> <span class="st">&#39;grey&#39;</span>, <span class="at">alpha =</span> .<span class="dv">6</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb223-6"><a href="regression-analysis.html#cb223-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-57-2.png" width="672" /></p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="regression-analysis.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Right, here we see that facetype influences the relationship between alcohol and attractiveness. Face type 1 does not differ across alcohol treatments.  </span></span></code></pre></div>
<p>Cool, let´s take some better descriptive statistics and make some group comparisons, we can use the pastecs package for this.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="regression-analysis.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(goggles<span class="sc">$</span>Attractiveness, goggles<span class="sc">$</span>fac.face, pastecs<span class="sc">::</span>stat.desc)</span></code></pre></div>
<pre><code>## goggles$fac.face: 0
##      nbr.val     nbr.null       nbr.na          min          max        range 
##   24.0000000    0.0000000    0.0000000    1.0000000    8.0000000    7.0000000 
##          sum       median         mean      SE.mean CI.mean.0.95          var 
##  120.0000000    5.0000000    5.0000000    0.3710541    0.7675839    3.3043478 
##      std.dev     coef.var 
##    1.8177865    0.3635573 
## ------------------------------------------------------------------- 
## goggles$fac.face: 1
##      nbr.val     nbr.null       nbr.na          min          max        range 
##   24.0000000    0.0000000    0.0000000    5.0000000    8.0000000    3.0000000 
##          sum       median         mean      SE.mean CI.mean.0.95          var 
##  152.0000000    6.0000000    6.3333333    0.1965893    0.4066759    0.9275362 
##      std.dev     coef.var 
##    0.9630868    0.1520663</code></pre>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="regression-analysis.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This is a pretty good way of getting descriptives. For example, we see that face type 0 has a mean attractiveness of 5 and sd of 1.8 while facetype 2 has mean attractiveness of 6.3 and sd of .9. </span></span>
<span id="cb227-2"><a href="regression-analysis.html#cb227-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-3"><a href="regression-analysis.html#cb227-3" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(goggles<span class="sc">$</span>Attractiveness, goggles<span class="sc">$</span>fac.alc, pastecs<span class="sc">::</span>stat.desc)</span></code></pre></div>
<pre><code>## goggles$fac.alc: 0
##      nbr.val     nbr.null       nbr.na          min          max        range 
##   16.0000000    0.0000000    0.0000000    1.0000000    8.0000000    7.0000000 
##          sum       median         mean      SE.mean CI.mean.0.95          var 
##   79.0000000    5.5000000    4.9375000    0.4870725    1.0381704    3.7958333 
##      std.dev     coef.var 
##    1.9482898    0.3945903 
## ------------------------------------------------------------------- 
## goggles$fac.alc: 1
##      nbr.val     nbr.null       nbr.na          min          max        range 
##   16.0000000    0.0000000    0.0000000    3.0000000    8.0000000    5.0000000 
##          sum       median         mean      SE.mean CI.mean.0.95          var 
##   91.0000000    6.0000000    5.6875000    0.3381167    0.7206787    1.8291667 
##      std.dev     coef.var 
##    1.3524669    0.2377964 
## ------------------------------------------------------------------- 
## goggles$fac.alc: 2
##      nbr.val     nbr.null       nbr.na          min          max        range 
##   16.0000000    0.0000000    0.0000000    5.0000000    8.0000000    3.0000000 
##          sum       median         mean      SE.mean CI.mean.0.95          var 
##  102.0000000    6.0000000    6.3750000    0.2719528    0.5796537    1.1833333 
##      std.dev     coef.var 
##    1.0878113    0.1706371</code></pre>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="regression-analysis.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Note that we don’t learn much more from the descriptives than we do from the plots. </span></span></code></pre></div>
<p>Before doing our ANOVA we should check the homogeneity of variance. We do this with the levensTest from the car package like we did with the regression.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="regression-analysis.html#cb230-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">leveneTest</span>(<span class="at">y =</span> goggles<span class="sc">$</span>Attractiveness</span>
<span id="cb230-2"><a href="regression-analysis.html#cb230-2" aria-hidden="true" tabindex="-1"></a>                , <span class="fu">interaction</span>(goggles<span class="sc">$</span>fac.alc, goggles<span class="sc">$</span>fac.face))</span></code></pre></div>
<pre><code>## Levene&#39;s Test for Homogeneity of Variance (center = median)
##       Df F value Pr(&gt;F)
## group  5  0.7171 0.6142
##       42</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="regression-analysis.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Looks good. the interaction function makes the levens tast compare all possible groups to check if the variance is different across the groups. I expected it to be bigger since the plots showed discrepancy in variation. We can check the variation difference for the factors singularly as well, let’s do that. </span></span>
<span id="cb232-2"><a href="regression-analysis.html#cb232-2" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">leveneTest</span>(<span class="at">y =</span> goggles<span class="sc">$</span>Attractivenes, <span class="at">group =</span> goggles<span class="sc">$</span>fac.alc)</span></code></pre></div>
<pre><code>## Levene&#39;s Test for Homogeneity of Variance (center = median)
##       Df F value Pr(&gt;F)
## group  2  2.1847 0.1243
##       45</code></pre>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="regression-analysis.html#cb234-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">leveneTest</span>(<span class="at">y =</span> goggles<span class="sc">$</span>Attractivenes, <span class="at">group =</span> goggles<span class="sc">$</span>fac.face)</span></code></pre></div>
<pre><code>## Levene&#39;s Test for Homogeneity of Variance (center = median)
##       Df F value Pr(&gt;F)  
## group  1     6.4 0.0149 *
##       46                 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="regression-analysis.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This is more what I expected, since the sd/variance was quite different we sould expect levens to be significant. </span></span></code></pre></div>
<p>Let´s fit our model. Since we want to fit a full factorial ANOVA we can assume to have met our assumption of homogeneity of variance.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="regression-analysis.html#cb237-1" aria-hidden="true" tabindex="-1"></a>model<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">aov</span>(Attractiveness <span class="sc">~</span> fac.face<span class="sc">*</span>fac.alc, <span class="at">data =</span> goggles) </span></code></pre></div>
<p>Good, now we have our ANOVA, we can examine it by using the summar.aov function or the ANOVA function. They have some different properties to them but are more or less the same.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="regression-analysis.html#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.aov</span>(model<span class="fl">.1</span>, <span class="at">intercept =</span> T)</span></code></pre></div>
<pre><code>##                  Df Sum Sq Mean Sq  F value   Pr(&gt;F)    
## (Intercept)       1 1541.3  1541.3 1125.843  &lt; 2e-16 ***
## fac.face          1   21.3    21.3   15.583 0.000295 ***
## fac.alc           2   16.5     8.3    6.041 0.004943 ** 
## fac.face:fac.alc  2   23.3    11.6    8.507 0.000791 ***
## Residuals        42   57.5     1.4                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="regression-analysis.html#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: Attractiveness
##                  Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## fac.face          1 21.333 21.3333 15.5826 0.0002952 ***
## fac.alc           2 16.542  8.2708  6.0413 0.0049434 ** 
## fac.face:fac.alc  2 23.292 11.6458  8.5065 0.0007913 ***
## Residuals        42 57.500  1.3690                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="regression-analysis.html#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="co">#see ?summary.aov and ?anova for different uses. I personally prefer summary.aov</span></span></code></pre></div>
<p>Right, we see significant differences between all variables along with a significant interaction term, indicating that the relationship between the IV and DVs are dependent on the values of the other DV. We cannot say which variable that causes the difference. Let´s take a closer look at what levels of the variables that drives the significance and the effect sizes.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="regression-analysis.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TukeyHSD</span>(model<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = Attractiveness ~ fac.face * fac.alc, data = goggles)
## 
## $fac.face
##         diff       lwr      upr     p adj
## 1-0 1.333333 0.6516897 2.014977 0.0002952
## 
## $fac.alc
##       diff        lwr      upr     p adj
## 1-0 0.7500 -0.2550324 1.755032 0.1777260
## 2-0 1.4375  0.4324676 2.442532 0.0033704
## 2-1 0.6875 -0.3175324 1.692532 0.2317125
## 
## $`fac.face:fac.alc`
##           diff          lwr       upr     p adj
## 1:0-0:0  2.875  1.128535277 4.6214647 0.0001939
## 0:1-0:0  1.375 -0.371464723 3.1214647 0.1974738
## 1:1-0:0  3.000  1.253535277 4.7464647 0.0000979
## 0:2-0:0  3.125  1.378535277 4.8714647 0.0000491
## 1:2-0:0  2.625  0.878535277 4.3714647 0.0007414
## 0:1-1:0 -1.500 -3.246464723 0.2464647 0.1291660
## 1:1-1:0  0.125 -1.621464723 1.8714647 0.9999339
## 0:2-1:0  0.250 -1.496464723 1.9964647 0.9980556
## 1:2-1:0 -0.250 -1.996464723 1.4964647 0.9980556
## 1:1-0:1  1.625 -0.121464723 3.3714647 0.0812069
## 0:2-0:1  1.750  0.003535277 3.4964647 0.0492763
## 1:2-0:1  1.250 -0.496464723 2.9964647 0.2889504
## 0:2-1:1  0.125 -1.621464723 1.8714647 0.9999339
## 1:2-1:1 -0.375 -2.121464723 1.3714647 0.9871315
## 1:2-0:2 -0.500 -2.246464723 1.2464647 0.9550187</code></pre>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="regression-analysis.html#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(<span class="at">model =</span> model<span class="fl">.1</span>, <span class="at">type =</span> <span class="st">&#39;omega&#39;</span>)</span></code></pre></div>
<pre><code>## # Effect Size for ANOVA (Type I)
## 
## Parameter        | Omega2 (partial) |       95% CI
## --------------------------------------------------
## fac.face         |             0.23 | [0.07, 1.00]
## fac.alc          |             0.17 | [0.02, 1.00]
## fac.face:fac.alc |             0.24 | [0.06, 1.00]
## 
## - One-sided CIs: upper bound fixed at (1).</code></pre>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="regression-analysis.html#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(<span class="at">model =</span> model<span class="fl">.1</span>, <span class="at">type =</span> <span class="st">&#39;eta&#39;</span>)</span></code></pre></div>
<pre><code>## # Effect Size for ANOVA (Type I)
## 
## Parameter        | Eta2 (partial) |       95% CI
## ------------------------------------------------
## fac.face         |           0.27 | [0.10, 1.00]
## fac.alc          |           0.22 | [0.05, 1.00]
## fac.face:fac.alc |           0.29 | [0.10, 1.00]
## 
## - One-sided CIs: upper bound fixed at (1).</code></pre>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="regression-analysis.html#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="co">#To get a multiple r2 we can fit a regression model like so: </span></span>
<span id="cb249-2"><a href="regression-analysis.html#cb249-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.lm</span>(<span class="fu">lm</span>(Attractiveness <span class="sc">~</span> fac.face <span class="sc">*</span> fac.alc, <span class="at">data =</span> goggles))</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Attractiveness ~ fac.face * fac.alc, data = goggles)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -2.500 -0.625 -0.125  0.625  2.500 
## 
## Coefficients:
##                    Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)          3.5000     0.4137   8.461 1.29e-10 ***
## fac.face1            2.8750     0.5850   4.914 1.41e-05 ***
## fac.alc1             1.3750     0.5850   2.350 0.023531 *  
## fac.alc2             3.1250     0.5850   5.342 3.49e-06 ***
## fac.face1:fac.alc1  -1.2500     0.8274  -1.511 0.138319    
## fac.face1:fac.alc2  -3.3750     0.8274  -4.079 0.000197 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.17 on 42 degrees of freedom
## Multiple R-squared:  0.5154, Adjusted R-squared:  0.4578 
## F-statistic: 8.936 on 5 and 42 DF,  p-value: 7.677e-06</code></pre>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="regression-analysis.html#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Note also that we get coefficients - I think this is a more intuitive way to model. </span></span></code></pre></div>
<p>The Tukey function is a very neat function for ANOVA. There is significant difference between placebo conditions and high alcohol doses, as well as on various levels of interactions between the factors. We can explain quite a bit of variation as well which is nice.</p>
<p>This is all the ANOVA I have in me to give. If it is not evident by now, I do not like ANOVA (on its own) very much. There are many more things you can do with the ANOVA analysis along with contrasts, robust measures, and interaction plots. I advise you to look for these things elsewhere since I don´t find them very fun - especially since we can use other tools that are more fun, like multiple regression.</p>
</div>
</div>
<div id="the-generalized-linear-modellogit" class="section level2 hasAnchor" number="9.3">
<h2><span class="header-section-number">9.3</span> The generalized linear model(logit)<a href="regression-analysis.html#the-generalized-linear-modellogit" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Packages we need to do some logits</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="regression-analysis.html#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb252-2"><a href="regression-analysis.html#cb252-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb252-3"><a href="regression-analysis.html#cb252-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb252-4"><a href="regression-analysis.html#cb252-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span></code></pre></div>
<p>Let´s load the data. We use the data from field again - that is, the eel data.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="regression-analysis.html#cb253-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="fu">here</span>(<span class="st">&quot;data sets/Eel.sav&quot;</span>))</span>
<span id="cb253-2"><a href="regression-analysis.html#cb253-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;cured&#39;</span>, <span class="st">&#39;intervention&#39;</span>, <span class="st">&#39;duration&#39;</span>)</span></code></pre></div>
<p>Let´s have a look at our variables</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="regression-analysis.html#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data)</span></code></pre></div>
<pre><code>## tibble [113 x 3] (S3: tbl_df/tbl/data.frame)
##  $ cured       : dbl+lbl [1:113] 0, 0, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 0, 0, 1, 0, 1, 1, 0, 1...
##    ..@ label        : chr &quot;Cured?&quot;
##    ..@ format.spss  : chr &quot;F8.0&quot;
##    ..@ display_width: int 13
##    ..@ labels       : Named num [1:2] 0 1
##    .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;Not Cured&quot; &quot;Cured&quot;
##  $ intervention: dbl+lbl [1:113] 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1...
##    ..@ label        : chr &quot;Intervention&quot;
##    ..@ format.spss  : chr &quot;F8.0&quot;
##    ..@ display_width: int 14
##    ..@ labels       : Named num [1:2] 0 1
##    .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;No Treatment&quot; &quot;Intervention&quot;
##  $ duration    : num [1:113] 7 7 6 8 7 6 7 7 8 7 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;Number of Days with Problem before Treatment&quot;
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F8.0&quot;
##   ..- attr(*, &quot;display_width&quot;)= int 10
##  - attr(*, &quot;label&quot;)= chr &quot;File created by MATRIX&quot;</code></pre>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="regression-analysis.html#cb256-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb256-2"><a href="regression-analysis.html#cb256-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> duration))<span class="sc">+</span></span>
<span id="cb256-3"><a href="regression-analysis.html#cb256-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb256-4"><a href="regression-analysis.html#cb256-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-64-1.png" width="672" />
Looks very nice, first we will do a univariate logistic regression and then add a the dummy variable of intervention. We formulate our model the same way as in the normal regression but use the glm function instead of the lm function. Since we are using a glm, we also need to specify what link function we will use, we will use logit since, well…this is a chapter on logit.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="regression-analysis.html#cb258-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">glm</span>( <span class="at">formula =</span> cured <span class="sc">~</span> duration </span>
<span id="cb258-2"><a href="regression-analysis.html#cb258-2" aria-hidden="true" tabindex="-1"></a>          , <span class="at">data   =</span> data</span>
<span id="cb258-3"><a href="regression-analysis.html#cb258-3" aria-hidden="true" tabindex="-1"></a>          , <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&#39;logit&#39;</span>))</span>
<span id="cb258-4"><a href="regression-analysis.html#cb258-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-5"><a href="regression-analysis.html#cb258-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.glm</span>(m1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = cured ~ duration, family = binomial(link = &quot;logit&quot;), 
##     data = data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.4747  -1.3049   0.9548   1.0551   1.1603  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)
## (Intercept)  -0.5951     1.1680  -0.510    0.610
## duration      0.1271     0.1634   0.778    0.436
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 154.08  on 112  degrees of freedom
## Residual deviance: 153.47  on 111  degrees of freedom
## AIC: 157.47
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>Interesting, the duration does not seem to increase the probability of being cured. Let´s check if the intervention alone increases the probability of being cured.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="regression-analysis.html#cb260-1" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">glm</span>( <span class="at">formula =</span> cured <span class="sc">~</span> intervention </span>
<span id="cb260-2"><a href="regression-analysis.html#cb260-2" aria-hidden="true" tabindex="-1"></a>          , <span class="at">data   =</span> data</span>
<span id="cb260-3"><a href="regression-analysis.html#cb260-3" aria-hidden="true" tabindex="-1"></a>          , <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&#39;logit&#39;</span>))</span>
<span id="cb260-4"><a href="regression-analysis.html#cb260-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-5"><a href="regression-analysis.html#cb260-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.glm</span>(m2)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = cured ~ intervention, family = binomial(link = &quot;logit&quot;), 
##     data = data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.5940  -1.0579   0.8118   0.8118   1.3018  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)   -0.2877     0.2700  -1.065  0.28671   
## intervention   1.2287     0.3998   3.074  0.00212 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 154.08  on 112  degrees of freedom
## Residual deviance: 144.16  on 111  degrees of freedom
## AIC: 148.16
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>It certainly does, let´s fit a multivariate logistic regression using both variables.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="regression-analysis.html#cb262-1" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">glm</span>( <span class="at">formula =</span> cured <span class="sc">~</span> duration <span class="sc">+</span> intervention</span>
<span id="cb262-2"><a href="regression-analysis.html#cb262-2" aria-hidden="true" tabindex="-1"></a>          , <span class="at">data   =</span> data</span>
<span id="cb262-3"><a href="regression-analysis.html#cb262-3" aria-hidden="true" tabindex="-1"></a>          , <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&#39;logit&#39;</span>))</span>
<span id="cb262-4"><a href="regression-analysis.html#cb262-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-5"><a href="regression-analysis.html#cb262-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.glm</span>(m3)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = cured ~ duration + intervention, family = binomial(link = &quot;logit&quot;), 
##     data = data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.6025  -1.0572   0.8107   0.8161   1.3095  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)  -0.234660   1.220563  -0.192  0.84754   
## duration     -0.007835   0.175913  -0.045  0.96447   
## intervention  1.233532   0.414565   2.975  0.00293 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 154.08  on 112  degrees of freedom
## Residual deviance: 144.16  on 110  degrees of freedom
## AIC: 150.16
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>No, duration does not matter even when we adjust for the intervention. We might have an interaction though, so let´s fit a model with interactions</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="regression-analysis.html#cb264-1" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">glm</span>( <span class="at">formula =</span> cured <span class="sc">~</span> duration<span class="sc">*</span>intervention </span>
<span id="cb264-2"><a href="regression-analysis.html#cb264-2" aria-hidden="true" tabindex="-1"></a>          , <span class="at">data   =</span> data</span>
<span id="cb264-3"><a href="regression-analysis.html#cb264-3" aria-hidden="true" tabindex="-1"></a>          , <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&#39;logit&#39;</span>))</span>
<span id="cb264-4"><a href="regression-analysis.html#cb264-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-5"><a href="regression-analysis.html#cb264-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.glm</span>(m4)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = cured ~ duration * intervention, family = binomial(link = &quot;logit&quot;), 
##     data = data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.6510  -1.0611   0.8045   0.8412   1.3285  
## 
## Coefficients:
##                       Estimate Std. Error z value Pr(&gt;|z|)
## (Intercept)           -0.52033    1.68409  -0.309    0.757
## duration               0.03436    0.24540   0.140    0.889
## intervention           1.85049    2.53509   0.730    0.465
## duration:intervention -0.08694    0.35200  -0.247    0.805
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 154.08  on 112  degrees of freedom
## Residual deviance: 144.09  on 109  degrees of freedom
## AIC: 152.09
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>Huh, if we include an interaction term no variables are significant predictors. Let´s stick with the model without the interaction and check for any influential observations</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="regression-analysis.html#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">influence.measures</span>(m3))</span></code></pre></div>
<pre><code>## Potentially influential observations of
##   glm(formula = cured ~ duration + intervention, family = binomial(link = &quot;logit&quot;),      data = data) :
## 
##     dfb.1_ dfb.drtn dfb.intr dffit cov.r   cook.d hat  
## 47  -0.27   0.24     0.02    -0.28  1.08_*  0.02   0.08
## 111 -0.27   0.24     0.02    -0.28  1.08_*  0.02   0.08</code></pre>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="regression-analysis.html#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">hatvalues</span>(m3))<span class="sc">*</span><span class="dv">3</span></span></code></pre></div>
<pre><code>## [1] 0.07964602</code></pre>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="regression-analysis.html#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="co">#observation 47 and 111 are highly impactfull. Lets have a look at the residuals</span></span>
<span id="cb270-2"><a href="regression-analysis.html#cb270-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-3"><a href="regression-analysis.html#cb270-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">scale</span>(m3<span class="sc">$</span>residuals))</span></code></pre></div>
<pre><code>##        V1         
##  Min.   :-1.6907  
##  1st Qu.:-0.8188  
##  Median : 0.6503  
##  Mean   : 0.0000  
##  3rd Qu.: 0.6532  
##  Max.   : 1.1034</code></pre>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="regression-analysis.html#cb272-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">scale</span>(m3<span class="sc">$</span>residuals)</span>
<span id="cb272-2"><a href="regression-analysis.html#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">arrange</span>(<span class="fu">tibble</span>(res), <span class="fu">desc</span>(res)), <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 1
##    res[,1]
##      &lt;dbl&gt;
##  1    1.10
##  2    1.10
##  3    1.10
##  4    1.10
##  5    1.10
##  6    1.09
##  7    1.09
##  8    1.09
##  9    1.09
## 10    1.09</code></pre>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="regression-analysis.html#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="co">#They are quite small = good. </span></span></code></pre></div>
<p>I don´t think we need to exclude any variables, so let´s check our assumptions and then make you model interpretable.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="regression-analysis.html#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking independence</span></span>
<span id="cb275-2"><a href="regression-analysis.html#cb275-2" aria-hidden="true" tabindex="-1"></a><span class="fu">durbinWatsonTest</span>(m3)</span></code></pre></div>
<pre><code>##  lag Autocorrelation D-W Statistic p-value
##    1      -0.1881671      2.363961   0.062
##  Alternative hypothesis: rho != 0</code></pre>
<p>This is not very good. The statistic is approaching significance, it is close to two however. Let’s check the VIF and tolerance.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="regression-analysis.html#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(m3)</span></code></pre></div>
<pre><code>##     duration intervention 
##     1.075431     1.075431</code></pre>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="regression-analysis.html#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span><span class="fu">vif</span>(m3)</span></code></pre></div>
<pre><code>##     duration intervention 
##    0.9298601    0.9298601</code></pre>
<p>Very solid, no issues here. Let’s finally go through the linearity assumption. We can use the box-tidwell test for this. Or just check visually. Let’s do the latter – I like that better.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="regression-analysis.html#cb281-1" aria-hidden="true" tabindex="-1"></a>logit <span class="ot">&lt;-</span> <span class="fu">logit</span>(<span class="fu">fitted.values</span>(m3))</span>
<span id="cb281-2"><a href="regression-analysis.html#cb281-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(data<span class="sc">$</span>cured, data<span class="sc">$</span>duration, data<span class="sc">$</span>intervention) <span class="sc">%&gt;%</span></span>
<span id="cb281-3"><a href="regression-analysis.html#cb281-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logit =</span> <span class="fu">logit</span>(<span class="fu">fitted.values</span>(m3))) <span class="sc">%&gt;%</span></span>
<span id="cb281-4"><a href="regression-analysis.html#cb281-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">&quot;predictors&quot;</span>, <span class="at">value =</span> <span class="st">&quot;predictor.value&quot;</span>, <span class="sc">-</span>logit)</span></code></pre></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="regression-analysis.html#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(logit, predictor.value))<span class="sc">+</span></span>
<span id="cb283-2"><a href="regression-analysis.html#cb283-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb283-3"><a href="regression-analysis.html#cb283-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;loess&quot;</span>) <span class="sc">+</span> </span>
<span id="cb283-4"><a href="regression-analysis.html#cb283-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb283-5"><a href="regression-analysis.html#cb283-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>predictors, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-72-1.png" width="672" />
No good, duration is not linear to the logit, we should drop it. We won´t be doing much harm to our model anyways. Thus, let´s continue with model 2(m2). Now we want to interpret the model, I like to use absolute probabilities. This is not appropriate in this scenario since we don’t have a continuous variable.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="regression-analysis.html#cb285-1" aria-hidden="true" tabindex="-1"></a>prob <span class="ot">&lt;-</span> <span class="fu">predict.glm</span>(m3, <span class="at">type =</span> <span class="st">&#39;response&#39;</span>)</span>
<span id="cb285-2"><a href="regression-analysis.html#cb285-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(data, prob)</span>
<span id="cb285-3"><a href="regression-analysis.html#cb285-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-4"><a href="regression-analysis.html#cb285-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x=</span>duration, <span class="at">y =</span> prob))<span class="sc">+</span> </span>
<span id="cb285-5"><a href="regression-analysis.html#cb285-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">&quot;glm&quot;</span></span>
<span id="cb285-6"><a href="regression-analysis.html#cb285-6" aria-hidden="true" tabindex="-1"></a>              , <span class="at">se=</span>T</span>
<span id="cb285-7"><a href="regression-analysis.html#cb285-7" aria-hidden="true" tabindex="-1"></a>              , <span class="at">method.args =</span> <span class="fu">list</span>(<span class="fu">gaussian</span>(<span class="at">link =</span> <span class="st">&#39;logit&#39;</span>))</span>
<span id="cb285-8"><a href="regression-analysis.html#cb285-8" aria-hidden="true" tabindex="-1"></a>              , <span class="at">colour =</span> <span class="st">&#39;pink&#39;</span></span>
<span id="cb285-9"><a href="regression-analysis.html#cb285-9" aria-hidden="true" tabindex="-1"></a>              , <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb285-10"><a href="regression-analysis.html#cb285-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha=</span>.<span class="dv">5</span>, <span class="at">height =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb285-11"><a href="regression-analysis.html#cb285-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb285-12"><a href="regression-analysis.html#cb285-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="regression-analysis.html#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="co">#.</span></span></code></pre></div>
<p>Coolio, here we see the absolute probability of being cured as the duration after the treatment increases given that we adjust for the treatment effect. Note that the effect is not significant, the shaded 95% confidence interval is overlapping across values of duration. If we do the same plot on intervention, we get a graph with two values on the x-axis like so:</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="regression-analysis.html#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x=</span>intervention, <span class="at">y =</span> prob))<span class="sc">+</span> </span>
<span id="cb288-2"><a href="regression-analysis.html#cb288-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">&quot;glm&quot;</span></span>
<span id="cb288-3"><a href="regression-analysis.html#cb288-3" aria-hidden="true" tabindex="-1"></a>              , <span class="at">se=</span>T</span>
<span id="cb288-4"><a href="regression-analysis.html#cb288-4" aria-hidden="true" tabindex="-1"></a>              , <span class="at">method.args =</span> <span class="fu">list</span>(<span class="fu">gaussian</span>(<span class="at">link =</span> <span class="st">&#39;logit&#39;</span>))</span>
<span id="cb288-5"><a href="regression-analysis.html#cb288-5" aria-hidden="true" tabindex="-1"></a>              , <span class="at">colour =</span> <span class="st">&#39;pink&#39;</span></span>
<span id="cb288-6"><a href="regression-analysis.html#cb288-6" aria-hidden="true" tabindex="-1"></a>              , <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb288-7"><a href="regression-analysis.html#cb288-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha=</span>.<span class="dv">5</span>, <span class="at">height =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb288-8"><a href="regression-analysis.html#cb288-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb288-9"><a href="regression-analysis.html#cb288-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type haven_labelled/vctrs_vctr/double. Defaulting to continuous.</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="regression-analysis.html#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Note. The dots/jitters on the graphs are just the observations. I keep them there because they emphasize that the outcome is binary. </span></span></code></pre></div>
<p>We can also get the odds ratios taking the exponent of the logit like so:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="regression-analysis.html#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(<span class="fu">glm</span>(<span class="at">formula =</span> cured <span class="sc">~</span> duration <span class="sc">+</span> intervention, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">data =</span> data)))</span></code></pre></div>
<pre><code>##  (Intercept)     duration intervention 
##    0.7908401    0.9921954    3.4333349</code></pre>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="regression-analysis.html#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Or simply accessing the coefficients from the fitted model, I prefer this latter way :) </span></span>
<span id="cb294-2"><a href="regression-analysis.html#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(m3<span class="sc">$</span>coefficients)</span></code></pre></div>
<pre><code>##  (Intercept)     duration intervention 
##    0.7908401    0.9921954    3.4333349</code></pre>
<p>Here we see that the likelihood of being cured is three times as likely for those partaking in the treatment. The duration does not matter.</p>
<p>We can also make a classification table - how many times our model makes correct classifications on the dependent variable.</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="regression-analysis.html#cb296-1" aria-hidden="true" tabindex="-1"></a>classification <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb296-2"><a href="regression-analysis.html#cb296-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">respons =</span> data<span class="sc">$</span>cured                       <span class="co">#what is the actual outcome?</span></span>
<span id="cb296-3"><a href="regression-analysis.html#cb296-3" aria-hidden="true" tabindex="-1"></a>, <span class="at">predicted =</span> <span class="fu">round</span>(<span class="fu">fitted.values</span>(m3),<span class="dv">0</span>))    <span class="co">#what is our guess?</span></span>
<span id="cb296-4"><a href="regression-analysis.html#cb296-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-5"><a href="regression-analysis.html#cb296-5" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span> predicted <span class="sc">+</span> respons, <span class="at">data =</span> classification)</span></code></pre></div>
<pre><code>##          respons
## predicted  0  1
##         0 32 24
##         1 16 41</code></pre>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="regression-analysis.html#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="co">#How many predictions were correct?</span></span>
<span id="cb298-2"><a href="regression-analysis.html#cb298-2" aria-hidden="true" tabindex="-1"></a>correct_prediction<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="dv">32</span><span class="sc">+</span><span class="dv">41</span></span>
<span id="cb298-3"><a href="regression-analysis.html#cb298-3" aria-hidden="true" tabindex="-1"></a><span class="co">#What percentage is correct?</span></span>
<span id="cb298-4"><a href="regression-analysis.html#cb298-4" aria-hidden="true" tabindex="-1"></a>correct_prediction<span class="fl">.1</span><span class="sc">/</span><span class="fu">length</span>(data<span class="sc">$</span>cured)</span></code></pre></div>
<pre><code>## [1] 0.6460177</code></pre>
<p>This is not a very good model. This model only makes correct classification 65% of the time. This is not much better than chance. This marks the end for logistic regression for now. Hopefully there is a good example of logistic regression in the wild in the chapter on real data (which don´t exist as of now). This example is quite boring in the sense that not much model building is available - we don’t have a lot of variables.</p>
</div>
<div id="cross-validation" class="section level2 hasAnchor" number="9.4">
<h2><span class="header-section-number">9.4</span> Cross validation<a href="regression-analysis.html#cross-validation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Logistic regression is the first machine learning “algorithm” that we have employed looking past the normal univariate and multivariate regression. A common way to cross validate is to split a sample in two and try to predict out-of-sample data with a model specified “within sample”. This is probably the best way, but it is resource intensive in the sense that you can’t “train” your model on the entire data set. Another way is using k-folds cross validation. This is a machine learning technique where you run multiple analyses on a k-number of partitions on your data. It is very interesting and something to look further into if you want to produce replicable results - which is important.</p>
<p>Let’s make a k-folds cross validation on the logit model we produced in the previous chapter. We need to formulate our training model again for it to run smoothly. We can use the caret package for this.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="regression-analysis.html#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code></pre></div>
<p>let’s respecify our data as our training data, that is, the data that we train our model on in order to make out of sample predictions.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="regression-analysis.html#cb301-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> data</span>
<span id="cb301-2"><a href="regression-analysis.html#cb301-2" aria-hidden="true" tabindex="-1"></a>train_data<span class="sc">$</span>cured <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(train_data<span class="sc">$</span>cured)</span></code></pre></div>
<p>Let´s specify the model again</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="regression-analysis.html#cb302-1" aria-hidden="true" tabindex="-1"></a>train_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>  <span class="co">#cv stands for cross validation</span></span>
<span id="cb302-2"><a href="regression-analysis.html#cb302-2" aria-hidden="true" tabindex="-1"></a>                              , <span class="at">number =</span> <span class="dv">10</span>) <span class="co">#this is the number of particions</span></span>
<span id="cb302-3"><a href="regression-analysis.html#cb302-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-4"><a href="regression-analysis.html#cb302-4" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the same model as m2. But specified to do a k-folds cross validation. </span></span>
<span id="cb302-5"><a href="regression-analysis.html#cb302-5" aria-hidden="true" tabindex="-1"></a>m3_train <span class="ot">&lt;-</span> <span class="fu">train</span>(cured <span class="sc">~</span> duration <span class="sc">+</span> intervention,</span>
<span id="cb302-6"><a href="regression-analysis.html#cb302-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> train_data,</span>
<span id="cb302-7"><a href="regression-analysis.html#cb302-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">trControl =</span> train_control,</span>
<span id="cb302-8"><a href="regression-analysis.html#cb302-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb302-9"><a href="regression-analysis.html#cb302-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&#39;logit&#39;</span>))</span>
<span id="cb302-10"><a href="regression-analysis.html#cb302-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-11"><a href="regression-analysis.html#cb302-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-12"><a href="regression-analysis.html#cb302-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m3_train)</span></code></pre></div>
<pre><code>## 
## Call:
## NULL
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.6025  -1.0572   0.8107   0.8161   1.3095  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)  -0.234660   1.220563  -0.192  0.84754   
## duration     -0.007835   0.175913  -0.045  0.96447   
## intervention  1.233532   0.414565   2.975  0.00293 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 154.08  on 112  degrees of freedom
## Residual deviance: 144.16  on 110  degrees of freedom
## AIC: 150.16
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="regression-analysis.html#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m3_train<span class="sc">$</span>results)</span></code></pre></div>
<pre><code>##   parameter            Accuracy          Kappa          AccuracySD        KappaSD     
##  Length:1           Min.   :0.6465   Min.   :0.2873   Min.   :0.1336   Min.   :0.265  
##  Class :character   1st Qu.:0.6465   1st Qu.:0.2873   1st Qu.:0.1336   1st Qu.:0.265  
##  Mode  :character   Median :0.6465   Median :0.2873   Median :0.1336   Median :0.265  
##                     Mean   :0.6465   Mean   :0.2873   Mean   :0.1336   Mean   :0.265  
##                     3rd Qu.:0.6465   3rd Qu.:0.2873   3rd Qu.:0.1336   3rd Qu.:0.265  
##                     Max.   :0.6465   Max.   :0.2873   Max.   :0.1336   Max.   :0.265</code></pre>
<p>The main thing to look at here is accuracy. We can see that the model performs quite poorly, making roughly 64,7% correct classifications. That is, we identify people being cured/not being cured correctly ca 65 times of 100. This is very similar to the result of our within sample classification - but it does not have to be similar.</p>
<p>This is a very straight forward example of cross validation, for other techniques you can check out the documentation in the carat package or any other machine learning package. In psychology cross validation is, sadly, rare. But getting a grasp on the reproducibility of your results is paramount for your analysis so I encourage a deeper dive into cross-validation. I need to learn more about it myself.</p>
</div>
<div id="lasso-least-absolute-shrinkage-and-selection-operator" class="section level2 hasAnchor" number="9.5">
<h2><span class="header-section-number">9.5</span> LASSO (least absolute shrinkage and selection operator)<a href="regression-analysis.html#lasso-least-absolute-shrinkage-and-selection-operator" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="ridge-regression" class="section level2 hasAnchor" number="9.6">
<h2><span class="header-section-number">9.6</span> Ridge regression<a href="regression-analysis.html#ridge-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="fully-bayesian-regression" class="section level2 hasAnchor" number="9.7">
<h2><span class="header-section-number">9.7</span> Fully Bayesian regression<a href="regression-analysis.html#fully-bayesian-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="poststratification" class="section level2 hasAnchor" number="9.8">
<h2><span class="header-section-number">9.8</span> Poststratification<a href="regression-analysis.html#poststratification" class="anchor-section" aria-label="Anchor link to header"></a></h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="correlation-and-covariation-in-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="path-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/AlfonsEdmar/StatsBook/edit/master/08.Regression_analysis.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/AlfonsEdmar/StatsBook/blob/master/08.Regression_analysis.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
